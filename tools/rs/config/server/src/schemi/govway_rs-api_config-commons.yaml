openapi: 3.0.3
components:

  headers:

    # API Key creata per l'entita registrata
    X-Api-Key:
      description: API Key creata per l'entita registrata
      schema:
        type: string
    # APP ID associato all'entita registrata
    X-App-Id:
      description: APP ID associato all'entita registrata
      schema:
        type: string

  parameters:
   
    # Dati Identificativi nel path
    id_soggetto_autorizzato:
      name: soggetto_autorizzato
      in: path
      description: Nome del soggetto autorizzato
      required: true
      schema:
        $ref: 'govway_core.yaml#/components/schemas/SimpleName'
    id_applicativo_autorizzato:
      name: applicativo_autorizzato
      in: path
      description: Nome dell'applicativo autorizzato
      required: true
      schema:
        $ref: 'govway_core.yaml#/components/schemas/NCName'
    id_ruolo_autorizzato:
      name: ruolo_autorizzato
      in: path
      description: Nome del ruolo autorizzato
      required: true
      schema:
        $ref: 'govway_core.yaml#/components/schemas/NCName'
    id_scope_autorizzato:
      name: scope_autorizzato
      in: path
      description: Nome dello scope autorizzato
      required: true
      schema:
        $ref: 'govway_core.yaml#/components/schemas/NCName'
    id_policy:
      name: id_policy
      in: path
      description: Identificativo della policy di Rate Limiting
      required: true
      schema:
        $ref: 'govway_core.yaml#/components/schemas/NCName'
    elemento_correlazione_applicativa:
      name: elemento
      in: path
      description: Elemento della regola di correlazione applicativa
      required: true
      schema:
        type: string
        maxLength: 255
    proprieta_configurazione:
      name: proprieta
      in: path
      description: Nome della propriet√† di configurazione
      required: true
      schema:
        type: string
        maxLength: 255
    id_nome_connettore:
      name: nome_connettore
      in: path
      description: Nome del connettore multiplo
      required: true
      schema:
        type: string
        maxLength: 255
            
    # Dati Identificativi nella query
    id_soggetto_applicativo:
      name: soggetto_applicativo
      in: query
      description: Nome del soggetto proprietario dell'applicativo
      required: false
      schema:
        $ref: 'govway_core.yaml#/components/schemas/SimpleName'
              
    # Ricerche
    tipo_api:
      name: tipo_api
      in: query
      description: Indica il tipo di API
      required: false
      example: 'rest'
      schema:
        $ref: '#/components/schemas/TipoApiEnum'
    uri_api_implementata:
      name: uri_api_implementata 
      in: query
      description: Identificativo dell'API implementata
      required: false
      schema:
        $ref: '#/components/schemas/UriApi'
    profilo_qualsiasi:
      name: profilo_qualsiasi 
      in: query
      description: Indica di non filtrare per uno specifico profilo ma di ritornare le API di tutti i profili gestiti
      required: false
      schema:
        type: boolean
        default: false
    soggetto_qualsiasi:
      name: soggetto_qualsiasi 
      in: query
      description: Indica di non filtrare per uno specifico soggetto ma di ritornare le API di tutti i soggetti
      required: false
      schema:
        type: boolean
        default: false
    dominio:
      name: dominio
      in: query
      description: Indica il dominio di un soggetto
      required: false
      example: 'esterno'
      schema:
        $ref: '#/components/schemas/DominioEnum'
    ruolo:
      name: ruolo
      in: query
      description: Identifica un ruolo
      required: false
      example: 'AccessoSolaLettura'
      schema:
        $ref: 'govway_core.yaml#/components/schemas/NCName'
    tipo_credenziali:
      name: tipo_credenziali
      in: query
      description: Identifica il tipo di credenziali associato all'oggetto
      required: false
      schema:
        $ref: '#/components/schemas/ModalitaAccessoEnum'
    fonte:
      name: fonte
      in: query
      description: Indica la fonte di un oggetto
      required: false
      example: 'esterna'
      schema:
        $ref: '#/components/schemas/FonteEnum'
    contesto:
      name: contesto
      in: query
      description: Indica il contesto di utilizzo di un oggetto
      required: false
      example: 'erogazione'
      schema:
        $ref: '#/components/schemas/ContestoEnum'
    http_method:
      name: http_method
      in: query
      description: Indica il tipo di http method
      required: false
      example: 'PUT'
      schema:
        $ref: '#/components/schemas/HttpMethodEnum'
    azione:
      name: azione
      in: query
      description: Identifica un azione o risorsa
      required: false
      example: 'Azione1'
      schema:
        $ref: 'govway_core.yaml#/components/schemas/NCName'
    metrica:
      name: metrica
      in: query
      description: Identifica una metrica di Rate Limiting
      required: false
      example: 'numero-richieste'
      schema:
        $ref: '#/components/schemas/RateLimitingCriteriMetricaEnum'

  responses:

    201CreatedKey:
      description: Resource created
      headers:
        X-Api-Key:
          $ref: '#/components/headers/X-Api-Key'
        X-App-Id:
          $ref: '#/components/headers/X-App-Id'
        Location:
          $ref: 'teamdigitale-openapi_definitions.yaml#/components/headers/Location'
        X-RateLimit-Limit:
          $ref: 'teamdigitale-openapi_definitions.yaml#/components/headers/X-RateLimit-Limit'
        X-RateLimit-Remaining:
          $ref: 'teamdigitale-openapi_definitions.yaml#/components/headers/X-RateLimit-Remaining'
        X-RateLimit-Reset:
          $ref: 'teamdigitale-openapi_definitions.yaml#/components/headers/X-RateLimit-Reset' 

    204UpdatedKey:
      description: Resource updated
      headers:
        X-Api-Key:
          $ref: '#/components/headers/X-Api-Key'
        X-App-Id:
          $ref: '#/components/headers/X-App-Id'
        X-RateLimit-Limit:
          $ref: 'teamdigitale-openapi_definitions.yaml#/components/headers/X-RateLimit-Limit'
        X-RateLimit-Remaining:
          $ref: 'teamdigitale-openapi_definitions.yaml#/components/headers/X-RateLimit-Remaining'
        X-RateLimit-Reset:
          $ref: 'teamdigitale-openapi_definitions.yaml#/components/headers/X-RateLimit-Reset'
        
  schemas:
 
    # Base: Stato
    StatoApiDescrizione:
      type: string
      example: 'Nessuna risorsa definita nella API'
      
    # Canale
    IdCanale:
      type: string
      pattern: ^[^\s]+$
      maxLength: 255
    ConfigurazioneApiCanale:
      type: object
      required:
        - configurazione
      properties:
        configurazione:
          $ref: 'govway_rs-api_config-commons.yaml#/components/schemas/ConfigurazioneCanaleEnum'
        canale:
          $ref: 'govway_rs-api_config-commons.yaml#/components/schemas/IdCanale'
    ApiCanale:
      type: object
      required:
        - configurazione
        - nome
      properties:
        configurazione:
          $ref: 'govway_rs-api_config-commons.yaml#/components/schemas/CanaleEnum'
        nome:
          $ref: 'govway_rs-api_config-commons.yaml#/components/schemas/IdCanale'

    # Base: API
    
    UriApi:
      type: string
      pattern: ^[a-z]{2,20}/[0-9A-Za-z]+:[_A-Za-z][\-\._A-Za-z0-9]*:\d$|^[_A-Za-z][\-\._A-Za-z0-9]*:\d$
      description: Indica l'uri di una Api 
    
    ApiBase:
      type: object
      required:
        - tipo_interfaccia
        - nome
        - versione
      properties:
        referente:
          $ref: 'govway_core.yaml#/components/schemas/SimpleName'
        tipo_interfaccia:
          type: object
          oneOf:
            - $ref: '#/components/schemas/ApiInterfacciaRest'
            - $ref: '#/components/schemas/ApiInterfacciaSoap'
          discriminator:
            propertyName: protocollo
            mapping:
              'rest': '#/components/schemas/ApiInterfacciaRest'
              'soap': '#/components/schemas/ApiInterfacciaSoap'
        nome:
          $ref: 'govway_core.yaml#/components/schemas/NCName'
        descrizione:
          type: string
          maxLength: 4000
          example: 'descrizione API'
        versione:
          $ref: 'govway_core.yaml#/components/schemas/Versione'
        tags:
          type: array
          items:
            $ref: 'govway_core.yaml#/components/schemas/NCName'
          example: [PagamentiTelematici, Anagrafica]

    ApiBaseConSoggetto:
      type: object
      allOf:
        - $ref: 'govway_rs-api_config-commons.yaml#/components/schemas/ApiBase'
        - type: object
          required:
            - profilo
            - soggetto
          properties:
            profilo:
               $ref: 'govway_core.yaml#/components/schemas/ProfiloEnum'
            soggetto: 
               $ref: 'govway_core.yaml#/components/schemas/SimpleName'

    ApiInterfacciaRest:
      type: object
      required:
        - protocollo
        - formato
      properties:
        protocollo:
          $ref: '#/components/schemas/TipoApiEnum'
        formato:
          $ref: '#/components/schemas/FormatoRestEnum'
    ApiInterfacciaSoap:
      type: object
      required:
        - protocollo
        - formato
      properties:
        protocollo:
          $ref: '#/components/schemas/TipoApiEnum'
        formato:
          $ref: '#/components/schemas/FormatoSoapEnum'

    # ModI Configurazione
    ApiModI:
      type: object
      required:
        - sicurezza_canale
        - sicurezza_messaggio
      properties:
        sicurezza_canale:
           $ref: '#/components/schemas/ApiModISicurezzaCanale'
        sicurezza_messaggio:
           $ref: '#/components/schemas/ApiModISicurezzaMessaggio'
    ApiModISicurezzaCanale:
      type: object
      required:
        - pattern
      properties:
        pattern:
           $ref: '#/components/schemas/ModISicurezzaCanaleEnum'
    ApiModISicurezzaMessaggio:
      type: object
      required:
        - pattern
      properties:
        pattern:
           $ref: '#/components/schemas/ModISicurezzaMessaggioEnum'
        generazione_token:
           $ref: '#/components/schemas/ModISicurezzaMessaggioGenerazioneTokenEnum'
        digest_richiesta:
          type: boolean
          default: false
        informazioni_utente:
          type: boolean
          default: false
        pattern_audit:
           $ref: '#/components/schemas/ModISicurezzaMessaggioPatternAuditEnum'
        schema_audit: 
          type: string
          maxLength: 255
        rest_header: 
           $ref: '#/components/schemas/ModISicurezzaMessaggioRestHeaderEnum'
        rest_header_custom: 
          type: string
          maxLength: 255
        soap_firma_allegati:
          type: boolean
          default: false
        applicabilita: 
           $ref: '#/components/schemas/ModISicurezzaMessaggioApplicabilitaEnum' 
        applicabilita_custom:
          $ref: '#/components/schemas/ApiModISicurezzaMessaggioApplicabilitaCustom'
    ApiModISicurezzaMessaggioApplicabilitaCustom:
      type: object
      required:
        - applicabilita
        - richiesta
        - risposta
      properties:
        applicabilita: 
           $ref: '#/components/schemas/ModISicurezzaMessaggioApplicabilitaEnum'
        richiesta:
           $ref: '#/components/schemas/ModISicurezzaMessaggioApplicabilitaCustomEnum'
        richiesta_content_type:
          type: string
          maxLength: 4000
        risposta:
           $ref: '#/components/schemas/ModISicurezzaMessaggioApplicabilitaCustomEnum'  
        risposta_content_type:
          type: string
          maxLength: 4000
        risposta_codice:
          type: string
          maxLength: 4000
    ApiModIPatternInterazione:
      type: object
      required:
        - pattern
      properties:
        pattern:
           $ref: '#/components/schemas/ModIPatternInterazioneEnum'
        tipo:
           $ref: '#/components/schemas/ModIPatternInterazioneTipoEnum'
        funzione:
           $ref: '#/components/schemas/ModIPatternInterazioneFunzioneEnum'
    ApiModIPatternInterazioneRest:
      type: object
      allOf:
        - $ref: '#/components/schemas/ApiModIPatternInterazione'
        - type: object
          properties:
            risorsa_correlata:
              $ref: '#/components/schemas/ApiModIPatternInterazioneCorrelazioneRest'         
    ApiModIPatternInterazioneSoap:
      type: object
      allOf:
        - $ref: '#/components/schemas/ApiModIPatternInterazione'
        - type: object
          properties:
            azione_correlata:
              $ref: '#/components/schemas/ApiModIPatternInterazioneCorrelazioneSoap'          
    ApiModIPatternInterazioneCorrelazioneRest:
      type: object
      required:
        - api_nome
        - api_versione        
      properties:
        api_nome:
          $ref: 'govway_core.yaml#/components/schemas/NCName'
        api_versione:
          $ref: 'govway_core.yaml#/components/schemas/Versione'
        risorsa_http_method:
          $ref: 'govway_rs-api_config-commons.yaml#/components/schemas/HttpMethodEnum'
        risorsa_path:
          type: string
          maxLength: 255
          example: '/libri'         
    ApiModIPatternInterazioneCorrelazioneSoap:
      type: object
      required:
        - api_nome
        - api_versione 
        - servizio       
      properties:
        api_nome:
          $ref: 'govway_core.yaml#/components/schemas/NCName'
        api_versione:
          $ref: 'govway_core.yaml#/components/schemas/Versione'
        servizio:
          $ref: 'govway_core.yaml#/components/schemas/NCName'
        azione:
          $ref: 'govway_core.yaml#/components/schemas/NCName'
    ApiModIRisorsaRest:
      type: object
      required:
        - interazione
        - sicurezza_messaggio
      properties:
        interazione:
           $ref: '#/components/schemas/ApiModIPatternInterazioneRest'
        sicurezza_messaggio:
           type: object
           oneOf:
            - $ref: '#/components/schemas/ApiModISicurezzaMessaggioOperazione'
            - $ref: '#/components/schemas/ApiModISicurezzaMessaggioOperazioneRidefinito'
           discriminator:
             propertyName: stato
             mapping:
              'api': '#/components/schemas/ApiModISicurezzaMessaggioOperazione'
              'ridefinito': '#/components/schemas/ApiModISicurezzaMessaggioOperazioneRidefinito'
    ApiModIAzioneSoap:
      type: object
      required:
        - interazione
        - sicurezza_messaggio
      properties:
        interazione:
           $ref: '#/components/schemas/ApiModIPatternInterazioneSoap'
        sicurezza_messaggio:
          type: object
          oneOf:
            - $ref: '#/components/schemas/ApiModISicurezzaMessaggioOperazione'
            - $ref: '#/components/schemas/ApiModISicurezzaMessaggioOperazioneRidefinito'
          discriminator:
            propertyName: stato
            mapping:
              'api': '#/components/schemas/ApiModISicurezzaMessaggioOperazione'
              'ridefinito': '#/components/schemas/ApiModISicurezzaMessaggioOperazioneRidefinito'
    ApiModISicurezzaMessaggioOperazione:
      type: object
      required:
        - stato
      properties:
        stato:
           $ref: '#/components/schemas/ModISicurezzaMessaggioOperazioneEnum'
    ApiModISicurezzaMessaggioOperazioneRidefinito:
      type: object
      required:
        - stato
        - configurazione
      properties:
        stato:
           $ref: '#/components/schemas/ModISicurezzaMessaggioOperazioneEnum'
        configurazione:
           $ref: '#/components/schemas/ApiModISicurezzaMessaggio'

    # Base: Credenziali
    AuthenticationHttpBasic:
      type: object
      required:
        - modalita_accesso
        - username
      properties:
        modalita_accesso:
          $ref: '#/components/schemas/ModalitaAccessoEnum'
        username:
          type: string
          maxLength: 2800
          example: 'user'
        password:
          type: string
          format: password
          maxLength: 255
          example: 'pwd'
      additionalProperties: false   
    AuthenticationHttps:
      type: object
      required:
         - modalita_accesso
         - certificato
      properties:
        modalita_accesso:
          $ref: '#/components/schemas/ModalitaAccessoEnum'
        certificato:
          type: object
          oneOf:
            - $ref: '#/components/schemas/AuthenticationHttpsCertificato'
            - $ref: '#/components/schemas/AuthenticationHttpsConfigurazioneManuale'
          discriminator:
            propertyName: tipo
            mapping:
              'certificato': '#/components/schemas/AuthenticationHttpsCertificato'
              'configurazione-manuale': '#/components/schemas/AuthenticationHttpsConfigurazioneManuale'
        certificati:
          type: array
          items:
              $ref: '#/components/schemas/AuthenticationHttpsBaseCertificato'
        token:
              $ref: '#/components/schemas/AuthenticationTokenBase'
      additionalProperties: false
    AuthenticationHttpsBaseCertificato:
      type: object
      required:
        - archivio
        - tipo_certificato
      properties: 
        archivio:
          type: string
          format: byte
        alias: 
          type: string
          maxLength: 255
          example: 'alias'
        password: 
          type: string
          maxLength: 255
          example: 'changeit'
        tipo_certificato: 
          $ref: '#/components/schemas/TipoKeystore'  
        strict_verification:
          type: boolean
          example: false
          default: false
    AuthenticationHttpsCertificato:
      allOf:
        - $ref: '#/components/schemas/AuthenticationHttpsBaseCertificato'
        - type: object
          required:
            - tipo
          properties:
            tipo: 
              $ref: '#/components/schemas/TipoAutenticazioneHttps'
    AuthenticationHttpsConfigurazioneManuale:
      type: object
      required:
        - tipo
        - subject
      properties:
        tipo: 
          $ref: '#/components/schemas/TipoAutenticazioneHttps'
        subject: 
          type: string
          maxLength: 2800
          example: 'cn=esterno'
        issuer: 
          type: string
          maxLength: 2800
          example: 'cn=esterno'
      additionalProperties: false
    AuthenticationPrincipal:
      type: object
      required:
       - modalita_accesso
       - userid
      properties:
        modalita_accesso:
          $ref: '#/components/schemas/ModalitaAccessoEnum'
        userid:
          type: string
          maxLength: 2800
          example: 'idEsterno'
      additionalProperties: false
    AuthenticationApiKey:
      type: object
      required:
       - modalita_accesso
      properties:
        modalita_accesso:
          $ref: '#/components/schemas/ModalitaAccessoEnum'
        app_id:
          type: boolean
          default: false
      additionalProperties: false   
    AuthenticationTokenBase:
      type: object
      required:
       - token_policy
       - identificativo
      properties:
        token_policy:
          type: string
          maxLength: 255
        identificativo:
          type: string
          maxLength: 2800
    AuthenticationToken:
      type: object
      allOf:
        - $ref: '#/components/schemas/AuthenticationTokenBase'
        - type: object
          required: 
            - modalita_accesso
          properties:
            modalita_accesso:
              $ref: '#/components/schemas/ModalitaAccessoEnum' 
    BaseCredenziali:
      type: object
      properties:
        credenziali:
          type: object
          oneOf:
            - $ref: '#/components/schemas/AuthenticationHttpBasic'
            - $ref: '#/components/schemas/AuthenticationHttps'
            - $ref: '#/components/schemas/AuthenticationPrincipal'
            - $ref: '#/components/schemas/AuthenticationApiKey'
            - $ref: '#/components/schemas/AuthenticationToken'
          discriminator:
            propertyName: modalita_accesso
            mapping:
              'http-basic': '#/components/schemas/AuthenticationHttpBasic'
              'https': '#/components/schemas/AuthenticationHttps'
              'principal': '#/components/schemas/AuthenticationPrincipal'
              'api-key': '#/components/schemas/AuthenticationApiKey'
              'token': '#/components/schemas/AuthenticationToken'

    # Base: Store (i tipi di keystore vengono definiti dove viene esteso l'oggetto)
    BaseTrustStore:
      type: object
      required: 
        - truststore_path
        - truststore_password
      properties:
        truststore_path:
          type: string
          maxLength: 4000
          example: '/path/to/truststore'
        truststore_password:
          type: string
          format: password
          # Encrypted maxLength: 255
          example: 'pwd'
        truststore_crl:
          type: string
          maxLength: 4000
        truststore_ocsp_policy:
          type: string
          maxLength: 255
    BaseKeyStore:
      type: object
      required: 
        - keystore_password
        - key_password
      properties:
        keystore_password:
          type: string
          format: password
          # Encrypted maxLength: 255
          example: 'pwd'
        key_password:
          type: string
          format: password
          # Encrypted maxLength: 255
          description: password della chiave privata
          example: 'pwd'
        key_alias:
          type: string
          maxLength: 255
          description: alias della chiave privata
          example: 'pwd'
        keystore_byok_policy:
          type: string
          maxLength: 255
    BaseKeyStoreFile:
      type: object
      allOf:
        - $ref: '#/components/schemas/BaseKeyStore'
        - type: object
          required: 
            - keystore_path
          properties:
            keystore_path:
              type: string
              maxLength: 4000
              example: '/path/to/keystore'
    BaseKeyStoreArchive:
      type: object
      allOf:
        - $ref: '#/components/schemas/BaseKeyStore'
        - type: object
          required: 
            - keystore_archivio
          properties:
            keystore_archivio:
              type: string
              format: byte

    # Base: Connettore 
    ConnettoreConfigurazioneHttpBasic:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          maxLength: 255
          example: 'user'
        password:
          type: string
          format: password
          # Encrypted maxLength: 255
          example: 'pwd'
      additionalProperties: false
    ConnettoreConfigurazioneApiKey:
      type: object
      required:
        - api_key
      properties:
        api_key:
          type: string
        api_key_header:
          type: string
          maxLength: 255
        app_id:
          type: string
        app_id_header:
          type: string
          maxLength: 255
      additionalProperties: false     
    ConnettoreConfigurazioneHttps:
      type: object
      required: 
        - tipologia
      properties:
        tipologia:
          $ref: '#/components/schemas/SslTipologiaEnum'
        hostname_verifier:
          type: boolean
          example: false
          default: true
        trust_all_server_certs:
          type: boolean
          example: false
          default: false
        server:
          $ref: '#/components/schemas/ConnettoreConfigurazioneHttpsServer'
        client: 
          $ref: '#/components/schemas/ConnettoreConfigurazioneHttpsClient'
    ConnettoreConfigurazioneHttpsServer:
      type: object
      allOf:
        - $ref: '#/components/schemas/BaseTrustStore'
        - type: object
          required: 
          - truststore_tipo
          properties:
            truststore_tipo:
              $ref: '#/components/schemas/KeystoreEnum'
            algoritmo:
              type: string
              maxLength: 255
              example: 'PKIX'
              default: 'PKIX'
            pcks11_tipo:
              type: string
              maxLength: 255
    ConnettoreConfigurazioneHttpsClient:
      type: object
      allOf:
        - $ref: '#/components/schemas/BaseKeyStoreFile'
        - type: object
          required: 
            - keystore_tipo
          properties:
            keystore_tipo:
              $ref: '#/components/schemas/KeystoreEnum'
            algoritmo:
              type: string
              maxLength: 255
              example: 'SunX509'
              default: 'SunX509'
            pcks11_tipo:
              type: string
              maxLength: 255
    ConnettoreConfigurazioneProxy:
      type: object
      required: 
        - hostname
        - porta
      properties:
        hostname:
          type: string
          format: hostname
          maxLength: 255
          example: 'proxy.ente.it'
        porta:
          type: integer
          format: int32
          minimum: 1
          maximum: 65535
          example: 8080
        username:
          type: string
          maxLength: 255
          example: 'user'
        password:
          type: string
          # Encrypted maxLength: 255
          format: password
          example: 'pwd'
    ConnettoreConfigurazioneTimeout:
      type: object
      required: 
        - connection_timeout
        - connection_read_timeout
        - tempo_medio_risposta
      properties:
        connection_timeout:
          type: integer
          format: int32
          example: 10000
          description: tempo massimo (in millisecondi) per instaurare una connessione
        connection_read_timeout:
          type: integer
          format: int32
          example: 150000
          description: tempo massimo (in millisecondi) per ricevere una risposta
        tempo_medio_risposta:
          type: integer
          format: int32
          example: 10000
          description: tempo medio (in millisecondi) atteso per ricevere una risposta
          
    # HTTP e Backward Compatibility
    BaseConnettoreHttp:
      type: object
      required:
        - endpoint
      properties:
        endpoint:
          type: string
          format: uri
          maxLength: 4000
          example: 'http://ente.it/servizio'
        autenticazione_http:
          $ref: '#/components/schemas/ConnettoreConfigurazioneHttpBasic'
        autenticazione_apikey:
          $ref: '#/components/schemas/ConnettoreConfigurazioneApiKey'
        autenticazione_https:
          $ref: '#/components/schemas/ConnettoreConfigurazioneHttps'
        proxy:
          $ref: '#/components/schemas/ConnettoreConfigurazioneProxy'
        tempi_risposta:
          $ref: '#/components/schemas/ConnettoreConfigurazioneTimeout'
        token_policy:
          $ref: 'govway_core.yaml#/components/schemas/NCName'
        debug:
          type: boolean
          default: false   
    ConnettoreHttp:
      type: object
      allOf:
        - $ref: '#/components/schemas/BaseConnettoreHttp'
        - type: object
          required:
          - tipo 
          properties:
            tipo:
              $ref: '#/components/schemas/ConnettoreEnum'

    # ConnettoreFile
    ConnettoreFile:
      type: object
      required:
        - tipo 
        - richiesta
      properties:
        tipo:
          $ref: '#/components/schemas/ConnettoreEnum'
        debug:
          type: boolean
          default: false
        richiesta:
          $ref: '#/components/schemas/ConnettoreFileRichiesta'
        risposta:
          $ref: '#/components/schemas/ConnettoreFileRisposta'      
    ConnettoreFileRichiesta:
      type: object
      required:
        - file
      properties:
        file:
          type: string
          maxLength: 4000
        file_permissions:
          type: string
          maxLength: 255
        file_headers:
          type: string
          maxLength: 4000
        file_headers_permissions:
          type: string
          maxLength: 255
        create_parent_dir:
          type: boolean
          default: false
        overwrite_if_exists:
          type: boolean
          default: false
    ConnettoreFileRisposta:
      type: object
      required:
        - file
      properties:
        file:
          type: string
          maxLength: 4000
        file_headers:
          type: string
          maxLength: 4000
        delete_after_read:
          type: boolean
          default: false
        wait_if_not_exists_ms:
          type: integer
          format: int32     

    # ConnettoreJms
    ConnettoreJms:
      type: object
      required:
        - tipo 
        - nome
        - tipo_coda
        - send_as
        - connection_factory
      properties:
        tipo:
          $ref: '#/components/schemas/ConnettoreEnum'
        debug:
          type: boolean
          default: false
        nome:
          type: string
          maxLength: 255
        tipo_coda:
          $ref: '#/components/schemas/ConnettoreJmsTipoEnum'
        send_as:
          $ref: '#/components/schemas/ConnettoreJmsSendAsEnum'
        connection_factory:
          type: string
          maxLength: 255
        utente:
          type: string
          maxLength: 255
        password:
          type: string
          # Encrypted maxLength: 255
        jndi_initial_context:
          type: string
          maxLength: 255
        jndi_url_pgk_prefixes:
          type: string
          maxLength: 255          
        jndi_provider_url:
          type: string
          maxLength: 255

    # ConnettoreNull
    ConnettoreNull:
      type: object
      required:
        - tipo 
      properties:
        tipo:
          $ref: '#/components/schemas/ConnettoreEnum'
        debug:
          type: boolean
          default: false

    # ConnettoreEcho
    ConnettoreEcho:
      type: object
      required:
        - tipo 
      properties:
        tipo:
          $ref: '#/components/schemas/ConnettoreEnum'
        debug:
          type: boolean
          default: false
          
    # ConnettoreStatus
    ConnettoreStatus:
      type: object
      required:
        - tipo 
        - risposta
      properties:
        tipo:
          $ref: '#/components/schemas/ConnettoreEnum'
        risposta:
          $ref: '#/components/schemas/TipoRispostaStatusEnum'
        verifica_connettivita:
           type: boolean
           default: false
        verifica_statistica:
          $ref: '#/components/schemas/ConnettoreStatusVerificaStatistica'
        debug:
          type: boolean
          default: false
    ConnettoreStatusVerificaStatistica:
       type: object
       description: 'parametri di un periodo statistico per il connettore status'
       required:
          - frequenza
          - intervallo
       properties:
          frequenza:
             $ref: '#/components/schemas/TipoPeriodoStatisticoEnum'
          intervallo:
             type: integer
             format: int32
             min: 1
          cache_life_time:
             description: 'tempo di permanenza in cache di un risultato, se non impostato viene usato il tempo di default della cache del controllo traffico'
             type: integer
             format: int32
             min: 1          

    # ConnettorePlugin
    ConnettorePlugin:
      type: object
      required:
        - tipo 
        - plugin
      properties:
        tipo:
          $ref: '#/components/schemas/ConnettoreEnum'
        debug:
          type: boolean
          default: false
        plugin:
          type: string
          maxLength: 255
        proprieta:        
          type: array
          items:
            $ref: '#/components/schemas/Proprieta'          

    # ConnettoreApplicativoServer
    ConnettoreApplicativoServer:
      type: object
      required:
        - tipo
        - applicativo 
      properties:
        tipo:
          $ref: '#/components/schemas/ConnettoreEnum'
        applicativo:
          $ref: 'govway_core.yaml#/components/schemas/NCName'
 
     # ConnettoreMessageBox
    ConnettoreMessageBox:
      type: object
      required:
        - tipo
        - autenticazione_http 
      properties:
        tipo:
          $ref: '#/components/schemas/ConnettoreEnum'
        autenticazione_http:
          $ref: '#/components/schemas/ConnettoreConfigurazioneHttpBasic'

    ConnettoreErogazione:
      type: object
      properties:
          # obbligatorio fornire o un connettore o un connettore-multiplo
          connettore:
             type: object
             oneOf:
               - $ref: '#/components/schemas/ConnettoreHttp' 
               - $ref: '#/components/schemas/ConnettoreFile'
               - $ref: '#/components/schemas/ConnettoreJms'
               - $ref: '#/components/schemas/ConnettoreNull'
               - $ref: '#/components/schemas/ConnettoreEcho'
               - $ref: '#/components/schemas/ConnettoreStatus'
               - $ref: '#/components/schemas/ConnettorePlugin'
               - $ref: '#/components/schemas/ConnettoreApplicativoServer'
               - $ref: '#/components/schemas/ConnettoreMessageBox'
             discriminator:
               propertyName: tipo
               mapping:
                 'http': '#/components/schemas/ConnettoreHttp'
                 'file': '#/components/schemas/ConnettoreFile'
                 'jms': '#/components/schemas/ConnettoreJms'
                 'null': '#/components/schemas/ConnettoreNull'
                 'echo': '#/components/schemas/ConnettoreEcho'
                 'status': '#/components/schemas/ConnettoreStatus'
                 'plugin': '#/components/schemas/ConnettorePlugin'
                 'applicativo-server': '#/components/schemas/ConnettoreApplicativoServer'
                 'message-box': '#/components/schemas/ConnettoreMessageBox' 
      additionalProperties: false
                 
    ConnettoreFruizione:
      type: object
      required: 
        - connettore
      properties:
          connettore:
             type: object
             oneOf:
               - $ref: '#/components/schemas/ConnettoreHttp' 
               - $ref: '#/components/schemas/ConnettoreFile'
               - $ref: '#/components/schemas/ConnettoreJms'
               - $ref: '#/components/schemas/ConnettoreNull'
               - $ref: '#/components/schemas/ConnettoreEcho'
               - $ref: '#/components/schemas/ConnettoreStatus'
               - $ref: '#/components/schemas/ConnettorePlugin'
             discriminator:
               propertyName: tipo
               mapping:
                 'http': '#/components/schemas/ConnettoreHttp'
                 'file': '#/components/schemas/ConnettoreFile'
                 'jms': '#/components/schemas/ConnettoreJms'
                 'null': '#/components/schemas/ConnettoreNull'
                 'echo': '#/components/schemas/ConnettoreEcho'
                 'status': '#/components/schemas/ConnettoreStatus'
                 'plugin': '#/components/schemas/ConnettorePlugin'
      additionalProperties: false

          
    # Base: Erogazione/Fruizione

    APIBaseImpl:
      type: object
      required:
        - api_nome
        - api_versione
      properties:
        api_nome:
          $ref: 'govway_core.yaml#/components/schemas/NCName'
        api_versione:
          $ref: 'govway_core.yaml#/components/schemas/Versione'
        api_referente:
          $ref: 'govway_core.yaml#/components/schemas/SimpleName'
        api_soap_servizio:
          $ref: 'govway_core.yaml#/components/schemas/NCName'
        api_tags:
          type: array
          items:
            $ref: 'govway_core.yaml#/components/schemas/NCName'
          example: [PagamentiTelematici, Anagrafica] 
        tipo_servizio:
          $ref: 'govway_core.yaml#/components/schemas/Tipo'
          
    APIImpl:
      type: object
      allOf:
        - $ref: '#/components/schemas/APIBaseImpl'
        - type: object
          required:
            - connettore
          properties:
            autenticazione:
             type: object
             oneOf:
               - $ref: '#/components/schemas/APIImplAutenticazioneDisabilitata' 
               - $ref: '#/components/schemas/APIImplAutenticazioneBasic'
               - $ref: '#/components/schemas/APIImplAutenticazioneHttps'
               - $ref: '#/components/schemas/APIImplAutenticazionePrincipal'
               - $ref: '#/components/schemas/APIImplAutenticazioneApiKey'
             discriminator:
               propertyName: tipo
               mapping:
                 'disabilitato': '#/components/schemas/APIImplAutenticazioneDisabilitata'
                 'http-basic': '#/components/schemas/APIImplAutenticazioneBasic'
                 'https': '#/components/schemas/APIImplAutenticazioneHttps'
                 'principal': '#/components/schemas/APIImplAutenticazionePrincipal'
                 'api-key': '#/components/schemas/APIImplAutenticazioneApiKey'
            autorizzazione:
             type: object
             oneOf:
               - $ref: '#/components/schemas/APIImplAutorizzazioneDisabilitata'
               - $ref: '#/components/schemas/APIImplAutorizzazioneAbilitataNew'
               - $ref: '#/components/schemas/APIImplAutorizzazioneXACML'
             discriminator:
               propertyName: tipo
               mapping:
                 'disabilitato': '#/components/schemas/APIImplAutorizzazioneDisabilitata'
                 'abilitato': '#/components/schemas/APIImplAutorizzazioneAbilitataNew'
                 'xacml-Policy': '#/components/schemas/APIImplAutorizzazioneXACML'
            connettore:
              $ref: '#/components/schemas/BaseConnettoreHttp'

    APIImplAutenticazioneDisabilitata:
      type: object
      required:
        - tipo
      properties:
        tipo:
          $ref: '#/components/schemas/TipoAutenticazioneEnum'
      additionalProperties: false
      
    APIImplAutenticazioneBasic:
      type: object
      required:
        - tipo
      properties:
        tipo:
          $ref: '#/components/schemas/TipoAutenticazioneEnum'
        forward:
          type: boolean
          default: false
          example: false
        opzionale:
          type: boolean
          default: false
          example: false
      additionalProperties: false
      
    APIImplAutenticazioneHttps:
      type: object
      required:
        - tipo
      properties:
        tipo:
          $ref: '#/components/schemas/TipoAutenticazioneEnum'
        opzionale:
          type: boolean
          default: false
          example: false
      additionalProperties: false
      
    APIImplAutenticazionePrincipal:
      type: object
      required:
        - tipo
        - tipo_principal
      properties:
        tipo:
          $ref: '#/components/schemas/TipoAutenticazioneEnum'
        tipo_principal:
          $ref: '#/components/schemas/TipoAutenticazionePrincipal'
        token:
          $ref: '#/components/schemas/TipoAutenticazionePrincipalToken'
        nome:
          type: string
          description: |
            indica il nome dell'header http in caso di autenticazione principal 'header-based', 
            il nome del parametro della query nel caso di autenticazione principal 'form-based' o
            il nome del claim in caso di autenticazione principal 'token' con tipo di claim 'custom'
          maxLength: 255
        pattern:
          type: string
          example: indica l'espressione regolare da utilizzare in caso di autenticazione 'url-based'
        forward:
          type: boolean
          default: false
          example: false
        opzionale:
          type: boolean
          default: false
          example: false
      additionalProperties: false
      
    APIImplAutenticazioneApiKey:
      type: object
      required:
        - tipo
      properties:
        tipo:
          $ref: '#/components/schemas/TipoAutenticazioneEnum'
        app_id:
          type: boolean
          default: false
        posizione:
          $ref: '#/components/schemas/APIImplAutenticazioneApiKeyPosizione'
        api_key_nomi:
          $ref: '#/components/schemas/APIImplAutenticazioneApiKeyConfig'
        app_id_nomi:
          $ref: '#/components/schemas/APIImplAutenticazioneApiKeyConfig'
        api_key_forward:
          type: boolean
          default: false
        app_id_forward:
          type: boolean
          default: false
        opzionale:
          type: boolean
          default: false
      additionalProperties: false
    APIImplAutenticazioneApiKeyPosizione:
      type: object
      properties:
        query_parameter:
          type: boolean
          default: true
        header:
          type: boolean
          default: true
        cookie:
          type: boolean
          default: true
      additionalProperties: false      
    APIImplAutenticazioneApiKeyConfig:
      type: object
      properties:
        query_parameter:
          type: string
          example: custom_key
        header:
          type: string
          example: X-Custom-Key
        cookie:
          type: string
          example: X-Custom-Key
      additionalProperties: false

    APIImplAutenticazioneCustom:
      type: object
      required:
        - tipo
        - nome
      properties:
        tipo:
          $ref: '#/components/schemas/TipoAutenticazioneEnum'
        nome:
          description: nome autenticazione 'custom', set tipo='custom'
          type: string
          maxLength: 255
        opzionale:
          type: boolean
          default: false
          example: false  
      additionalProperties: false 


    APIImplAutorizzazioneDisabilitata:
      type: object
      required:
        - tipo
      properties:
        tipo:
          $ref: '#/components/schemas/TipoAutorizzazioneEnum'
      additionalProperties: false
      
    APIImplAutorizzazioneAbilitataNew:
      type: object
      required:
        - tipo
        - richiedente
        - ruoli
      properties:
        tipo:
          $ref: '#/components/schemas/TipoAutorizzazioneEnum'
        richiedente:
          type: boolean
          default: true
          example: false
        soggetto:
          $ref: 'govway_core.yaml#/components/schemas/SimpleName'
        ruoli:
          type: boolean
          default: false
          example: false
        ruoli_fonte:
          $ref: '#/components/schemas/FonteEnum' 
        ruoli_richiesti:
          $ref: '#/components/schemas/AllAnyEnum'
        ruolo:
          $ref: 'govway_core.yaml#/components/schemas/NCName'
      additionalProperties: false
    APIImplAutorizzazioneAbilitata:
      type: object
      required:
        - tipo
        - richiedente
        - ruoli
        - scope
        - token
      properties:
        tipo:
          $ref: '#/components/schemas/TipoAutorizzazioneEnum'
        richiedente:
          type: boolean
          default: true
          example: false
        ruoli:
          type: boolean
          default: false
          example: false
        ruoli_fonte:
          $ref: '#/components/schemas/FonteEnum' 
        ruoli_richiesti:
          $ref: '#/components/schemas/AllAnyEnum'
        token_richiedente:
          type: boolean
          default: true
          example: false
        token_ruoli:
          type: boolean
          default: false
          example: false
        token_ruoli_fonte:
          $ref: '#/components/schemas/FonteEnum' 
        token_ruoli_richiesti:
          $ref: '#/components/schemas/AllAnyEnum'
        scope:
          type: boolean
          default: false
          example: false
        scope_richiesti:
          $ref: '#/components/schemas/AllAnyEnum' 
        token:
          type: boolean
          default: false
          example: false
        token_claims:
          description: Indicare i claims richiesti (nome=valore); √® possibile elencare differenti valori ammissibili separandoli con la virgola
          type: array
          items:
            type: string
            maxLength: 200 # lista di header arriva a 4000
      additionalProperties: false

    APIImplAutorizzazioneXACMLView:
      type: object
      required:
        - tipo
        - ruoli_fonte
      properties:
        tipo:
          $ref: '#/components/schemas/TipoAutorizzazioneEnum'
        ruoli_fonte:
          $ref: '#/components/schemas/FonteEnum'
      additionalProperties: false                 
    APIImplAutorizzazioneXACML:
      type: object
      required:
        - tipo
        - policy
        - ruoli_fonte
      properties:
        tipo:
          $ref: '#/components/schemas/TipoAutorizzazioneEnum'
        ruoli_fonte:
          $ref: '#/components/schemas/FonteEnum'
        policy:
          type: string
          format: byte
      additionalProperties: false 
      
    APIImplAutorizzazioneCustom:
      type: object
      required:
        - tipo
        - nome
      properties:
        tipo:
          $ref: '#/components/schemas/TipoAutorizzazioneEnum'
        nome:
          type: string
          maxLength: 255  
      additionalProperties: false 


    ApiImplItem:
      type: object
      allOf:
        - $ref: 'govway_core.yaml#/components/schemas/BaseSoggettoItem'
        - $ref: '#/components/schemas/APIBaseImpl'
        - type: object
          required:
            - nome
            - versione
            - stato
            - stato_descrizione
          properties:
            nome:
              $ref: 'govway_core.yaml#/components/schemas/NCName'
            versione:
              $ref: 'govway_core.yaml#/components/schemas/Versione'
            api_tipo:
              $ref: '#/components/schemas/TipoApiEnum'
            stato:
              $ref: '#/components/schemas/StatoApiEnum'
            stato_descrizione:
              $ref: '#/components/schemas/StatoApiDescrizione'
            canale:
              $ref: '#/components/schemas/ApiCanale'
                 
    ApiImplViewItem:
      type: object
      allOf:
        - $ref: '#/components/schemas/ApiImplItem'
        - type: object
          required:
            - url_invocazione
            - connettore
            - gestione_cors
          properties:
            url_invocazione:
              type: string
              format: uri
            connettore:
              type: string    
            gestione_cors:
              type: string 
          
    ApiImplInformazioniGenerali:
      type: object
      required:
        - nome
      properties:
        tipo:
          $ref: 'govway_core.yaml#/components/schemas/Tipo'
        nome:
          $ref: 'govway_core.yaml#/components/schemas/NCName'
        api_soap_servizio:
          $ref: 'govway_core.yaml#/components/schemas/NCName'
    ApiImplInformazioniGeneraliView:
      type: object
      allOf:
          - $ref: 'govway_core.yaml#/components/schemas/BaseItem'
          - $ref: '#/components/schemas/ApiImplInformazioniGenerali'
  
    ApiImplVersioneApi:
      type: object
      required:
        - api_versione
      properties:
        api_versione:
          $ref: 'govway_core.yaml#/components/schemas/Versione'
    ApiImplVersioneApiView:
      type: object
      allOf:
          - $ref: 'govway_core.yaml#/components/schemas/BaseSoggettoItem'
          - $ref: '#/components/schemas/APIBaseImpl'
          - type: object
            required:
              - versioni
            properties:
              versioni:
                type: array
                items:
                  $ref: 'govway_core.yaml#/components/schemas/Versione'
                example: [1, 2, 3] 

    ApiImplUrlInvocazione:
      type: object
      required:
        - modalita
      properties:
        modalita:
          $ref: '#/components/schemas/ModalitaIdentificazioneAzioneEnum'
        pattern:
            description: XPath/JsonPath nel caso di modalit√† 'content-based' o espressione regolare nel caso 'url-based'
            type: string
            maxLength: 255 
        nome:
            description: Nome dell'header http nel caso di modalit√† 'header-based' o nome dell'unica azione in caso di modalit√† 'static'
            type: string
            maxLength: 255 
        force_interface:
            description: Indicazione se oltre alla modalit√† indicata per individuare l'azione viene usata comunque la modalit√† 'interface-based'
            type: boolean
            default: true 
    ApiImplUrlInvocazioneView:
      type: object
      allOf:
          - $ref: '#/components/schemas/ApiImplUrlInvocazione'      
          - type: object
            required:
              - url_invocazione
            properties:
               url_invocazione:
                  type: string
                  format: uri
               azioni:
                  type: array
                  items:
                    $ref: 'govway_core.yaml#/components/schemas/NCName'
                  example: ['az1', 'az2', 'az3']

    ApiImplAllegato:
      type: object
      required:
        - allegato
      properties:
        allegato:
          type: object
          oneOf:
            - $ref: '#/components/schemas/ApiImplAllegatoGenerico'
            - $ref: '#/components/schemas/ApiImplAllegatoSpecificaSemiformale'
            - $ref: '#/components/schemas/ApiImplAllegatoSpecificaSicurezza'
            - $ref: '#/components/schemas/ApiImplAllegatoSpecificaLivelloServizio'
          discriminator:
            propertyName: ruolo
            mapping:
              'allegato': '#/components/schemas/ApiImplAllegatoGenerico'
              'specificaSemiFormale': '#/components/schemas/ApiImplAllegatoSpecificaSemiformale'
              'specificaSicurezza': '#/components/schemas/ApiImplAllegatoSpecificaSicurezza'
              'specificaLivelloServizio': '#/components/schemas/ApiImplAllegatoSpecificaLivelloServizio'
    ApiImplAllegatoGenerico:
      type: object
      required:
        - nome
        - documento
        - ruolo
      properties:
        nome:
          type: string
          # rilassato vincolo, un allegato puo' avere qualsiasi $ref: 'govway_core.yaml#/components/schemas/NCName'
        documento:
          type: string
          format: byte
        ruolo:
          $ref: '#/components/schemas/RuoloAllegatoAPIImpl'
    ApiImplAllegatoSpecificaSemiformale:
      type: object
      allOf:
        - $ref: '#/components/schemas/ApiImplAllegatoGenerico'
        - type: object
          required:
            - tipo_specifica
          properties:
           tipo_specifica:
             $ref: '#/components/schemas/TipoSpecificaSemiformaleEnum'
    ApiImplAllegatoSpecificaSicurezza:
      type: object
      allOf:
        - $ref: '#/components/schemas/ApiImplAllegatoGenerico'
        - type: object
          required:
            - tipo_specifica
          properties:
           tipo_specifica:
             $ref: '#/components/schemas/TipoSpecificaSicurezzaEnum'
    ApiImplAllegatoSpecificaLivelloServizio:
      type: object
      allOf:
        - $ref: '#/components/schemas/ApiImplAllegatoGenerico'
        - type: object
          required:
            - tipo_specifica
          properties:
           tipo_specifica:
             $ref: '#/components/schemas/TipoSpecificaLivelloServizioEnum'

    ApiImplAllegatoItem:
      type: object
      required:
        - allegato
      properties:
        allegato:
          type: object
          oneOf:
            - $ref: '#/components/schemas/ApiImplAllegatoItemGenerico'
            - $ref: '#/components/schemas/ApiImplAllegatoItemSpecificaSemiformale'
            - $ref: '#/components/schemas/ApiImplAllegatoItemSpecificaSicurezza'
            - $ref: '#/components/schemas/ApiImplAllegatoItemSpecificaLivelloServizio'
          discriminator:
            propertyName: ruolo
            mapping:
              'allegato': '#/components/schemas/ApiImplAllegatoItemGenerico'
              'specificaSemiFormale': '#/components/schemas/ApiImplAllegatoItemSpecificaSemiformale'
              'specificaSicurezza': '#/components/schemas/ApiImplAllegatoItemSpecificaSicurezza'
              'specificaLivelloServizio': '#/components/schemas/ApiImplAllegatoItemSpecificaLivelloServizio'
    ApiImplAllegatoItemGenerico:
      type: object
      required:
        - nome
        - ruolo
      properties:
        nome:
          type: string
          # rilassato vincolo, un allegato puo' avere qualsiasi $ref: 'govway_core.yaml#/components/schemas/NCName'            
        ruolo:
          $ref: '#/components/schemas/RuoloAllegatoAPIImpl'
    ApiImplAllegatoItemSpecificaSemiformale:
      type: object
      allOf:
        - $ref: '#/components/schemas/ApiImplAllegatoItemGenerico'
        - type: object
          required:
            - tipo_specifica
          properties:
           tipo_specifica:
             $ref: '#/components/schemas/TipoSpecificaSemiformaleEnum'
    ApiImplAllegatoItemSpecificaSicurezza:
      type: object
      allOf:
        - $ref: '#/components/schemas/ApiImplAllegatoItemGenerico'
        - type: object
          required:
            - tipo_specifica
          properties:
           tipo_specifica:
             $ref: '#/components/schemas/TipoSpecificaSicurezzaEnum'
    ApiImplAllegatoItemSpecificaLivelloServizio:
      type: object
      allOf:
        - $ref: '#/components/schemas/ApiImplAllegatoItemGenerico'
        - type: object
          required:
            - tipo_specifica
          properties:
           tipo_specifica:
             $ref: '#/components/schemas/TipoSpecificaLivelloServizioEnum'             

    ListaApiImplAllegati:
       type: object
       allOf:
          - $ref: 'govway_core.yaml#/components/schemas/Lista'
          - type: object
            required:
              - items
            properties:
              items:
                type: array
                items:
                  $ref: '#/components/schemas/ApiImplAllegatoItem'

    # ModI Erogazione
    ErogazioneModI:
      type: object
      required:
        - modi
      properties:
        modi:
          oneOf:
          - $ref: '#/components/schemas/ErogazioneModISoap'
          - $ref: '#/components/schemas/ErogazioneModIRest'
          discriminator:
            propertyName: protocollo
            mapping:
              'soap': '#/components/schemas/ErogazioneModISoap'
              'rest': '#/components/schemas/ErogazioneModIRest'      
      
    # ModI Erogazione SOAP
    ErogazioneModISoap:
      type: object      
      required:
        - protocollo
      properties:
        protocollo:
           $ref: '#/components/schemas/TipoApiEnum'
        richiesta:
           $ref: '#/components/schemas/ErogazioneModISoapRichiesta'
        risposta:
           $ref: '#/components/schemas/ErogazioneModISoapRisposta'
        informazioni_generali:
           $ref: '#/components/schemas/ErogazioneModIInfoGenerali'
    ErogazioneModISoapRichiesta:
      type: object      
      required:
        - sicurezza_messaggio
      properties:
        sicurezza_messaggio:
           $ref: '#/components/schemas/ErogazioneModISoapRichiestaSicurezzaMessaggio'
    ErogazioneModISoapRichiestaSicurezzaMessaggio:
      type: object      
      required:
        - truststore
      properties:
        truststore:
          type: object
          oneOf:
            - $ref: '#/components/schemas/ModITrustStoreDefault'
            - $ref: '#/components/schemas/ModITrustStoreRidefinito'
          discriminator:
            propertyName: modalita
            mapping:
              'default': '#/components/schemas/ModITrustStoreDefault'
              'ridefinito': '#/components/schemas/ModITrustStoreRidefinito'
        time_to_live:
          type: integer
          format: int32
        wsa_to:
          type: string
          maxLength: 4000
        audit:
          $ref: '#/components/schemas/BaseModIRichiestaInformazioniUtenteAudit'
    ErogazioneModISoapRisposta:
      type: object      
      required:
        - sicurezza_messaggio
      properties:
        sicurezza_messaggio:
           $ref: '#/components/schemas/ErogazioneModISoapRispostaSicurezzaMessaggio'
    ErogazioneModISoapRispostaSicurezzaMessaggio:
      type: object      
      required:
        - keystore
      properties:
        algoritmo:
          $ref: '#/components/schemas/ModISicurezzaMessaggioSoapAlgoritmoFirma'
        header_soap_firmare:
          type: array
          items:
            type: string
            maxLength: 200 # lista di header arriva a 4000 
        forma_canonica_xml:
          $ref: '#/components/schemas/ModISicurezzaMessaggioSoapFormaCanonicaXml'
        riferimento_x509:
          $ref: '#/components/schemas/ModISicurezzaMessaggioSoapRiferimentoX509'
        certificate_chain:
          type: boolean
        includi_signature_token:
          type: boolean      
        keystore:
          type: object
          oneOf:
            - $ref: '#/components/schemas/ModIKeyStoreDefault'
            - $ref: '#/components/schemas/ModIKeyStoreRidefinito'
          discriminator:
            propertyName: modalita
            mapping:
              'default': '#/components/schemas/ModIKeyStoreDefault'
              'ridefinito': '#/components/schemas/ModIKeyStoreRidefinito'
        time_to_live:
          type: integer
          format: int32
          default: 300

    # ModI Erogazione REST
    ErogazioneModIRest:
      type: object      
      required:
        - protocollo
      properties:
        protocollo:
           $ref: '#/components/schemas/TipoApiEnum'
        richiesta:
           $ref: '#/components/schemas/ErogazioneModIRestRichiesta'
        risposta:
           $ref: '#/components/schemas/ErogazioneModIRestRisposta'
        informazioni_generali:
           $ref: '#/components/schemas/ErogazioneModIInfoGenerali'
    ErogazioneModIRestRichiesta:
      type: object      
      required:
        - sicurezza_messaggio
      properties:
        sicurezza_messaggio:
           $ref: '#/components/schemas/ErogazioneModIRestRichiestaSicurezzaMessaggio'
    ErogazioneModIRestRichiestaSicurezzaMessaggio:
      type: object      
      required:
        - riferimento_x509
        - truststore
      properties:
        riferimento_x509:
          type: array
          items:
            $ref: '#/components/schemas/ModISicurezzaMessaggioRestRiferimentoX509'
          minItems: 1
          maxItems: 3
        truststore:
          type: object
          oneOf:
            - $ref: '#/components/schemas/ModITrustStoreDefault'
            - $ref: '#/components/schemas/ModITrustStoreRidefinito'
          discriminator:
            propertyName: modalita
            mapping:
              'default': '#/components/schemas/ModITrustStoreDefault'
              'ridefinito': '#/components/schemas/ModITrustStoreRidefinito'
        truststore_ssl: # x5u
          type: object
          oneOf:
            - $ref: '#/components/schemas/ModITrustStoreDefault'
            - $ref: '#/components/schemas/ModITrustStoreRidefinito'
          discriminator:
            propertyName: modalita
            mapping:
              'default': '#/components/schemas/ModITrustStoreDefault'
              'ridefinito': '#/components/schemas/ModITrustStoreRidefinito'
        time_to_live:
          type: integer
          format: int32
        audience:
          type: string
          maxLength: 4000
        contemporaneita:
           $ref: '#/components/schemas/ErogazioneModIRestRichiestaSicurezzaMessaggioContemporaneita'
        audit:
          $ref: '#/components/schemas/BaseModIRichiestaInformazioniUtenteAudit'
    ErogazioneModIRestRichiestaSicurezzaMessaggioContemporaneita:
      type: object      
      required:
        - identificativo
        - audience
      properties:
        identificativo:
           $ref: '#/components/schemas/ModISicurezzaMessaggioRestTokenChoiseEnum'
        audience:
           $ref: '#/components/schemas/ModISicurezzaMessaggioRestSameDifferentEnum'
        audience_atteso:
           type: string
           maxLength: 4000      
    ErogazioneModIRestRisposta:
      type: object      
      required:
        - sicurezza_messaggio
      properties:
        sicurezza_messaggio:
           $ref: '#/components/schemas/ErogazioneModIRestRispostaSicurezzaMessaggio'
    ErogazioneModIRestRispostaSicurezzaMessaggio:
      type: object      
      required:
        - keystore
      properties:
        algoritmo:
          $ref: '#/components/schemas/ModISicurezzaMessaggioRestAlgoritmoFirma'
        header_http_firmare:
          type: array
          items:
            type: string
            maxLength: 200 # lista di header arriva a 4000 
        riferimento_x509:
          $ref: '#/components/schemas/ModISicurezzaMessaggioRestRiferimentoX509Risposta'
        riferimento_x509_risposta:
          type: array
          items:
            $ref: '#/components/schemas/ModISicurezzaMessaggioRestRiferimentoX509'
          minItems: 1
          maxItems: 3
        certificate_chain:
          type: boolean
        url:
          type: string
          maxLength: 4000      
        keystore:
          type: object
          oneOf:
            - $ref: '#/components/schemas/ModIKeyStoreDefault'
            - $ref: '#/components/schemas/ModIKeyStoreRidefinito'
          discriminator:
            propertyName: modalita
            mapping:
              'default': '#/components/schemas/ModIKeyStoreDefault'
              'ridefinito': '#/components/schemas/ModIKeyStoreRidefinito'
        time_to_live:
          type: integer
          format: int32
          default: 300
        claims:
          description: Indicare i claims richiesti (nome=valore); √® possibile elencare differenti valori ammissibili separandoli con la virgola
          type: array
          items:
            type: string
            maxLength: 200 # lista di header arriva a 4000
        contemporaneita:
           $ref: '#/components/schemas/ErogazioneModIRestRispostaSicurezzaMessaggioContemporaneita'
    ErogazioneModIRestRispostaSicurezzaMessaggioContemporaneita:
      type: object      
      required:
        - identificativo
      properties:
        identificativo:
           $ref: '#/components/schemas/ModISicurezzaMessaggioRestSameDifferentEnum'
        usa_come_id_messaggio:
           $ref: '#/components/schemas/ModISicurezzaMessaggioRestTokenChoiseEnum'
        claims_bearer:
           description: Indicare i claims richiesti (nome=valore); √® possibile elencare differenti valori ammissibili separandoli con la virgola
           type: array
           items:
             type: string
             maxLength: 200 # lista di header arriva a 4000 
        claims_agid:
           description: Indicare i claims richiesti (nome=valore); √® possibile elencare differenti valori ammissibili separandoli con la virgola
           type: array
           items:
             type: string
             maxLength: 200 # lista di header arriva a 4000 
    ErogazioneModIInfoGenerali:
       type: object
       properties:
          service_id:
             type: string
          signal_hub: 
             $ref: '#/components/schemas/ErogazioneModISignalHub'
    ErogazioneModISignalHub:
      required:
        - "risorsa"
        - "algoritmo"
        - "dimensione_seme"
        - "giorni_rotazione"
      type: object
      properties:
         risorsa:
            type: string
            example: "/pseudonymization"
         algoritmo:
            type: string
            example: SHA-256
         dimensione_seme:
            type: integer
            format: int32
            example: 16
         giorni_rotazione:
            type: integer
            format: int32
            example: 15
         applicativo:
            type: string
         ruolo:
            type: string
    # ModI Fruizione
    FruizioneModI:
      type: object
      required:
        - modi
      properties:
        modi:
          oneOf:
          - $ref: '#/components/schemas/FruizioneModIOAuth'
          - $ref: '#/components/schemas/FruizioneModISoap'
          - $ref: '#/components/schemas/FruizioneModIRest'
          discriminator:
            propertyName: protocollo
            mapping:
              'oauth': '#/components/schemas/FruizioneModIOAuth'
              'soap': '#/components/schemas/FruizioneModISoap'
              'rest': '#/components/schemas/FruizioneModIRest' 
      
    # ModI Fruizione OAUTH
    BaseFruizioneModIOAuth:
      type: object
      properties:
        identificativo:
          type: string
          maxLength: 2800
        kid:
          type: string
          maxLength: 4000

    FruizioneModIOAuth:
       type: object
       allOf:
          - $ref: '#/components/schemas/BaseFruizioneModIOAuth'
          - type: object
            required:
              - protocollo
            properties:
              protocollo:
                 $ref: '#/components/schemas/TipoConfigurazioneFruizioneEnum'
              keystore:
                type: object
                oneOf:
                  - $ref: '#/components/schemas/ModIKeyStoreDefault'
                  - $ref: '#/components/schemas/ModIKeyStoreRidefinito'
                discriminator:
                  propertyName: modalita
                  mapping:
                    'default': '#/components/schemas/ModIKeyStoreDefault'
                    'ridefinito': '#/components/schemas/ModIKeyStoreRidefinito'

    # ModI Fruizione SOAP
    FruizioneModISoap:
      type: object      
      required:
        - protocollo
        - richiesta
        - risposta
      properties:
        protocollo:
           $ref: '#/components/schemas/TipoConfigurazioneFruizioneEnum'
        richiesta:
           $ref: '#/components/schemas/FruizioneModISoapRichiesta'
        risposta:
           $ref: '#/components/schemas/FruizioneModISoapRisposta'
    FruizioneModISoapRichiesta:
      type: object      
      required:
        - sicurezza_messaggio
      properties:
        sicurezza_messaggio:
           $ref: '#/components/schemas/FruizioneModISoapRichiestaSicurezzaMessaggio'
        oauth:
           $ref: '#/components/schemas/BaseFruizioneModIOAuth'
    FruizioneModISoapRichiestaSicurezzaMessaggio:
      type: object      
      properties:
        algoritmo:
          $ref: '#/components/schemas/ModISicurezzaMessaggioSoapAlgoritmoFirma'
        forma_canonica_xml:
          $ref: '#/components/schemas/ModISicurezzaMessaggioSoapFormaCanonicaXml'
        header_soap_firmare:
          type: array
          items:
            type: string
            maxLength: 200 # lista di header arriva a 4000 
        riferimento_x509:
          $ref: '#/components/schemas/ModISicurezzaMessaggioSoapRiferimentoX509'
        certificate_chain:
          type: boolean
        keystore:
          type: object
          oneOf:
            - $ref: '#/components/schemas/ModIKeyStoreDefault'
            - $ref: '#/components/schemas/ModIKeyStoreRidefinito'
          discriminator:
            propertyName: modalita
            mapping:
              'default': '#/components/schemas/ModIKeyStoreDefault'
              'ridefinito': '#/components/schemas/ModIKeyStoreRidefinito'
        keystore_token_policy:
          type: boolean
        includi_signature_token:
          type: boolean
        time_to_live:
          type: integer
          format: int32
          default: 300
        wsa_to:
          type: string
          maxLength: 4000
        informazioni_utente_codice_ente:
          $ref: '#/components/schemas/FruizioneModIRichiestaInformazioneUtente'
        informazioni_utente_userid:
          $ref: '#/components/schemas/FruizioneModIRichiestaInformazioneUtente'
        informazioni_utente_indirizzo_ip:
          $ref: '#/components/schemas/FruizioneModIRichiestaInformazioneUtente'
        audit:
          $ref: '#/components/schemas/FruizioneModIRichiestaInformazioniUtenteAudit'
    FruizioneModISoapRisposta:
      type: object      
      required:
        - sicurezza_messaggio
      properties:
        sicurezza_messaggio:
           $ref: '#/components/schemas/FruizioneModISoapRispostaSicurezzaMessaggio'
    FruizioneModISoapRispostaSicurezzaMessaggio:
      type: object      
      required:
        - truststore
      properties:   
        truststore:
          type: object
          oneOf:
            - $ref: '#/components/schemas/ModITrustStoreDefault'
            - $ref: '#/components/schemas/ModITrustStoreRidefinito'
          discriminator:
            propertyName: modalita
            mapping:
              'default': '#/components/schemas/ModITrustStoreDefault'
              'ridefinito': '#/components/schemas/ModITrustStoreRidefinito'
        time_to_live:
          type: integer
          format: int32
        verifica_wsa_to:
          type: boolean
          default: true
        audience_atteso:
           type: string
           maxLength: 4000

    # ModI Fruizione REST
    FruizioneModIRest:
      type: object      
      required:
        - protocollo
        - richiesta
        - risposta
      properties:
        protocollo:
           $ref: '#/components/schemas/TipoConfigurazioneFruizioneEnum'
        richiesta:
           $ref: '#/components/schemas/FruizioneModIRestRichiesta'
        risposta:
           $ref: '#/components/schemas/FruizioneModIRestRisposta'
    FruizioneModIRestRichiesta:
      type: object      
      required:
        - sicurezza_messaggio
      properties:
        sicurezza_messaggio:
           $ref: '#/components/schemas/FruizioneModIRestRichiestaSicurezzaMessaggio'
        oauth:
           $ref: '#/components/schemas/BaseFruizioneModIOAuth'
    FruizioneModIRestRichiestaSicurezzaMessaggio:
      type: object      
      required:
        - riferimento_x509
      properties:
        algoritmo:
          $ref: '#/components/schemas/ModISicurezzaMessaggioRestAlgoritmoFirma'
        header_http_firmare:
          type: array
          items:
            type: string
            maxLength: 200 # lista di header arriva a 4000 
        riferimento_x509:
          type: array
          items:
            $ref: '#/components/schemas/ModISicurezzaMessaggioRestRiferimentoX509'
          minItems: 1
          maxItems: 3
        certificate_chain:
          type: boolean
        keystore:
          type: object
          oneOf:
            - $ref: '#/components/schemas/ModIKeyStoreDefault'
            - $ref: '#/components/schemas/ModIKeyStoreRidefinito'
          discriminator:
            propertyName: modalita
            mapping:
              'default': '#/components/schemas/ModIKeyStoreDefault'
              'ridefinito': '#/components/schemas/ModIKeyStoreRidefinito'
        keystore_token_policy:
          type: boolean
        time_to_live:
          type: integer
          format: int32
          default: 300
        audience:
          type: string
          maxLength: 4000
        informazioni_utente_codice_ente:
          $ref: '#/components/schemas/FruizioneModIRichiestaInformazioneUtente'
        informazioni_utente_userid:
          $ref: '#/components/schemas/FruizioneModIRichiestaInformazioneUtente'
        informazioni_utente_indirizzo_ip:
          $ref: '#/components/schemas/FruizioneModIRichiestaInformazioneUtente'
        audit:
          $ref: '#/components/schemas/FruizioneModIRichiestaInformazioniUtenteAudit'
        claims:
           description: Indicare i claims richiesti (nome=valore); √® possibile elencare differenti valori ammissibili separandoli con la virgola
           type: array
           items:
             type: string
             maxLength: 200 # lista di header arriva a 4000
        contemporaneita:
           $ref: '#/components/schemas/FruizioneModIRestRichiestaSicurezzaMessaggioContemporaneita'
    FruizioneModIRestRichiestaSicurezzaMessaggioContemporaneita:
      type: object      
      required:
        - identificativo
        - audience
      properties:
        identificativo:
           $ref: '#/components/schemas/ModISicurezzaMessaggioRestSameDifferentEnum'
        usa_come_id_messaggio:
           $ref: '#/components/schemas/ModISicurezzaMessaggioRestTokenChoiseEnum'
        audience:
           $ref: '#/components/schemas/ModISicurezzaMessaggioRestSameDifferentEnum'
        audience_atteso:
           type: string
           maxLength: 4000
        claims_bearer:
           description: Indicare i claims richiesti (nome=valore); √® possibile elencare differenti valori ammissibili separandoli con la virgola
           type: array
           items:
             type: string
             maxLength: 200 # lista di header arriva a 4000 
        claims_agid:
           description: Indicare i claims richiesti (nome=valore); √® possibile elencare differenti valori ammissibili separandoli con la virgola
           type: array
           items:
             type: string
             maxLength: 200 # lista di header arriva a 4000
    FruizioneModIRestRisposta:
      type: object      
      required:
        - sicurezza_messaggio
      properties:
        sicurezza_messaggio:
           $ref: '#/components/schemas/FruizioneModIRestRispostaSicurezzaMessaggio'
    FruizioneModIRestRispostaSicurezzaMessaggio:
      type: object      
      required:
        - truststore
      properties:
        riferimento_x509:
          $ref: '#/components/schemas/ModISicurezzaMessaggioRestRiferimentoX509Risposta'
        riferimento_x509_risposta:
          type: array
          items:
            $ref: '#/components/schemas/ModISicurezzaMessaggioRestRiferimentoX509'
          minItems: 1
          maxItems: 3
        truststore:
          type: object
          oneOf:
            - $ref: '#/components/schemas/ModITrustStoreDefault'
            - $ref: '#/components/schemas/ModITrustStoreRidefinito'
          discriminator:
            propertyName: modalita
            mapping:
              'default': '#/components/schemas/ModITrustStoreDefault'
              'ridefinito': '#/components/schemas/ModITrustStoreRidefinito'
        truststore_ssl: #x5u
          type: object
          oneOf:
            - $ref: '#/components/schemas/ModITrustStoreDefault'
            - $ref: '#/components/schemas/ModITrustStoreRidefinito'
          discriminator:
            propertyName: modalita
            mapping:
              'default': '#/components/schemas/ModITrustStoreDefault'
              'ridefinito': '#/components/schemas/ModITrustStoreRidefinito'
        time_to_live:
          type: integer
          format: int32
        verifica_audience:
          type: boolean
          default: true
        audience_atteso:
           type: string
           maxLength: 4000
        contemporaneita:
           $ref: '#/components/schemas/FruizioneModIRestRispostaSicurezzaMessaggioContemporaneita'
    FruizioneModIRestRispostaSicurezzaMessaggioContemporaneita:
      type: object      
      required:
        - identificativo
        - audience
      properties:
        identificativo:
           $ref: '#/components/schemas/ModISicurezzaMessaggioRestTokenChoiseEnum'
        audience:
           $ref: '#/components/schemas/ModISicurezzaMessaggioRestSameDifferentEnum'
        audience_atteso:
           type: string
           maxLength: 4000 

    # ModI Info Utente
    FruizioneModIRichiestaInformazioneUtente:
      type: object      
      required:
        - modalita
      properties:
        modalita:
           $ref: '#/components/schemas/StatoDefaultRidefinitoEnum'
        valore:
          type: string
          maxLength: 4000
    BaseModIRichiestaInformazioniUtenteAudit:
      type: object
      properties:
        audience:
           $ref: '#/components/schemas/ModISicurezzaMessaggioRestSameDifferentEnum'
        audience_atteso:
           type: string
           maxLength: 4000
    FruizioneModIRichiestaInformazioniUtenteAudit:
      type: object      
      allOf:
        - $ref: '#/components/schemas/BaseModIRichiestaInformazioniUtenteAudit'
        - type: object
          properties:
            informazioni:
              type: array
              items:
                $ref: '#/components/schemas/FruizioneModIRichiestaInformazioneUtenteAudit'
    FruizioneModIRichiestaInformazioneUtenteAudit:
      type: object      
      allOf:
        - $ref: '#/components/schemas/FruizioneModIRichiestaInformazioneUtente'
        - type: object
          required:
            - nome 
          properties:
            nome:
              type: string
              maxLength: 255 

    # ModI Applicativo

    ModIApplicativoEsterno:
      type: object      
      required:
        - dominio
      properties:
        dominio:
          $ref: '#/components/schemas/DominioEnum'
        reply_audience:
           type: string
           maxLength: 4000
    
    ModIApplicativoInterno:
      type: object      
      required:
        - dominio
      properties:
        dominio:
          $ref: '#/components/schemas/DominioEnum'
        sicurezza_messaggio:
           $ref: '#/components/schemas/ModIApplicativoSicurezzaMessaggio'
        token:
          $ref: '#/components/schemas/ModIApplicativoAuthenticationToken'
    ModIApplicativoSicurezzaMessaggio:
      type: object      
      required:
        - keystore
      properties:     
        keystore:
          type: object
          oneOf:
          - $ref: '#/components/schemas/ModIKeyStoreArchive'
          - $ref: '#/components/schemas/ModIKeyStoreFileApplicativo'
          - $ref: '#/components/schemas/ModIKeyStoreHSMApplicativo'
          discriminator:
            propertyName: tipologia
            mapping:
              'archivio': '#/components/schemas/ModIKeyStoreArchive'
              'filesystem': '#/components/schemas/ModIKeyStoreFileApplicativo'
              'hsm': '#/components/schemas/ModIKeyStoreHSMApplicativo'
        reply_audience:
           type: string
           maxLength: 4000
        url_x5u:
          type: string
          maxLength: 4000 
    ModIApplicativoAuthenticationToken:
      type: object
      required:
       - identificativo
      properties:
        token_policy:
          type: string
          maxLength: 255
        identificativo:
          type: string
          maxLength: 2800
        kid:
          type: string
          maxLength: 4000

    # ModI Store

    ModITrustStoreDefault:
      type: object
      required:
        - modalita
      properties:
        modalita:
          $ref: '#/components/schemas/StatoDefaultRidefinitoEnum'
    ModITrustStoreRidefinito:
      type: object
      allOf:
          - $ref: '#/components/schemas/ModITrustStore'
          - type: object
            required:
              - modalita
            properties:
              modalita:
                $ref: '#/components/schemas/StatoDefaultRidefinitoEnum'
    ModITrustStore:
      type: object
      allOf:
        - $ref: '#/components/schemas/BaseTrustStore'
        - type: object
          required: 
          - truststore_tipo
          properties:
            truststore_tipo:
              $ref: '#/components/schemas/ModITruststoreEnum'
            pcks11_tipo:
              type: string
              maxLength: 255

    ModIKeyStoreDefault:
      type: object
      required:
        - modalita
      properties:
        modalita:
          $ref: '#/components/schemas/StatoDefaultRidefinitoEnum'
    ModIKeyStoreRidefinito:
      type: object
      required:
        - modalita
        - dati_keystore
      properties:
        modalita:
          $ref: '#/components/schemas/StatoDefaultRidefinitoEnum'
        dati_keystore:
          type: object
          oneOf:
          - $ref: '#/components/schemas/ModIKeyStoreArchive'
          - $ref: '#/components/schemas/ModIKeyStoreFile'
          - $ref: '#/components/schemas/ModIKeyStoreHSM'
          discriminator:
            propertyName: tipologia
            mapping:
              'archivio': '#/components/schemas/ModIKeyStoreArchive'
              'filesystem': '#/components/schemas/ModIKeyStoreFile'
              'hsm': '#/components/schemas/ModIKeyStoreHSM'
    ModIKeyStoreFile:
      type: object      
      allOf:
        - $ref: '#/components/schemas/BaseKeyStoreFile'
        - type: object
          required:
            - tipologia 
            - keystore_tipo
          properties:
            tipologia:
              $ref: '#/components/schemas/ModIKeystoreTipologiaEnum'
            keystore_tipo:
              $ref: '#/components/schemas/ModIKeystoreEnum'
    ModIKeyStoreFileApplicativo:
      type: object      
      allOf:
        - $ref: '#/components/schemas/ModIKeyStoreFile'
        - type: object
          properties:
            keystore_certificato:
              type: string
              format: byte
    ModIKeyStoreArchive:
      type: object      
      allOf:
        - $ref: '#/components/schemas/BaseKeyStoreArchive'
        - type: object
          required:
            - tipologia 
            - keystore_tipo
          properties:
            tipologia:
              $ref: '#/components/schemas/ModIKeystoreTipologiaEnum'
            keystore_tipo:
              $ref: '#/components/schemas/ModIKeystoreEnum'
    ModIKeyStoreHSM:
      type: object      
      required:
       - tipologia 
       - pcks11_tipo
       - key_alias
      properties:
        tipologia:
          $ref: '#/components/schemas/ModIKeystoreTipologiaEnum'
        pcks11_tipo:
              type: string
              maxLength: 255
        key_alias:
          type: string
          maxLength: 255
          description: alias della chiave privata
          example: 'pwd'
    ModIKeyStoreHSMApplicativo:
      type: object      
      allOf:
        - $ref: '#/components/schemas/ModIKeyStoreHSM'
        - type: object
          properties:
            keystore_certificato:
              type: string
              format: byte

    # Base: Gruppi Erogazione/Fruizione

    GruppoNome:
      type: object
      required:
        - nome
      properties:
        nome:
          type: string
          maxLength: 255
    GruppoAzioni:
      type: object
      required:
        - azioni
      properties:
        azioni:
          type: array
          items:
            $ref: 'govway_core.yaml#/components/schemas/NCName'
          example: ['az1', 'az2', 'az3']
    GruppoBase:
      type: object
      allOf:
          - $ref: '#/components/schemas/GruppoNome'      
          - $ref: '#/components/schemas/GruppoAzioni'
    Gruppo:
      type: object
      allOf:
          - $ref: '#/components/schemas/GruppoBase'      
          - type: object
            properties:
              configurazione:
                type: object
                oneOf:
                  - $ref: '#/components/schemas/GruppoEreditaConfigurazione'
                  - $ref: '#/components/schemas/GruppoNuovaConfigurazione'
                discriminator:
                  propertyName: modalita
                  mapping:
                    'eredita': '#/components/schemas/GruppoEreditaConfigurazione'
                    'nuova': '#/components/schemas/GruppoNuovaConfigurazione'
    GruppoEreditaConfigurazione:
      type: object
      required:
       - modalita
       - nome
      properties:
        modalita:
          $ref: '#/components/schemas/ModalitaConfigurazioneGruppoEnum'
        nome:
          type: string
          maxLength: 255 
    GruppoNuovaConfigurazione:
      type: object
      required:
        - modalita
        - autenticazione
      properties:
         modalita:
            $ref: '#/components/schemas/ModalitaConfigurazioneGruppoEnum'
         autenticazione:
            type: object
            oneOf:
              - $ref: '#/components/schemas/APIImplAutenticazioneDisabilitata'             
              - $ref: '#/components/schemas/APIImplAutenticazioneBasic'
              - $ref: '#/components/schemas/APIImplAutenticazioneHttps'
              - $ref: '#/components/schemas/APIImplAutenticazionePrincipal'
              - $ref: '#/components/schemas/APIImplAutenticazioneApiKey'
            discriminator:
              propertyName: tipo
              mapping:
                'disabilitato': '#/components/schemas/APIImplAutenticazioneDisabilitata'
                'http-basic': '#/components/schemas/APIImplAutenticazioneBasic'
                'https': '#/components/schemas/APIImplAutenticazioneHttps'
                'principal': '#/components/schemas/APIImplAutenticazionePrincipal'
                'api-key': '#/components/schemas/APIImplAutenticazioneApiKey'         
    GruppoItem:
      type: object
      allOf:
          - $ref: '#/components/schemas/GruppoBase'      
          - type: object
            required:
              - predefinito
            properties:
              predefinito:
                type: boolean
    ListaGruppi:
       type: object
       allOf:
          - $ref: 'govway_core.yaml#/components/schemas/Lista'
          - type: object
            required:
              - items
            properties:
              items:
                type: array
                items:
                  $ref: '#/components/schemas/GruppoItem' 

    # Base: Configurazioni Erogazione/Fruizione

    GestioneCorsAccessControl:
      type: object
      required:
        - all_allow_origins
      properties:
        all_allow_origins:
          type: boolean
          default: true
        allow_origins:
          type: array
          items:
            type: string
            maxLength: 255
        all_allow_headers:
          type: boolean
          default: false
        allow_headers:
          type: array
          items:
            type: string
            maxLength: 255 
        all_allow_methods:
          type: boolean
          default: false
        allow_methods:
          type: array
          items:
            $ref: '#/components/schemas/HttpMethodEnum'   
        allow_credentials:
          type: boolean
          default: false
        expose_headers:
          type: array
          items:
            type: string
            maxLength: 255
        max_age:
          type: boolean
          default: false
        max_age_seconds:
          type: integer
          format: int32 
    GestioneCors:
      type: object
      required:
        - ridefinito
      properties:
        ridefinito:
          type: boolean
          default: false
        tipo:
          $ref: '#/components/schemas/TipoGestioneCorsEnum' 
        access_control:
          $ref: '#/components/schemas/GestioneCorsAccessControl'
 
    ApiImplStato:
       type: object
       required:
          - abilitato
       properties:
          abilitato:
            type: boolean

    # --- Stato impostato a ridefinito come default per supportare in futuro la possibilit√† di indicare usa default o meno.
    ApiImplConfigurazioneStato:
      type: object
      properties:
        ridefinito:
          description: funzionalit√† non supportata al momento, indicare sempre 'true'.
          type: boolean
          default: true

    ControlloAccessiGestioneToken:
       type: object
       allOf:
          - $ref: '#/components/schemas/ApiImplConfigurazioneStato'
          - type: object
            properties:
              abilitato:
                description: indica se la gestione del token √® abilitata o meno
                type: boolean
              policy:
                description: identificativo della Policy da utilizzare per la gestione del token
                type: string
                maxLength: 255
              token_opzionale:
                description: indica se la presenza del token √® obbligatoria o opzionale
                type: boolean
                default: false
              validazione_jwt:
                $ref: '#/components/schemas/StatoFunzionalitaConWarningEnum'
              introspection:
                $ref: '#/components/schemas/StatoFunzionalitaConWarningEnum'
              user_info:
                $ref: '#/components/schemas/StatoFunzionalitaConWarningEnum'                
              token_forward:
                description: indica se il forward del token, nelle modalit√† descritte nella policy, √® attivo o meno
                type: boolean
                default: true   
                           
    ControlloAccessiAutenticazione:
       type: object
       allOf:
          - $ref: '#/components/schemas/ApiImplConfigurazioneStato'
          - type: object
            properties:
              autenticazione:
                  type: object
                  oneOf:
                    - $ref: '#/components/schemas/APIImplAutenticazioneDisabilitata'             
                    - $ref: '#/components/schemas/APIImplAutenticazioneBasic'
                    - $ref: '#/components/schemas/APIImplAutenticazioneHttps'
                    - $ref: '#/components/schemas/APIImplAutenticazionePrincipal'
                    - $ref: '#/components/schemas/APIImplAutenticazioneApiKey'
                    - $ref: '#/components/schemas/APIImplAutenticazioneCustom'
                  discriminator:
                    propertyName: tipo
                    mapping:
                      'disabilitato': '#/components/schemas/APIImplAutenticazioneDisabilitata'
                      'http-basic': '#/components/schemas/APIImplAutenticazioneBasic'
                      'https': '#/components/schemas/APIImplAutenticazioneHttps'
                      'principal': '#/components/schemas/APIImplAutenticazionePrincipal'
                      'api-key': '#/components/schemas/APIImplAutenticazioneApiKey'
                      'custom': '#/components/schemas/APIImplAutenticazioneCustom'
              token:
                $ref: '#/components/schemas/ControlloAccessiAutenticazioneToken'
    ControlloAccessiAutenticazioneToken:
      type: object
      properties:          
        issuer:
          description: indica se nel token deve essere obbligatoriamente presente l'issuer
          type: boolean
          default: false
        client_id:
          description: indica se nel token deve essere obbligatoriamente presente l'identificativo dell'applicazione
          type: boolean
          default: false
        subject:
          description: indica se nel token deve essere obbligatoriamente presente il subject (identificativo utente codificato)
          type: boolean
          default: false
        username:
          description: indica se nel token deve essere obbligatoriamente presente l'utente (identificativo utente 'human-readable')
          type: boolean
          default: false
        email:
          description: indica se nel token deve essere obbligatoriamente presente l'email dell'utente
          type: boolean
          default: false   

    ControlloAccessiIdentificazioneAttributi:
       type: object
       allOf:
          - $ref: '#/components/schemas/ApiImplConfigurazioneStato'
          - type: object
            required:
            - abilitato
            properties:
              abilitato:
                description: indica se la gestione del token √® abilitata o meno
                type: boolean
              attributeAuthority:
               type: array
               items:
                 $ref: '#/components/schemas/ControlloAccessiAttributeAuthority'
    ControlloAccessiAttributeAuthority:
      type: object
      required:
      - nome
      properties:
        nome:
          $ref: '#/components/schemas/AAName'
        attributi:
          type: array
          items:
            type: string

    ControlloAccessiAutorizzazioneView:
       type: object
       allOf:
          - $ref: '#/components/schemas/ApiImplConfigurazioneStato'
          - type: object
            properties:
              autorizzazione:
                type: object
                oneOf:
                  - $ref: '#/components/schemas/APIImplAutorizzazioneDisabilitata'
                  - $ref: '#/components/schemas/APIImplAutorizzazioneAbilitata'
                  - $ref: '#/components/schemas/APIImplAutorizzazioneXACMLView'
                  - $ref: '#/components/schemas/APIImplAutorizzazioneCustom'
                discriminator:
                  propertyName: tipo
                  mapping:
                    'disabilitato': '#/components/schemas/APIImplAutorizzazioneDisabilitata'
                    'abilitato': '#/components/schemas/APIImplAutorizzazioneAbilitata'
                    'xacml-Policy': '#/components/schemas/APIImplAutorizzazioneXACMLView'
                    'custom': '#/components/schemas/APIImplAutorizzazioneCustom'
    ControlloAccessiAutorizzazione:
       type: object
       allOf:
          - $ref: '#/components/schemas/ApiImplConfigurazioneStato'
          - type: object
            properties:
              autorizzazione:
                type: object
                oneOf:
                  - $ref: '#/components/schemas/APIImplAutorizzazioneDisabilitata'
                  - $ref: '#/components/schemas/APIImplAutorizzazioneAbilitata'
                  - $ref: '#/components/schemas/APIImplAutorizzazioneXACML'
                  - $ref: '#/components/schemas/APIImplAutorizzazioneCustom'
                discriminator:
                  propertyName: tipo
                  mapping:
                    'disabilitato': '#/components/schemas/APIImplAutorizzazioneDisabilitata'
                    'abilitato': '#/components/schemas/APIImplAutorizzazioneAbilitata'
                    'xacml-Policy': '#/components/schemas/APIImplAutorizzazioneXACML'
                    'custom': '#/components/schemas/APIImplAutorizzazioneCustom'
    ControlloAccessiAutorizzazioneSoggetti:
      type: object
      required:
        - soggetti
      properties:
        soggetti:
          type: array
          items:
            $ref: 'govway_core.yaml#/components/schemas/SimpleName'
          example: ['Ente1', 'Ente2', 'Ente3'] 
    ControlloAccessiAutorizzazioneSoggetto:
      type: object
      required:
        - soggetto
      properties:
        soggetto:
          $ref: 'govway_core.yaml#/components/schemas/SimpleName'
    ControlloAccessiAutorizzazioneApplicativi:
      type: object
      required:
        - applicativi
      properties:
        applicativi:
          type: array
          items:
            $ref: 'govway_core.yaml#/components/schemas/NCName'
          example: ['Applicativo1', 'Applicativo2', 'Applicativo3']
    ControlloAccessiErogazioneAutorizzazioneApplicativi:
      type: object
      required:
        - applicativi
      properties:
        applicativi:
          type: array
          items:
            $ref: '#/components/schemas/ControlloAccessiErogazioneAutorizzazioneApplicativo'
    ControlloAccessiAutorizzazioneApplicativo:
      type: object
      required:
        - applicativo
      properties:
        applicativo:
          $ref: 'govway_core.yaml#/components/schemas/NCName'
    ControlloAccessiErogazioneAutorizzazioneApplicativo:
      type: object
      allOf:
          - $ref: '#/components/schemas/ControlloAccessiAutorizzazioneApplicativo'
          - type: object
            properties:
              soggetto:
                $ref: 'govway_core.yaml#/components/schemas/SimpleName'
    ControlloAccessiAutorizzazioneRuoli:
      type: object
      required:
        - ruoli
      properties:
        ruoli:
          type: array
          items:
            $ref: 'govway_core.yaml#/components/schemas/NCName'
          example: ['Ruolo1', 'Ruolo2', 'Ruolo3']
    ControlloAccessiAutorizzazioneRuolo:
      type: object
      required:
        - ruolo
      properties:
        ruolo:
          $ref: 'govway_core.yaml#/components/schemas/NCName' 
    ControlloAccessiAutorizzazioneScopes:
      type: object
      required:
        - scope
      properties:
        scope:
          type: array
          items:
            $ref: 'govway_core.yaml#/components/schemas/NCName'
          example: ['Scope1', 'Scope2', 'Scope3']
    ControlloAccessiAutorizzazioneScope:
      type: object
      required:
        - scope
      properties:
        scope:
          $ref: 'govway_core.yaml#/components/schemas/NCName'     

    RateLimitingPolicyItem:
       type: object
       required:
        - nome
       properties:
         nome:
           $ref: 'govway_core.yaml#/components/schemas/NCName'
    ListaRateLimitingPolicy:
      type: object
      allOf:
          - $ref: 'govway_core.yaml#/components/schemas/Lista'
          - type: object
            required:
              - items
            properties:
              items:
                type: array
                items:
                  $ref: '#/components/schemas/RateLimitingPolicyItem'
                  
    RateLimitingPolicyCriteri:
       type: object
       required:
       - identificazione
       - metrica
       properties:
         identificazione:
            $ref: '#/components/schemas/RateLimitingIdentificazionePolicyEnum'
         metrica:
            $ref: '#/components/schemas/RateLimitingCriteriMetricaEnum'
         intervallo:
            $ref: '#/components/schemas/RateLimitingCriteriIntervalloEnum'
         congestione:
            type: boolean
            default: false
            example: false
         degrado:
            type: boolean
            default: false
            example: false
    RateLimitingPolicyIdentificativo:
       type: object
       required:
       - identificazione
       - policy
       properties:
         identificazione:
            $ref: '#/components/schemas/RateLimitingIdentificazionePolicyEnum'
         policy:
            $ref: 'govway_core.yaml#/components/schemas/NCName'
    RateLimitingPolicyBase:
       type: object
       allOf:
          - $ref: '#/components/schemas/ApiImplConfigurazioneStato'
          - type: object
            required:
            - nome
            - stato
            properties:
              nome:
                type: string
                maxLength: 255
              stato:
                $ref: '#/components/schemas/StatoFunzionalitaConWarningEnum'
              soglia_ridefinita:
                 type: boolean
                 default: false
              soglia_valore:
                 type: integer
                 format: int32
              soglia_dimensione_richiesta:
                 type: integer
                 format: int32
              soglia_dimensione_risposta:
                 type: integer
                 format: int32                 
    RateLimitingPolicyBaseConIdentificazione:
       type: object
       allOf:
          - $ref: '#/components/schemas/RateLimitingPolicyBase'
          - type: object
            properties:
              configurazione:
                  type: object
                  oneOf:
                    - $ref: '#/components/schemas/RateLimitingPolicyCriteri'
                    - $ref: '#/components/schemas/RateLimitingPolicyIdentificativo'
                  discriminator:
                    propertyName: identificazione
                    mapping:
                      'criteri': '#/components/schemas/RateLimitingPolicyCriteri'
                      'policy': '#/components/schemas/RateLimitingPolicyIdentificativo'
    RateLimitingPolicyErogazione:
       type: object
       allOf:
          - $ref: '#/components/schemas/RateLimitingPolicyBaseConIdentificazione'
          - type: object
            properties:
              filtro:
                 $ref: '#/components/schemas/RateLimitingPolicyFiltroErogazione'
              raggruppamento:
                 $ref: '#/components/schemas/RateLimitingPolicyGroupBy'
    RateLimitingPolicyFruizione:
       type: object
       allOf:
          - $ref: '#/components/schemas/RateLimitingPolicyBaseConIdentificazione'
          - type: object
            properties:
              filtro:
                 $ref: '#/components/schemas/RateLimitingPolicyFiltroFruizione'
              raggruppamento:
                 $ref: '#/components/schemas/RateLimitingPolicyGroupBy'
                 
    RateLimitingPolicyErogazioneUpdate:
       type: object
       allOf:
          - $ref: '#/components/schemas/RateLimitingPolicyBase'
          - type: object
            properties:
              filtro:
                 $ref: '#/components/schemas/RateLimitingPolicyFiltroErogazione'
              raggruppamento:
                 $ref: '#/components/schemas/RateLimitingPolicyGroupBy'
    RateLimitingPolicyFruizioneUpdate:
       type: object
       allOf:
          - $ref: '#/components/schemas/RateLimitingPolicyBase'
          - type: object
            properties:
              filtro:
                 $ref: '#/components/schemas/RateLimitingPolicyFiltroFruizione'
              raggruppamento:
                 $ref: '#/components/schemas/RateLimitingPolicyGroupBy'
                                 
    RateLimitingPolicyFiltro:
      type: object
      properties:
        azione:
          type: array
          items:
            $ref: 'govway_core.yaml#/components/schemas/NCName'
        ruolo_richiedente:
          $ref: 'govway_core.yaml#/components/schemas/NCName'
        applicativo_fruitore:
          $ref: 'govway_core.yaml#/components/schemas/NCName'
        token_claims:
          type: "array"
          description: "Indicare i claims richiesti (nome=valore); √® possibile elencare\
            \ differenti valori ammissibili separandoli con la virgola"
          items:
            maxLength: 200
            type: "string"
        chiave_tipo:
          $ref: '#/components/schemas/RateLimitingChiaveEnum'
        chiave_nome:
          type: string
          description: |-
            La semantica cambia in funzione del tipo:
              * header-based: nome dell'header
              * url-based: espressione regolare da applicare alla url di invocazione
              * form-based: nome del parametro della url
              * soap-action-based: in questa modalit√† questo parametro non viene utilizzato
              * content-based: xpath o json path da applicare sul contenuto
              * indirizzo-ip: indirizzo ip del socket
              * indirizzo-ip-forwarded: indirizzo ip inoltrato via header http
              * plugin-based: tipo del plugin
          maxLength: 255
        filtro_chiave_valore:
          type: string
          description: indica il valore che deve assumere la chiave
          maxLength: 255         
    RateLimitingPolicyFiltroErogazione:
       type: object
       allOf:
          - $ref: '#/components/schemas/RateLimitingPolicyFiltro'
          - type: object
            properties:
              soggetto_fruitore:
                $ref: 'govway_core.yaml#/components/schemas/SimpleName'
    RateLimitingPolicyFiltroFruizione:
       type: object
       allOf:
          - $ref: '#/components/schemas/RateLimitingPolicyFiltro'

    RateLimitingPolicyGroupBy:
      type: object
      properties:
        azione:
          type: boolean
          default: false
        richiedente:
          type: boolean
          default: false
        token:
          type: array
          items:
            $ref: 'govway_core.yaml#/components/schemas/TokenClaimEnum'
          example: [subject, issuer] 
        chiave_tipo:
          $ref: '#/components/schemas/RateLimitingChiaveEnum'
        chiave_nome:
          type: string
          description: |-
            La semantica cambia in funzione del tipo:
              * header-based: nome dell'header
              * url-based: espressione regolare da applicare alla url di invocazione
              * form-based: nome del parametro della url
              * soap-action-based: in questa modalit√† questo parametro non viene utilizzato
              * content-based: xpath o json path da applicare sul contenuto
              * indirizzo-ip: indirizzo ip del socket
              * indirizzo-ip-forwarded: indirizzo ip inoltrato via header http
              * plugin-based: tipo del plugin
          maxLength: 255
                    
    RateLimitingPolicyErogazioneView:
       type: object
       allOf:
          - $ref: '#/components/schemas/RateLimitingPolicyErogazione'
          - type: object
            required:
            - descrizione
            properties:
              descrizione:
                type: string
    RateLimitingPolicyFruizioneView:
       type: object
       allOf:
          - $ref: '#/components/schemas/RateLimitingPolicyFruizione'
          - type: object
            required:
            - descrizione
            properties:
              descrizione:
                type: string

    Validazione:
       type: object
       allOf:
          - $ref: '#/components/schemas/ApiImplConfigurazioneStato'
          - type: object
            required:
            - stato
            - tipo
            properties:
              stato:
                $ref: '#/components/schemas/StatoFunzionalitaConWarningEnum'
              tipo:
                $ref: '#/components/schemas/TipoValidazioneEnum'
              mtom:
                type: boolean
                default: false
                example: false
                
    CachingRisposta:
       type: object
       allOf:
          - $ref: '#/components/schemas/ApiImplConfigurazioneStato'
          - type: object
            required:
            - stato
            properties:
              stato:
                $ref: '#/components/schemas/StatoDefaultRidefinitoEnum'
              abilitato:
                type: boolean
              cache_timeout_seconds:
                type: integer
                format: int32
              max_response_size:
                type: boolean
              max_response_size_kb:
                type: integer
                format: int64
              hash_request_uri:
                type: boolean
                default: true
              hash_all_query_parameters:
                type: boolean
                default: true
              hash_query_paramaters:
                type: array
                items:
                  type: string
                  maxLength: 255
              hash_headers:
                type: array
                items:
                  type: string
                  maxLength: 255
              hash_payload:
                type: boolean
                default: true
              control_no_cache:
                type: boolean
                default: true
              control_no_store:
                type: boolean
                default: true
              control_max_age:
                type: boolean
                default: true
              regole:
                type: array
                items:
                  $ref: '#/components/schemas/CachingRispostaRegola'
    CachingRispostaRegola:
       type: object
       properties:
          return-code-min:
            $ref: 'govway_core.yaml#/components/schemas/HttpStatusCode'
          return-code-max:
            $ref: 'govway_core.yaml#/components/schemas/HttpStatusCode'
          fault:
            type: boolean
            default: false
          cache_timeout_seconds:
            type: integer
            format: int32

    CorrelazioneApplicativaRichiestaItem:
       type: object
       required:
         - elemento
         - identificazione_tipo
       properties:
          elemento:
            type: string
            maxLength: 255
          identificazione_tipo:
            $ref: '#/components/schemas/CorrelazioneApplicativaRichiestaEnum'
    CorrelazioneApplicativaRispostaItem:
       type: object
       required:
         - elemento
         - identificazione_tipo
       properties:
          elemento:
            type: string
            maxLength: 255
          identificazione_tipo:
            $ref: '#/components/schemas/CorrelazioneApplicativaRispostaEnum'
  
    ListaCorrelazioneApplicativaRichiesta:
      type: object
      allOf:
          - $ref: 'govway_core.yaml#/components/schemas/Lista'
          - type: object
            required:
              - items
            properties:
              items:
                type: array
                items:
                  $ref: '#/components/schemas/CorrelazioneApplicativaRichiestaItem'
    ListaCorrelazioneApplicativaRisposta:
      type: object
      allOf:
          - $ref: 'govway_core.yaml#/components/schemas/Lista'
          - type: object
            required:
              - items
            properties:
              items:
                type: array
                items:
                  $ref: '#/components/schemas/CorrelazioneApplicativaRispostaItem'
          
    CorrelazioneApplicativaBase:
       type: object
       allOf:
          - $ref: '#/components/schemas/ApiImplConfigurazioneStato'
          - type: object
            properties:
              elemento:
                type: string
                maxLength: 255
              generazione_errore_identificazione_fallita:
                type: boolean
                default: true
    CorrelazioneApplicativaRichiesta:
       type: object
       allOf:
          - $ref: '#/components/schemas/CorrelazioneApplicativaBase'
          - type: object
            required:
            - identificazione_tipo
            properties:
              identificazione_tipo:
                $ref: '#/components/schemas/CorrelazioneApplicativaRichiestaEnum'
              identificazione:
                type: string
                description: |-
                  La semantica cambia in funzione del tipo:
                    * header-based: nome dell'header
                    * url-based: espressione regolare da applicare alla url di invocazione
                    * content-based: xpath o json path da applicare sul contenuto
                    * input-based: questo field non deve essere valorizzato poich√® l'informazione applicativa viene estratta dagli header di integrazione
                    * template: template con parti dinamiche risolte a runtime da GovWay
                    * freemarker-template: freemarker template
                    * velocity-template: velocity template
                    * disabilitato:  questo field non deve essere valorizzato poich√® la funzionalit√† di estrazione √® disabilitata
    CorrelazioneApplicativaRisposta:
       type: object
       allOf:
          - $ref: '#/components/schemas/CorrelazioneApplicativaBase'
          - type: object
            required:
            - identificazione_tipo
            properties:
              identificazione_tipo:
                $ref: '#/components/schemas/CorrelazioneApplicativaRispostaEnum'
              identificazione:
                type: string
                description: |-
                  La semantica cambia in funzione del tipo:
                    * header-based: nome dell'header
                    * content-based: xpath o json path da applicare sul contenuto
                    * input-based: questo field non deve essere valorizzato poich√® l'informazione applicativa viene estratta dagli header di integrazione
                    * template: template con parti dinamiche risolte a runtime da GovWay
                    * freemarker-template: freemarker template
                    * velocity-template: velocity template
                    * disabilitato:  questo field non deve essere valorizzato poich√® la funzionalit√† di estrazione √® disabilitata

    RegistrazioneMessaggi:
       type: object
       allOf:
          - $ref: '#/components/schemas/ApiImplConfigurazioneStato'
          - type: object
            required:
            - stato
            properties:
              stato:
                $ref: '#/components/schemas/StatoDefaultRidefinitoEnum'
              richiesta:
                $ref: '#/components/schemas/RegistrazioneMessaggiConfigurazione'
              risposta:
                $ref: '#/components/schemas/RegistrazioneMessaggiConfigurazione'
    RegistrazioneMessaggiConfigurazione:
      type: object
      required:
        - abilitato
      properties:
        abilitato:
          type: boolean
        ingresso:
          $ref: '#/components/schemas/RegistrazioneMessaggiConfigurazioneRegola'
        uscita:
          $ref: '#/components/schemas/RegistrazioneMessaggiConfigurazioneRegola'
    RegistrazioneMessaggiConfigurazioneRegola:
      type: object
      required:
        - headers
        - payload
      properties:
        headers:
          type: boolean
        payload:
          type: boolean
        payload_parsing:
          type: boolean
        body:
          type: boolean
        attachments:
          type: boolean

    RegistrazioneDiagnosticiConfigurazione:
       type: object
       allOf:
          - $ref: '#/components/schemas/ApiImplConfigurazioneStato'
          - type: object
            required:
            - stato
            properties:
              stato:
                $ref: '#/components/schemas/StatoDefaultRidefinitoEnum'
              severita:
                $ref: '#/components/schemas/DiagnosticiSeverita'
          
    RegistrazioneTransazioniConfigurazione:
       type: object
       allOf:
          - $ref: '#/components/schemas/ApiImplConfigurazioneStato'
          - type: object
            required:
            - stato
            properties:
              stato:
                $ref: '#/components/schemas/StatoDefaultRidefinitoEnum'
              database:
                $ref: '#/components/schemas/RegistrazioneTransazioniConfigurazioneBase'
              filetrace:
                $ref: '#/components/schemas/RegistrazioneTransazioniConfigurazioneFiletrace'
              filtro:
                $ref: '#/components/schemas/RegistrazioneTransazioniConfigurazioneFiltroEsiti'
              informazioni:
                $ref: '#/components/schemas/RegistrazioneTransazioniConfigurazioneInformazioniRegistrate'
    RegistrazioneTransazioniConfigurazioneBase:
      type: object
      required:
        - stato
      properties:
        stato:
          $ref: '#/components/schemas/TracciamentoTransazioniStato'
        fasi:
          $ref: '#/components/schemas/RegistrazioneTransazioniConfigurazioneFasi'
        filtro_esiti:
          $ref: '#/components/schemas/TracciamentoTransazioniStatoFase'
    RegistrazioneTransazioniConfigurazioneFiletrace:
       type: object
       allOf:
          - $ref: '#/components/schemas/RegistrazioneTransazioniConfigurazioneBase'
          - type: object
            properties:
              config_path:
                type: string
                maxLength: 255
              dump_client:
                $ref: '#/components/schemas/RegistrazioneTransazioniConfigurazioneFiletraceMessaggio'
              dump_server:
                $ref: '#/components/schemas/RegistrazioneTransazioniConfigurazioneFiletraceMessaggio'
    RegistrazioneTransazioniConfigurazioneFiletraceMessaggio:
      type: object
      required:
        - headers
        - payload
      properties:
        headers:
          type: boolean
        payload:
          type: boolean
    RegistrazioneTransazioniConfigurazioneFasi:
      type: object
      required:
        - richiesta_ingresso
        - richiesta_uscita
        - risposta_uscita
        - risposta_consegnata
      properties:
        richiesta_ingresso:
          $ref: '#/components/schemas/TracciamentoTransazioniStatoFaseBloccante'
        richiesta_uscita:
          $ref: '#/components/schemas/TracciamentoTransazioniStatoFaseBloccante'
        risposta_uscita:
          $ref: '#/components/schemas/TracciamentoTransazioniStatoFaseBloccante'
        risposta_consegnata:
          $ref: '#/components/schemas/TracciamentoTransazioniStatoFase'
    RegistrazioneTransazioniConfigurazioneFiltroEsiti:
      type: object
      required:
        - esiti
      properties:
        esiti:
          description: Indicare i codici degli esiti richiesti
          type: array
          items:
            type: integer
            format: int32
    RegistrazioneTransazioniConfigurazioneInformazioniRegistrate:
      type: object
      required:
        - token
        - tempi_elaborazione
      properties:
        token:
          $ref: '#/components/schemas/TracciamentoTransazioniStatoFase'
        tempi_elaborazione:
          $ref: '#/components/schemas/TracciamentoTransazioniStatoFase'


    Proprieta:
      type: object
      required:
        - nome
        - valore
      properties:
        nome:
          type: string
          maxLength: 255
        valore:
          type: string
          # Encrypted maxLength: 255
    ProprietaOpzioneCifratura:
       type: object
       allOf:
          - $ref: '#/components/schemas/Proprieta'
          - type: object
            properties:
              encrypted:
                type: boolean
                default: false
    ElencoProprieta:
      type: object  
      properties:
        proprieta:        
          type: array
          items:
            $ref: '#/components/schemas/ProprietaOpzioneCifratura'

    Proprieta4000:
      type: object
      required:
        - nome
        - valore
      properties:
        nome:
          type: string
          maxLength: 255
        valore:
          type: string
          # Encrypted maxLength: 4000
    Proprieta4000OpzioneCifratura:
       type: object
       allOf:
          - $ref: '#/components/schemas/Proprieta4000'
          - type: object
            properties:
              encrypted:
                type: boolean
                default: false

    AAName:
      type: string
      pattern: ^[_A-Za-z][\-_A-Za-z0-9]*$
      maxLength: 255
      description: Pu√≤ iniziare solo con un carattere [A-Za-z] o il simbolo '_' e dev'essere formato solo da caratteri, cifre, '_' e '-'
          
    # Base: Enumeration
    FormatoSoapEnum:
      type: string
      enum: ['Wsdl1.1']
      default: 'Wsdl1.1'
    FormatoRestEnum:
      type: string
      enum: ['Wadl', 'Swagger2.0','OpenApi3.0']
      default: 'OpenApi3.0'
    TipoApiEnum:
      type: string
      enum: ['soap', 'rest']
      example: 'rest'
    TipoConfigurazioneFruizioneEnum:
      type: string
      enum: ['oauth', 'soap', 'rest']
      example: 'rest'
    StatoApiEnum:
      type: string
      enum: ['ok', 'warn','error']
    DominioEnum:
      type: string
      enum: ['interno', 'esterno']
      example: 'esterno'
    ModalitaAccessoEnum:
      type: string
      enum: ['http-basic', 'https', 'principal', 'api-key', 'token']
      example: 'http-basic'
    ContestoEnum:
      type: string
      enum: ['qualsiasi', 'erogazione', 'fruizione']
      example: 'qualsiasi'
      default: 'qualsiasi'
    FonteEnum:
      type: string
      enum: ['qualsiasi', 'registro', 'esterna']
      example: 'qualsiasi'
      default: 'qualsiasi'
    RuoloAllegatoAPI:
      type: string
      enum: ['allegato', 'specificaSemiFormale']
      default: allegato
      example: 'specificaSemiFormale'
    RuoloAllegatoAPIImpl:
      type: string
      enum: ['allegato', 'specificaSemiFormale', 'specificaSicurezza', 'specificaLivelloServizio' ]
      default: allegato
      example: 'specificaSemiFormale'
    TipoSpecificaSemiformaleEnum:
      type: string
      enum: ['UML', 'HTML', 'XSD', 'XML', 'JSON', 'YAML', 'Linguaggio Naturale']
      example: 'XML'
    TipoSpecificaSicurezzaEnum:
      type: string
      enum: ['WS-Policy', 'XACML-Policy', 'Linguaggio Naturale']
      example: 'XACML-Policy'      
    TipoSpecificaLivelloServizioEnum:
      type: string
      enum: ['WS-Agreement', 'WSLA']
      example: 'WSLA'
    HttpMethodEnum:
      type: string
      enum: ['Qualsiasi', 'GET', 'POST', 'PUT', 'DELETE', 'OPTIONS', 'HEAD', 'TRACE', 'PATCH', 'LINK', 'UNLINK']
      example: 'POST'
    SslTipologiaEnum:
      type: string
      enum: ['SSLv2Hello', 'SSLv3', 'TLSv1', 'TLSv1.1', 'TLSv1.2', 'TLSv1.3']
      example: 'TLSv1.2'
      default: 'TLSv1.3'
    KeystoreEnum:
      type: string
      enum: ['jks', 'pkcs12', 'pkcs11']
      example: 'jks' 
    TipoAutenticazioneEnum:
      type: string
      enum: ['disabilitato', 'http-basic', 'https', 'principal', 'api-key', 'custom']
      example: 'http-basic' 
    TipoAutenticazioneHttps:
      type: string
      enum: ['certificato', 'configurazione-manuale']
      example: 'certificato'
    TipoAutenticazionePrincipal:
      type: string
      enum: ['container', 'header-based', 'form-based', 'url-based', 'ip-address', 'ip-address-forwarded-for', 'token']
      example: 'container'  
    TipoAutenticazionePrincipalToken:
      type: string
      enum: ['subject', 'clientId', 'username', 'eMail', 'custom']
      example: 'clientId'  
    TipoKeystore:
      type: string
      enum: ['JKS', 'PKCS12', 'CER']
      example: 'JKS'
    TipoAutorizzazioneEnum:
      type: string
      enum: ['disabilitato', 'abilitato', 'xacml-Policy', 'custom']
      example: 'abilitato'
    AllAnyEnum:
      type: string
      enum: ['all', 'any']
      example: 'all'
      default: 'all'    
    ModalitaIdentificazioneAzioneEnum:
      type: string
      enum: ['content-based', 'header-based', 'input-based', 'interface-based', 'soap-action-based', 'url-based', 'protocol-based', 'static']
      example: 'interface-based'   
    TipoGestioneCorsEnum:
      type: string
      enum: ['disabilitato', 'gateway', 'applicativo']
      example: 'gateway'
    ModalitaConfigurazioneGruppoEnum:
      type: string
      enum: ['eredita', 'nuova']
      example: 'eredita'
    StatoFunzionalitaConWarningEnum:
      type: string
      enum: ['abilitato', 'disabilitato', 'warningOnly']
      example: 'abilitato'
    TipoValidazioneEnum:
      type: string
      enum: ['interface', 'xsd']
      example: 'interface'
    StatoDefaultRidefinitoEnum:
      type: string
      enum: ['default', 'ridefinito']
      example: 'ridefinito'
    RateLimitingIdentificazionePolicyEnum:
      type: string
      enum: ['criteri', 'policy']
      example: 'criteri'
    RateLimitingCriteriMetricaEnum:
      type: string
      enum: 
        - 'numero-richieste'
        - 'numero-richieste-simultanee'
        - 'dimensione-massima'
        - 'occupazione-banda'
        - 'tempo-medio-risposta'
        - 'tempo-complessivo-risposta'
        - 'numero-richieste-ok'
        - 'numero-richieste-fallite'
        - 'numero-fault-applicativi'
        - 'numero-richieste-fallite-o-fault-applicativi'
        - 'numero-richieste-ok-o-fault-applicativi'
      example: 'numero-richieste'
    RateLimitingCriteriIntervalloEnum:
      type: string
      enum: ['minuti', 'orario', 'giornaliero']
      example: 'giornaliero'
    RateLimitingChiaveEnum:
      type: string
      enum: ['content-based', 'header-based', 'soap-action-based', 'url-based', 'form-based', 'indirizzo-ip', 'indirizzo-ip-forwarded', 'plugin-based']
      example: 'content-based'   
    CorrelazioneApplicativaRichiestaEnum:
      type: string
      enum: ['content-based', 'header-based', 'url-based', 'input-based', 'template', 'freemarker-template', 'velocity-template', 'disabilitato']
      example: 'content-based'
    CorrelazioneApplicativaRispostaEnum:
      type: string
      enum: ['content-based', 'header-based', 'input-based', 'template', 'freemarker-template', 'velocity-template', 'disabilitato']
      example: 'content-based'
    ConfigurazioneCanaleEnum:
      type: string
      enum: ['default', 'ridefinito']
    CanaleEnum:
      type: string
      enum: ['default', 'api', 'implementazione-api']
    ConnettoreEnum:
      type: string
      enum: 
        - 'http'
        - 'file'
        - 'jms'
        - 'null'
        - 'echo'
        - 'status'
        - 'plugin'
        - 'applicativo-server'
        - 'message-box'
    ConnettoreJmsTipoEnum:
      type: string
      enum: ['queue', 'topic']
      example: 'queue'
    ConnettoreJmsSendAsEnum:
      type: string
      enum: ['text', 'bytes']
      example: 'text'
    DiagnosticiSeverita:
      type: string
      enum: ['off', 'fatal', 'error-protocol', 'error-integration', 'info-protocol', 'info-integration', 'debug-low', 'debug-medium', 'debug-high', 'all']
      default: info-integration
    TracciamentoTransazioniStato:
      type: string
      enum: ['abilitato', 'disabilitato', 'personalizzato', 'configurazioneEsterna']
      example: 'abilitato'
    TracciamentoTransazioniStatoFaseBloccante:
      type: string
      enum: ['bloccante', 'non-bloccante', 'disabilitato']
    TracciamentoTransazioniStatoFase:
      type: string
      enum: ['abilitato', 'disabilitato']
    TipoRispostaStatusEnum:
       type: string
       enum: ['ModI', 'vuoto', 'xml', 'json', 'text']
    TipoPeriodoStatisticoEnum:
       type: string
       enum: ['orario','giornaliero','settimanale','mensile']
       default: giornaliero
    # ModI: Enumeration
    ModISicurezzaCanaleEnum:
      type: string
      enum: ['auth01', 'auth02']
    ModISicurezzaMessaggioEnum:
      type: string
      enum: ['disabilitato', 'auth01', 'auth02', 'integrity01-auth01', 'integrity01-auth02', 'integrity02-auth01', 'integrity02-auth02']
    ModISicurezzaMessaggioGenerazioneTokenEnum:
      type: string
      enum: ['locale', 'pdnd', 'oauth']
    ModISicurezzaMessaggioRestHeaderEnum:
      type: string
      enum: ['agid', 'bearer', 'agid+bearer-request', 'agid+bearer', 'custom', 'custom+bearer-request', 'custom+bearer' ]
    ModISicurezzaMessaggioPatternAuditEnum:
      type: string
      enum: ['audit-rest01', 'audit-rest02', 'audit-legacy']
    ModISicurezzaMessaggioRestTokenChoiseEnum:
      type: string
      enum: ['agid', 'bearer' ]
      default: agid
    ModISicurezzaMessaggioRestSameDifferentEnum:
      type: string
      enum: ['same', 'different' ]
      default: same
    ModISicurezzaMessaggioApplicabilitaEnum:
      type: string
      enum: ['richiesta', 'risposta', 'qualsiasi', 'custom']
      default: qualsiasi
    ModISicurezzaMessaggioApplicabilitaCustomEnum:
      type: string
      enum: ['abilitato', 'disabilitato', 'custom']
      default: abilitato
    ModIPatternInterazioneEnum:
      type: string
      enum: ['crud', 'bloccante' ,'non-bloccante']
    ModIPatternInterazioneTipoEnum:
      type: string
      enum: ['push', 'pull']
    ModIPatternInterazioneFunzioneEnum:
      type: string
      enum: ['richiesta', 'risposta']
    ModISicurezzaMessaggioOperazioneEnum:
      type: string
      enum: ['api', 'ridefinito']
      default: api
    ModITruststoreEnum:
      type: string
      enum: ['jks', 'pkcs11']
      example: 'jks'
    ModIKeystoreEnum:
      type: string
      enum: ['jks', 'pkcs12']
      example: 'jks'
    ModIKeystoreTipologiaEnum:
      type: string
      enum: ['archivio', 'filesystem', 'hsm']
      example: 'filesystem'
    ModISicurezzaMessaggioSoapAlgoritmoFirma:
      type: string
      enum: ['DSA-SHA-256', 'ECDSA-SHA-256', 'ECDSA-SHA-384', 'ECDSA-SHA-512', 'RSA-SHA-256', 'RSA-SHA-384', 'RSA-SHA-512']
      default: RSA-SHA-256
    ModISicurezzaMessaggioSoapFormaCanonicaXml:
      type: string
      enum: ['canonical-xml-10', 'canonical-xml-11', 'exclusive-canonical-xml-10']
      default: exclusive-canonical-xml-10       
    ModISicurezzaMessaggioSoapRiferimentoX509:
      type: string
      enum: ['binary-security-token', 'issuer-serial-security-token-reference', 'ski-key-identifier', 'thumbprint-key-identifier', 'x509-key-identifier']
      default: binary-security-token       
    ModISicurezzaMessaggioRestAlgoritmoFirma:
      type: string
      enum: ['ES256', 'ES384', 'ES512', 'RS256', 'RS384', 'RS512']
      default: RS256
    ModISicurezzaMessaggioRestRiferimentoX509:
      type: string
      enum: ['x5c', 'x5t#256', 'x5u']
      default: x5c 
    ModISicurezzaMessaggioRestRiferimentoX509Risposta:
      type: string
      enum: ['richiesta', 'ridefinito']
      default: richiesta
