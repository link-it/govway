<config id="retrieveToken" 
	label="Negoziazione" 
	xmlns="http://www.openspcoop2.org/core/mvc/properties" 
	provider="org.openspcoop2.pdd.core.token.NegoziazioneTokenProvider">

	<properties>
		<collection name="endpointConfig"/>
		<collection name="sslConfig"/>
		<collection name="sslClientConfig"/>
		<collection name="retrieveTokenParserPropRefId"/>
	</properties>
	
	<section label="Token Endpoint">

		<item type="hidden" name="tokenParserType" value="OAUTH2_RFC_6749">
			<property name="policy.retrieveToken.claimsParser" />
		</item>
		
		<item type="hidden" name="saveErrorInCache" value="false">
			<property name="policy.retrieveToken.saveErrorInCache"/>
		</item>

		<item type="select" name="retrieveTokenMethod" label="Tipo" reloadOnChange="true">
			<property name="policy.retrieveToken.mode" />
		</item>

		<item type="checkbox" name="jwtPDND" label="PDND" defaultSelected="false" reloadOnChange="true">
			<conditions>
				<condition and="false">
					<equals name="retrieveTokenMethod" value="rfc7523_x509"/>
				</condition>
			</conditions>
			<property name="policy.retrieveToken.jwt.pdnd" />
		</item>

		<item type="textarea" name="endpointURL" label="URL" required="true" default="http://">
			<property name="policy.retrieveToken.endpoint.url" />
		</item>

		<item type="number" name="endpointConnectionTimeout" label="Connection Timeout" required="true" default="5000" min="1">
			<property name="connectionTimeout" properties="endpointConfig" />
		</item>
		<item type="number" name="endpointReadTimeout" label="Read Timeout" required="true" default="10000" min="1">
			<property name="readConnectionTimeout" properties="endpointConfig" />
		</item>
	
		<item type="checkbox" name="endpointHttps" label="Https" defaultSelected="false" reloadOnChange="true">
			<property name="policy.endpoint.https.stato" />
		</item>	
		
		<item type="checkbox" name="endpointProxy" label="Proxy" defaultSelected="false" reloadOnChange="true">
			<property name="policy.endpoint.proxy.stato" />
		</item>	

		<subsection label="Autenticazione Utente">
			<conditions>
				<condition and="true">
					<equals name="retrieveTokenMethod" value="usernamePassword"/>
				</condition>
			</conditions>
			<item type="text" name="autenticazioneUsername" label="Username" required="true">
			      	<property name="policy.retrieveToken.username" />
			</item>
			<item type="lock" name="autenticazionePassword" label="Password" required="true">
			      	<property name="policy.retrieveToken.password" />
			</item>
		</subsection>

		<subsection label="Autenticazione Client">
			<conditions>
				<condition and="false">
					<equals name="retrieveTokenMethod" value="usernamePassword"/>
					<equals name="retrieveTokenMethod" value="clientCredentials"/>
					<equals name="retrieveTokenMethod" value="custom"/>
				</condition>
			</conditions>
			<item type="checkbox" name="autenticazioneEndpointBasic" label="Basic" defaultSelected="false" reloadOnChange="true">
				<!--  non si puo' verificare una condizione successiva. Comunque selezionando basic, sparisce bearer.
				<conditions>
					<condition not="true" and="true">
						<selected name="autenticazioneEndpointBearer"/>
					</condition>
				</conditions>
				-->
				<property name="policy.retrieveToken.endpoint.basic.stato" />
			</item>
			<item type="checkbox" name="autenticazioneEndpointBearer" label="Bearer" defaultSelected="false" reloadOnChange="true">
				<conditions and="true">
					<condition not="true" and="true">
						<selected name="autenticazioneEndpointBasic"/>
					</condition>
				</conditions>
				<property name="policy.retrieveToken.endpoint.bearer.stato" />
			</item>

			<item type="text" name="autenticazioneEndpointBasicUsername" label="Client ID" required="true">
				<conditions>
					<condition and="true">
						<selected name="autenticazioneEndpointBasic"/>
						<equals name="retrieveTokenMethod" value="custom" not="true"/>
					</condition>
				</conditions>
			      	<property name="policy.retrieveToken.endpoint.basic.username" />
			</item>
			<item type="text" name="autenticazioneEndpointBasicUsernameCustom" label="Username" required="true">
				<conditions>
					<condition and="true">
						<selected name="autenticazioneEndpointBasic"/>
						<equals name="retrieveTokenMethod" value="custom"/>
					</condition>
				</conditions>
			      	<property name="policy.retrieveToken.endpoint.basic.username" />
			</item>
			<item type="lock" name="autenticazioneEndpointBasicPassword" label="Client Secret" required="true">
				<conditions>
					<condition and="true">
						<selected name="autenticazioneEndpointBasic"/>
						<equals name="retrieveTokenMethod" value="custom" not="true"/>
					</condition>
				</conditions>
			      	<property name="policy.retrieveToken.endpoint.basic.password" />
			</item>
			<item type="lock" name="autenticazioneEndpointBasicPasswordCustom" label="Password" required="true">
				<conditions>
					<condition and="true">
						<selected name="autenticazioneEndpointBasic"/>
						<equals name="retrieveTokenMethod" value="custom"/>
					</condition>
				</conditions>
			      	<property name="policy.retrieveToken.endpoint.basic.password" />
			</item>
			<item type="checkbox" name="autenticazioneEndpointBasicAuthorizationHeader" 
			      label="Authorization Bearer" defaultSelected="true"
			      note="Se disabilitato le credenziali vengono codificate nella richiesta 'x-www-form-urlencoded'">
				<conditions>
					<condition and="true">
						<selected name="autenticazioneEndpointBasic"/>
						<equals name="retrieveTokenMethod" value="custom" not="true"/>
					</condition>
				</conditions>
			      	<property name="policy.retrieveToken.endpoint.basic.asAuthorizationHeader" />
			</item>
			<item type="hidden" name="autenticazioneEndpointBasicAuthorizationHeaderCustom" value="true">
				<conditions>
					<condition and="true">
						<selected name="autenticazioneEndpointBasic"/>
						<equals name="retrieveTokenMethod" value="custom" />
					</condition>
				</conditions>
			      	<property name="policy.retrieveToken.endpoint.basic.asAuthorizationHeader" />
			</item>
			<item type="lock" name="autenticazioneEndpointBearerToken" label="Token" required="true">
				<conditions>
					<condition and="true">
						<selected name="autenticazioneEndpointBearer"/>
					</condition>
				</conditions>
			      	<property name="policy.retrieveToken.endpoint.bearer.token" />
			</item>

			<item type="checkbox" name="autenticazioneEndpointHttps" label="Https" defaultSelected="false" reloadOnChange="true">
				<property name="policy.retrieveToken.endpoint.https.stato" />
			</item>
	
		</subsection>

		<subsection label="JWT KeyStore">
			<conditions>
				<condition and="false">
					<equals name="retrieveTokenMethod" value="rfc7523_x509"/>
				</condition>
			</conditions>

			<item type="select" name="jwtKeystoreType" label="Tipo" default="jks" reloadOnChange="true">
				<property name="policy.retrieveToken.jwt.signature.keystoreType" />
			</item>
			<item type="textarea" name="jwtKeystoreFile" label="File" required="true">
				<conditions and="true">
					<condition not="true" and="false">
						<equals name="jwtKeystoreType" value="keys"/>
					</condition>
				</conditions>
				<property name="policy.retrieveToken.jwt.signature.keystoreFile" />
			</item>
			<item type="textarea" name="jwtKeystorePrivateKey" label="Chiave Privata" required="true">
				<conditions and="true">
					<condition and="false">
						<equals name="jwtKeystoreType" value="keys"/>
					</condition>
				</conditions>
				<property name="policy.retrieveToken.jwt.signature.keystoreFile" />
			</item>
			<item type="textarea" name="jwtKeystorePublicKey" label="Chiave Pubblica" required="true">
				<conditions and="true">
					<condition and="false">
						<equals name="jwtKeystoreType" value="keys"/>
					</condition>
				</conditions>
				<property name="policy.retrieveToken.jwt.signature.keystoreFilePublicKey" />
			</item>
			<item type="hidden" name="jwtKeystoreKeyPairAlgorithm" value="RSA">
				<conditions and="true">
					<condition and="false">
						<equals name="jwtKeystoreType" value="keys"/>
					</condition>
				</conditions>
				<property name="policy.retrieveToken.jwt.signature.keyPairAlgorithm" />
			</item>
			<item type="lock" name="jwtKeystorePassword" label="Password" required="true">
				<conditions and="true">
					<condition not="true" and="false">
						<equals name="jwtKeystoreType" value="jwk"/>
						<equals name="jwtKeystoreType" value="keys"/>
					</condition>
				</conditions>
				<property name="policy.retrieveToken.jwt.signature.keystorePassword" />
			</item>
			<item type="text" name="jwtAliasChiavePrivata" label="Alias Chiave Privata" required="true">
				<conditions and="true">
					<condition not="true" and="false">
						<equals name="jwtKeystoreType" value="keys"/>
					</condition>
				</conditions>
				<property name="policy.retrieveToken.jwt.signature.keyAlias" />
			</item>
			<item type="lock" name="jwtPasswordChiavePrivata" label="Password Chiave Privata" required="true">
				<conditions and="true">
					<condition not="true" and="false">
						<equals name="jwtKeystoreType" value="jwk"/>
						<equals name="jwtKeystoreType" value="keys"/>
					</condition>
				</conditions>				
				<property name="policy.retrieveToken.jwt.signature.keyPassword" />
			</item>
			<item type="lock" name="jwtPasswordChiavePrivataOpzionale" label="Password Chiave Privata" required="false">
				<conditions and="true">
					<condition and="false">
						<equals name="jwtKeystoreType" value="keys"/>
					</condition>
				</conditions>				
				<property name="policy.retrieveToken.jwt.signature.keyPassword" />
			</item>
			<item type="select" name="jwtByokPolicy" label="BYOK Policy" default="" reloadOnChange="true">
				<property name="policy.retrieveToken.jwt.signature.byok" />
			</item>

		</subsection>

		<subsection label="JWT Signature">
			<conditions>
				<condition and="false">
					<equals name="retrieveTokenMethod" value="rfc7523_x509"/>
					<equals name="retrieveTokenMethod" value="rfc7523_clientSecret"/>
				</condition>
			</conditions>

			<item type="select" name="jwtSymmetricSignatureAlgorithm" label="Signature Algorithm" >
				<conditions>
					<condition and="false">
						<equals name="retrieveTokenMethod" value="rfc7523_clientSecret"/>
					</condition>
				</conditions>
			      	<property name="policy.retrieveToken.jwt.signature.algorithm"/>
			</item>
			<item type="select" name="jwtAsymmetricSignatureAlgorithm" label="Signature Algorithm" >
				<conditions>
					<condition and="false">
						<equals name="retrieveTokenMethod" value="rfc7523_x509"/>
					</condition>
				</conditions>
			      	<property name="policy.retrieveToken.jwt.signature.algorithm"/>
			</item>

			<item type="lock" name="jwtSecret" label="Client Secret" required="true">
				<conditions>
					<condition and="false">
						<equals name="retrieveTokenMethod" value="rfc7523_clientSecret"/>
					</condition>
				</conditions>
			      	<property name="policy.retrieveToken.jwt.clientSecret" />
			</item>
		</subsection>

		<subsection label="JWT Header">
			<conditions>
				<condition and="false">
					<equals name="retrieveTokenMethod" value="rfc7523_x509"/>
					<equals name="retrieveTokenMethod" value="rfc7523_clientSecret"/>
				</condition>
			</conditions>

			<item type="select" name="jwtSymmetricSignatureKid" label="Key Id (kid)" reloadOnChange="true" >
				<conditions>
					<condition and="false">
						<equals name="retrieveTokenMethod" value="rfc7523_clientSecret"/>
					</condition>
				</conditions>
				<values>
					<value value="false" label="-"/>
					<value value="client_id" label="Client ID"/>
					<value value="custom" label="Personalizzato"/>
				</values>
			      	<property name="policy.retrieveToken.jwt.signature.include.key.id"/>
			</item>
			<item type="select" name="jwtAsymmetricSignatureKid" label="Key Id (kid)" reloadOnChange="true" >
				<conditions and="true">
					<condition>
						<equals name="retrieveTokenMethod" value="rfc7523_x509"/>
					</condition>
					<condition not="true" and="false">
						<equals name="jwtKeystoreType" value="applicativoModi"/>
						<equals name="jwtKeystoreType" value="fruizioneModi"/>
						<equals name="jwtKeystoreType" value="keys"/>
					</condition>
				</conditions>
				<values>
					<value value="false" label="-"/>
					<value value="true" label="Alias Chiave Privata"/>
					<value value="client_id" label="Client ID"/>
					<value value="custom" label="Personalizzato"/>
				</values>
			      	<property name="policy.retrieveToken.jwt.signature.include.key.id"/>
			</item>
			<item type="select" name="jwtAsymmetricSignatureKidConApplicativoModi" label="Key Id (kid)" reloadOnChange="true" default="applicativoModi">
				<conditions and="true">
					<condition>
						<equals name="retrieveTokenMethod" value="rfc7523_x509"/>
					</condition>
					<condition>
						<equals name="jwtKeystoreType" value="applicativoModi"/>
					</condition>
				</conditions>
				<values>
					<value value="false" label="-"/>
					<value value="applicativoModi" label="Definito nell'applicativo ModI"/>
					<value value="true" label="Alias Chiave Privata"/>
					<value value="client_id" label="Client ID"/>
					<value value="custom" label="Personalizzato"/>
				</values>
			      	<property name="policy.retrieveToken.jwt.signature.include.key.id"/>
			</item>
			<item type="select" name="jwtAsymmetricSignatureKidConFruizioneModi" label="Key Id (kid)" reloadOnChange="true" default="fruizioneModi">
				<conditions and="true">
					<condition>
						<equals name="retrieveTokenMethod" value="rfc7523_x509"/>
					</condition>
					<condition>
						<equals name="jwtKeystoreType" value="fruizioneModi"/>
					</condition>
				</conditions>
				<values>
					<value value="false" label="-"/>
					<value value="fruizioneModi" label="Definito nella fruizione ModI"/>
					<value value="true" label="Alias Chiave Privata"/>
					<value value="client_id" label="Client ID"/>
					<value value="custom" label="Personalizzato"/>
				</values>
			      	<property name="policy.retrieveToken.jwt.signature.include.key.id"/>
			</item>
			<item type="select" name="jwtAsymmetricSignatureKidKeyPair" label="Key Id (kid)" reloadOnChange="true" >
				<conditions and="true">
					<condition>
						<equals name="retrieveTokenMethod" value="rfc7523_x509"/>
					</condition>
					<condition>
						<equals name="jwtKeystoreType" value="keys"/>
					</condition>
				</conditions>
				<values>
					<value value="false" label="-"/>
					<value value="client_id" label="Client ID"/>
					<value value="custom" label="Personalizzato"/>
				</values>
			      	<property name="policy.retrieveToken.jwt.signature.include.key.id"/>
			</item>
			<item type="text" name="jwtSignatureKidValue" label="" required="true">
				<conditions and="false">
					<condition and="true">
						<equals name="retrieveTokenMethod" value="rfc7523_clientSecret"/>
						<equals name="jwtSymmetricSignatureKid" value="custom"/>
					</condition>
					<condition and="true">
						<equals name="retrieveTokenMethod" value="rfc7523_x509"/>
						<equals name="jwtAsymmetricSignatureKid" value="custom"/>
					</condition>
					<condition and="true">
						<equals name="retrieveTokenMethod" value="rfc7523_x509"/>
						<equals name="jwtAsymmetricSignatureKidConApplicativoModi" value="custom"/>
					</condition>
					<condition and="true">
						<equals name="retrieveTokenMethod" value="rfc7523_x509"/>
						<equals name="jwtAsymmetricSignatureKidConFruizioneModi" value="custom"/>
					</condition>
					<condition and="true">
						<equals name="retrieveTokenMethod" value="rfc7523_x509"/>
						<equals name="jwtAsymmetricSignatureKidKeyPair" value="custom"/>
					</condition>
				</conditions>
			      	<property name="policy.retrieveToken.jwt.signature.include.key.id.value" />
			</item>
			<item type="select" name="jwtSignatureIncludeCertMode" label="X.509 Certificate" default="-" reloadOnChange="true" >
				<conditions and="true">
					<condition and="false">
						<equals name="retrieveTokenMethod" value="rfc7523_x509"/>
					</condition>
					<condition not="true" and="false">
						<equals name="jwtKeystoreType" value="jwk"/>
					</condition>
				</conditions>
				<values>
					<value value="-" label="-"/>
					<value value="x5c" label="Include (x5c)"/>
					<value value="x5u" label="URL (x5u)"/>
				</values>
				<property name="jwtSignatureIncludeCertMode" />
			</item>
			<item type="hidden" name="jwtSignatureIncludeCertModeX5C" value="true">
				<conditions>
					<condition>
						<equals name="jwtSignatureIncludeCertMode" value="x5c"/>
					</condition>
				</conditions>
				<property name="policy.retrieveToken.jwt.signature.include.cert" />
			</item>
			<item type="textarea" name="jwtSignatureIncludeCertModeX5U" label="URL" required="true">
				<conditions>
					<condition>
						<equals name="jwtSignatureIncludeCertMode" value="x5u"/>
					</condition>
				</conditions>
				<property name="policy.retrieveToken.jwt.signature.include.x509url" />
			</item>
			<item type="select" name="jwtSignatureIncludeCertShaMode" label="Digest X.509 Certificate" default="-" reloadOnChange="true" >
				<conditions and="true">
					<condition and="false">
						<equals name="retrieveTokenMethod" value="rfc7523_x509"/>
					</condition>
					<condition not="true" and="false">
						<equals name="jwtKeystoreType" value="jwk"/>
					</condition>
				</conditions>
				<values>
					<value value="-" label="-"/>
					<value value="sha1" label="SHA-1 (x5t)"/>
					<value value="sha256" label="SHA-256 (x5t#S256)"/>
				</values>
				<property name="jwtSignatureIncludeCertShaMode" />
			</item>
			<item type="hidden" name="jwtSignatureIncludeCertShaModeSHA1" value="true">
				<conditions>
					<condition>
						<equals name="jwtSignatureIncludeCertShaMode" value="sha1"/>
					</condition>
				</conditions>
				<property name="policy.retrieveToken.jwt.signature.include.cert.sha1" />
			</item>
			<item type="hidden" name="jwtSignatureIncludeCertShaModeSHA256" value="true">
				<conditions>
					<condition>
						<equals name="jwtSignatureIncludeCertShaMode" value="sha256"/>
					</condition>
				</conditions>
				<property name="policy.retrieveToken.jwt.signature.include.cert.sha256"/>
			</item>

			<item type="text" name="jwtIncludeType" label="Type (typ)" required="true" default="JWT">
				<property name="policy.retrieveToken.jwt.signature.joseType" />
			</item>
			<item type="checkbox" name="jwtIncludeContentType" label="Content Type (cty)" defaultSelected="false">
				<property name="policy.retrieveToken.jwt.signature.joseContentType"/>
			</item>

		</subsection>

		<subsection label="JWT Payload">
			<conditions>
				<condition and="false">
					<equals name="retrieveTokenMethod" value="rfc7523_x509"/>
					<equals name="retrieveTokenMethod" value="rfc7523_clientSecret"/>
				</condition>
			</conditions>

			<item type="select" name="jwtClientIdApplicativoModiChoice" label="Client ID" default="applicativoModi" reloadOnChange="true">
			      	<conditions and="true">
					<condition>
						<equals name="retrieveTokenMethod" value="rfc7523_x509"/>
					</condition>
					<condition>
						<equals name="jwtKeystoreType" value="applicativoModi"/>
					</condition>
				</conditions>
				<values>
					<value value="applicativoModi" label="Definito nell'applicativo ModI"/>
					<value value="custom" label="Personalizzato"/>
				</values>
			      	<property name="policy.retrieveToken.jwt.clientId.mode"/>
			</item>
			<item type="select" name="jwtClientIdFruizioneModiChoice" label="Client ID" default="fruizioneModi" reloadOnChange="true">
			      	<conditions and="true">
					<condition>
						<equals name="retrieveTokenMethod" value="rfc7523_x509"/>
					</condition>
					<condition>
						<equals name="jwtKeystoreType" value="fruizioneModi"/>
					</condition>
				</conditions>
				<values>
					<value value="fruizioneModi" label="Definito nella fruizione ModI"/>
					<value value="custom" label="Personalizzato"/>
				</values>
			      	<property name="policy.retrieveToken.jwt.clientId.mode"/>
			</item>
			<item type="text" name="jwtClientIdApplicativoModiChoiceInput" label="" required="true">
			      	<conditions and="false">
					<condition>
						<defined name="jwtClientIdApplicativoModiChoice"/>
						<equals name="jwtClientIdApplicativoModiChoice" value="custom"/>
					</condition>
				</conditions>
			      	<property name="policy.retrieveToken.jwt.clientId" />
			</item>
			<item type="text" name="jwtClientIdFruizioneModiChoiceInput" label="" required="true">
			      	<conditions and="false">
					<condition>
						<defined name="jwtClientIdFruizioneModiChoice"/>
						<equals name="jwtClientIdFruizioneModiChoice" value="custom"/>
					</condition>
				</conditions>
			      	<property name="policy.retrieveToken.jwt.clientId" />
			</item>
			<item type="text" name="jwtClientId" label="Client ID" required="true">
			      	<conditions and="true">
					<condition>
						<defined name="jwtClientIdApplicativoModiChoice" not="true"/>
						<defined name="jwtClientIdFruizioneModiChoice" not="true"/>
					</condition>
				</conditions>
			      	<property name="policy.retrieveToken.jwt.clientId" />
			</item>

			<item type="select" name="jwtIssuerApplicativoModiChoice" label="Issuer" default="applicativoModi" reloadOnChange="true">
			      	<conditions and="true">
					<condition>
						<equals name="retrieveTokenMethod" value="rfc7523_x509"/>
					</condition>
					<condition>
						<equals name="jwtKeystoreType" value="applicativoModi"/>
					</condition>
				</conditions>
				<values>
					<value value="applicativoModi" label="ClientID dell'applicativo ModI"/>
					<value value="custom" label="Personalizzato"/>
				</values>
			      	<property name="policy.retrieveToken.jwt.issuer.mode"/>
			</item>
			<item type="select" name="jwtIssuerFruizioneModiChoice" label="Issuer" default="fruizioneModi" reloadOnChange="true">
			      	<conditions and="true">
					<condition>
						<equals name="retrieveTokenMethod" value="rfc7523_x509"/>
					</condition>
					<condition>
						<equals name="jwtKeystoreType" value="fruizioneModi"/>
					</condition>
				</conditions>
				<values>
					<value value="fruizioneModi" label="ClientID della fruizione ModI"/>
					<value value="custom" label="Personalizzato"/>
				</values>
			      	<property name="policy.retrieveToken.jwt.issuer.mode"/>
			</item>
			<item type="text" name="jwtIssuerApplicativoModiChoiceInput" label="" required="true">
			      	<conditions and="false">
					<condition>
						<defined name="jwtIssuerApplicativoModiChoice"/>
						<equals name="jwtIssuerApplicativoModiChoice" value="custom"/>
					</condition>
				</conditions>
			      	<property name="policy.retrieveToken.jwt.issuer" />
			</item>
			<item type="text" name="jwtIssuerFruizioneModiChoiceInput" label="" required="true">
			      	<conditions and="false">
					<condition>
						<defined name="jwtIssuerFruizioneModiChoice"/>
						<equals name="jwtIssuerFruizioneModiChoice" value="custom"/>
					</condition>
				</conditions>
			      	<property name="policy.retrieveToken.jwt.issuer" />
			</item>
			<item type="text" name="jwtIssuer" label="Issuer" required="false">
			      	<conditions and="true">
					<condition>
						<defined name="jwtIssuerApplicativoModiChoice" not="true"/>
						<defined name="jwtIssuerFruizioneModiChoice" not="true"/>
					</condition>
				</conditions>
			    	<property name="policy.retrieveToken.jwt.issuer" />
			</item>

			<item type="select" name="jwtSubjectApplicativoModiChoice" label="Subject" default="applicativoModi" reloadOnChange="true">
			      	<conditions and="true">
					<condition>
						<equals name="retrieveTokenMethod" value="rfc7523_x509"/>
					</condition>
					<condition>
						<equals name="jwtKeystoreType" value="applicativoModi"/>
					</condition>
				</conditions>
				<values>
					<value value="applicativoModi" label="ClientID dell'applicativo ModI"/>
					<value value="custom" label="Personalizzato"/>
				</values>
			      	<property name="policy.retrieveToken.jwt.subject.mode"/>
			</item>
			<item type="select" name="jwtSubjectFruizioneModiChoice" label="Subject" default="fruizioneModi" reloadOnChange="true">
			      	<conditions and="true">
					<condition>
						<equals name="retrieveTokenMethod" value="rfc7523_x509"/>
					</condition>
					<condition>
						<equals name="jwtKeystoreType" value="fruizioneModi"/>
					</condition>
				</conditions>
				<values>
					<value value="fruizioneModi" label="ClientID della fruizione ModI"/>
					<value value="custom" label="Personalizzato"/>
				</values>
			      	<property name="policy.retrieveToken.jwt.subject.mode"/>
			</item>
			<item type="text" name="jwtSubjectApplicativoModiChoiceInput" label="" required="true">
			      	<conditions and="false">
					<condition>
						<defined name="jwtSubjectApplicativoModiChoice"/>
						<equals name="jwtSubjectApplicativoModiChoice" value="custom"/>
					</condition>
				</conditions>
			      	<property name="policy.retrieveToken.jwt.subject" />
			</item>
			<item type="text" name="jwtSubjectFruizioneModiChoiceInput" label="" required="true">
			      	<conditions and="false">
					<condition>
						<defined name="jwtSubjectFruizioneModiChoice"/>
						<equals name="jwtSubjectFruizioneModiChoice" value="custom"/>
					</condition>
				</conditions>
			      	<property name="policy.retrieveToken.jwt.subject" />
			</item>
			<item type="text" name="jwtSubject" label="Subject" required="false">
			      	<conditions and="true">
					<condition>
						<defined name="jwtSubjectApplicativoModiChoice" not="true"/>
						<defined name="jwtSubjectFruizioneModiChoice" not="true"/>
					</condition>
				</conditions>
			      	<property name="policy.retrieveToken.jwt.subject" />
			</item>

			<item type="text" name="jwtAudience" label="Audience" required="true">
			    <property name="policy.retrieveToken.jwt.audience" />
			</item>

			<item type="text" name="jwtIdentifier" label="Identifier" required="false" default="${transaction:id}">
			      	<property name="policy.retrieveToken.jwt.jti" />
			</item>			

			<item type="number" name="jwtExpTtl" label="Time to Live (secondi)" required="true"
				note="Indica la validità temporale, in secondi, a partire dalla data di creazione dell'asserzione">
				<property name="policy.retrieveToken.jwt.expired" />
			</item>

			<item type="text" name="jwtPurposeID" label="Purpose ID" required="true">
				<conditions>
					<condition and="false">
						<selected name="jwtPDND"/>
					</condition>	
				</conditions>
				<property name="policy.retrieveToken.jwt.purposeId" />
			</item>
			<item type="textarea" name="jwtSessionInfo" label="Informazioni Sessione" required="false"
				note="Indicare per riga i claims (nome=valore) da aggiungere nell'oggetto 'sessionInfo'">
				<conditions>
					<condition and="false">
						<selected name="jwtPDND"/>
					</condition>	
				</conditions>
				<property name="policy.retrieveToken.jwt.sessionInfo" />
			</item>

			<item type="textarea" name="jwtPayloadClaims" label="Claims" required="false"
				note="Indicare per riga gli ulteriori claims (nome=valore)">
				<property name="policy.retrieveToken.jwt.claims" />
			</item>

		</subsection>
	
		<subsection label="Dati Richiesta">

			<item type="text" name="scope" label="Scope" required="false" note="Elencare più scope separandoli con la virgola">
				<conditions>
					<condition not="true">
						<equals name="retrieveTokenMethod" value="custom"/>
					</condition>
				</conditions>
				<property name="policy.retrieveToken.scope" />
			</item>

			<item type="text" name="audience" label="Audience" required="false">
				<conditions>
					<condition not="true">
						<equals name="retrieveTokenMethod" value="custom"/>
					</condition>
				</conditions>
				<property name="policy.retrieveToken.audience" />
			</item>

			<item type="select" name="formClientIdApplicativoModiChoice" label="Client ID" default="applicativoModi" reloadOnChange="true">
			      	<conditions and="true">
					<condition and="false">
						<selected name="jwtPDND"/>
					</condition>
					<condition>
						<equals name="retrieveTokenMethod" value="rfc7523_x509"/>
					</condition>
					<condition>
						<equals name="jwtKeystoreType" value="applicativoModi"/>
					</condition>
				</conditions>
				<values>
					<value value="applicativoModi" label="ClientID dell'applicativo ModI"/>
					<value value="custom" label="Personalizzato"/>
				</values>
			      	<property name="policy.retrieveToken.formClientId.mode"/>
			</item>
			<item type="select" name="formClientIdFruizioneModiChoice" label="Client ID" default="fruizioneModi" reloadOnChange="true">
			      	<conditions and="true">
					<condition and="false">
						<selected name="jwtPDND"/>
					</condition>
					<condition>
						<equals name="retrieveTokenMethod" value="rfc7523_x509"/>
					</condition>
					<condition>
						<equals name="jwtKeystoreType" value="fruizioneModi"/>
					</condition>
				</conditions>
				<values>
					<value value="fruizioneModi" label="ClientID della fruizione ModI"/>
					<value value="custom" label="Personalizzato"/>
				</values>
			      	<property name="policy.retrieveToken.formClientId.mode"/>
			</item>
			<item type="text" name="formClientIdApplicativoModiChoiceInput" label="" required="true">
			      	<conditions and="true">
					<condition and="false">
						<selected name="jwtPDND"/>
					</condition>
					<condition>
						<defined name="formClientIdApplicativoModiChoice"/>
						<equals name="formClientIdApplicativoModiChoice" value="custom"/>
					</condition>
				</conditions>
			      	<property name="policy.retrieveToken.formClientId" />
			</item>
			<item type="text" name="formClientIdFruizioneModiChoiceInput" label="" required="true">
			      	<conditions and="true">
					<condition and="false">
						<selected name="jwtPDND"/>
					</condition>
					<condition>
						<defined name="formClientIdFruizioneModiChoice"/>
						<equals name="formClientIdFruizioneModiChoice" value="custom"/>
					</condition>
				</conditions>
			      	<property name="policy.retrieveToken.formClientId" />
			</item>
			<item type="text" name="formClientId" label="Client ID" required="false">
			      	<conditions and="true">
					<condition and="false">
						<selected name="jwtPDND"/>
					</condition>
					<condition and="true">
						<defined name="formClientIdApplicativoModiChoice" not="true"/>
						<defined name="formClientIdFruizioneModiChoice" not="true"/>
					</condition>
				</conditions>
			      	<property name="policy.retrieveToken.formClientId" />
			</item>

			<item type="text" name="formResource" label="Resource" required="false">
				<conditions>
					<condition and="false">
						<selected name="jwtPDND"/>
					</condition>	
				</conditions>
				<property name="policy.retrieveToken.formResource" />
			</item>

			<item type="textarea" name="formParameters" label="Parametri" required="false"
				note="Indicare per riga gli ulteriori parametri (nome=valore)">
				<conditions>
					<condition not="true">
						<equals name="retrieveTokenMethod" value="custom"/>
					</condition>
				</conditions>
				<property name="policy.retrieveToken.formParameters" />
			</item>

			<item type="select" name="httpMethod" label="Metodo HTTP" reloadOnChange="true">
				<conditions>
					<condition>
						<equals name="retrieveTokenMethod" value="custom"/>
					</condition>
				</conditions>
				<property name="policy.retrieveToken.httpMethod" />
			</item>

			<item type="checkbox" name="httpMethodPayloadDefinedDefaultTrue" label="Payload" defaultSelected="true" reloadOnChange="true">
				<conditions and="true">
					<condition>
						<equals name="retrieveTokenMethod" value="custom"/>
					</condition>
                                        <condition and="false">
						<equals name="httpMethod" value="POST"/>
						<equals name="httpMethod" value="PUT"/>
						<equals name="httpMethod" value="PATCH"/>
						<equals name="httpMethod" value="LINK"/>
						<equals name="httpMethod" value="UNLINK"/>
                                        </condition>
				</conditions>
				<property name="policy.retrieveToken.httpMethod.payloadDefined" />
			</item>
			<item type="checkbox" name="httpMethodPayloadDefinedDefaultFalse" label="Payload" defaultSelected="false" reloadOnChange="true">
				<conditions and="true">
					<condition>
						<equals name="retrieveTokenMethod" value="custom"/>
					</condition>
                                        <condition not="true" and="false">
						<equals name="httpMethod" value="POST"/>
						<equals name="httpMethod" value="PUT"/>
						<equals name="httpMethod" value="PATCH"/>
						<equals name="httpMethod" value="LINK"/>
						<equals name="httpMethod" value="UNLINK"/>
                                        </condition>
				</conditions>
				<property name="policy.retrieveToken.httpMethod.payloadDefined" />
			</item>

			<item type="textarea" name="httpContentType" label="Content-Type" required="true" max="1">
				<conditions and="true">
					<condition>
						<equals name="retrieveTokenMethod" value="custom"/>
					</condition>
					<condition and="false">
						<selected name="httpMethodPayloadDefinedDefaultTrue"/>
						<selected name="httpMethodPayloadDefinedDefaultFalse"/>
					</condition>
				</conditions>
				<property name="policy.retrieveToken.httpContentType" />
			</item>

			<item type="textarea" name="httpHeaders" label="Header HTTP" required="false"
				note="Indicare per riga gli eventuali header (nome=valore)">
				<property name="policy.retrieveToken.httpHeaders" />
			</item>

			<item type="select" name="httpPayloadTemplateType" label="Tipo Template Payload" default="template" reloadOnChange="true">
				<conditions and="true">
					<condition>
						<equals name="retrieveTokenMethod" value="custom"/>
					</condition>
					<condition and="false">
						<selected name="httpMethodPayloadDefinedDefaultTrue"/>
						<selected name="httpMethodPayloadDefinedDefaultFalse"/>
					</condition>
				</conditions>
				<values>
					<value value="template" label="Template"/>
					<value value="freemarker-template" label="Freemarker Template"/>
					<value value="velocity-template" label="Velocity Template"/>
				</values>
				<property name="policy.retrieveToken.httpPayloadTemplateType" />
			</item>
			<item type="textarea" name="httpTemplatePayload" label="Payload HTTP" required="true">
				<conditions and="true">
					<condition>
						<equals name="retrieveTokenMethod" value="custom"/>
					</condition>
					<condition and="false">
						<selected name="httpMethodPayloadDefinedDefaultTrue"/>
						<selected name="httpMethodPayloadDefinedDefaultFalse"/>
					</condition>
					<condition>
						<equals name="httpPayloadTemplateType" value="template"/>
					</condition>
				</conditions>
				<property name="policy.retrieveToken.httpPayload" />
			</item>
			<item type="textarea" name="httpFreemarkerPayload" label="Payload HTTP" required="true">
				<conditions and="true">
					<condition>
						<equals name="retrieveTokenMethod" value="custom"/>
					</condition>
					<condition and="false">
						<selected name="httpMethodPayloadDefinedDefaultTrue"/>
						<selected name="httpMethodPayloadDefinedDefaultFalse"/>
					</condition>
					<condition>
						<equals name="httpPayloadTemplateType" value="freemarker-template"/>
					</condition>
				</conditions>
				<property name="policy.retrieveToken.httpPayload" />
			</item>
			<item type="textarea" name="httpVelocityPayload" label="Payload HTTP" required="true">
				<conditions and="true">
					<condition>
						<equals name="retrieveTokenMethod" value="custom"/>
					</condition>
					<condition and="false">
						<selected name="httpMethodPayloadDefinedDefaultTrue"/>
						<selected name="httpMethodPayloadDefinedDefaultFalse"/>
					</condition>
					<condition>
						<equals name="httpPayloadTemplateType" value="velocity-template"/>
					</condition>
				</conditions>
				<property name="policy.retrieveToken.httpPayload" />
			</item>
			
		</subsection>

		<subsection label="Formato Risposta">
			<conditions and="true">
				<condition>
					<equals name="retrieveTokenMethod" value="custom"/>
				</condition>
			</conditions>

			<item type="select" name="customTokenParserType" label="Tipo" default="OAUTH2_RFC_6749" reloadOnChange="true">
				<values>
					<value value="OAUTH2_RFC_6749" label="RFC 6749 - OAuth2"/> 
					<value value="RAW" label="Usa payload come Token"/>
					<value value="MAPPING" label="Personalizzato"/>
					<value value="CUSTOM" label="Plugin"/>
				</values>
				<property name="policy.retrieveToken.claimsParser.custom" />
			</item>
			
			<!-- RAW -->
			<item type="text" name="rawTokenParserExpiresIn" label="Expires in" required="true" default="300" note="The lifetime in seconds of the access token">
				<conditions>
					<condition and="true">
						<equals name="customTokenParserType" value="RAW"/>
					</condition>
				</conditions>
		      		<property name="token.parser.expires_in_sec" properties="retrieveTokenParserPropRefId" />
			</item>
			
			<!-- CUSTOM -->
			<item type="select" name="customTokenParserCustomPluginChoice" label="" reloadOnChange="true" >
				<conditions>
					<condition and="true">
						<equals name="customTokenParserType" value="CUSTOM"/>
					</condition>
				</conditions>
				<property name="policy.retrieveToken.claimsParser.pluginType" />
			</item>
			<item type="text" name="customTokenParserCustomPlugin" label="ClassName" required="true">
				<conditions>
					<condition and="true">
						<equals name="customTokenParserType" value="CUSTOM"/>
					</condition>
				</conditions>
			   	<property name="policy.retrieveToken.claimsParser.className" />
			</item>

			<!-- MAPPING -->
			<item type="text" name="customTokenParserTokenType" label="Token Type" required="true" default="token_type">
				<conditions>
					<condition and="true">
						<equals name="customTokenParserType" value="MAPPING"/>
					</condition>
				</conditions>
		      		<property name="token.parser.token_type" properties="retrieveTokenParserPropRefId" />
			</item>
			<item type="text" name="customTokenParserAccessToken" label="Access Token" required="true" default="access_token">
				<conditions>
					<condition and="true">
						<equals name="customTokenParserType" value="MAPPING"/>
					</condition>
				</conditions>
		      		<property name="token.parser.access_token" properties="retrieveTokenParserPropRefId" />
			</item>

			<item type="text" name="customTokenParserRefreshToken" label="Refresh Token" required="true" default="refresh_token">
				<conditions>
					<condition and="true">
						<equals name="customTokenParserType" value="MAPPING"/>
					</condition>
				</conditions>
		      		<property name="token.parser.refresh_token" properties="retrieveTokenParserPropRefId" />
			</item>

			<item type="text" name="customTokenParserScope" label="Scope" required="true" default="scope">
				<conditions>
					<condition and="true">
						<equals name="customTokenParserType" value="MAPPING"/>
					</condition>
				</conditions>
		      		<property name="token.parser.scope" properties="retrieveTokenParserPropRefId" />
			</item>

			<item type="text" name="customTokenParserExpiresIn" label="Expires in" required="true" default="expires_in" note="The lifetime in seconds of the access token">
				<conditions>
					<condition and="true">
						<equals name="customTokenParserType" value="MAPPING"/>
					</condition>
				</conditions>
		      		<property name="token.parser.expires_in" properties="retrieveTokenParserPropRefId" />
			</item>
			<item type="text" name="customTokenParserExpiresOn" label="Expires on" required="true" default="expires_on" note="The expiration time; number of seconds from '1970-01-01T00:00:00Z UTC'">
				<conditions>
					<condition and="true">
						<equals name="customTokenParserType" value="MAPPING"/>
					</condition>
				</conditions>
		      		<property name="token.parser.expires_on" properties="retrieveTokenParserPropRefId" />
			</item>

			<item type="text" name="customTokenParserRefreshExpiresIn" label="Refresh expires in" required="true" default="refresh_expires_in" note="The lifetime in seconds of the refresh token">
				<conditions>
					<condition and="true">
						<equals name="customTokenParserType" value="MAPPING"/>
					</condition>
				</conditions>
		      		<property name="token.parser.refresh_expires_in" properties="retrieveTokenParserPropRefId" />
			</item>
			<item type="text" name="customTokenParserRefreshExpiresOn" label="Refresh expires on" required="true" default="refresh_expires_on" note="The expiration time; number of seconds from '1970-01-01T00:00:00Z UTC'">
				<conditions>
					<condition and="true">
						<equals name="customTokenParserType" value="MAPPING"/>
					</condition>
				</conditions>
		      		<property name="token.parser.refresh_expires_on" properties="retrieveTokenParserPropRefId" />
			</item>

		</subsection>

	</section>

	
	<section label="Https">

		<conditions>
			<condition and="false">
				<selected name="endpointHttps"/>
				<selected name="autenticazioneEndpointHttps"/>
			</condition>	
		</conditions>
	
		<item type="select" name="endpointHttpsTipologia" label="Tipologia">
			<property name="sslType" properties="sslConfig" />
		</item>
		<item type="checkbox" name="endpointHttpsHostNameVerifier" label="Hostname Verifier" defaultSelected="true" >
			<property name="hostnameVerifier" properties="sslConfig" />
		</item>
	
	
		<subsection label="Autenticazione Server">

			<item type="checkbox" name="endpointHttpsTrustAllCerts" label="Verifica" defaultSelected="true" reloadOnChange="true">
				<property name="trustAllCerts" properties="sslConfig" selectedValue="false" unselectedValue="true"/>
			</item>
	
			<item type="select" name="endpointHttpsTruststoreType" label="Tipo" default="jks" reloadOnChange="true">
				<conditions>
					<condition and="false">
						<selected name="endpointHttpsTrustAllCerts"/>
					</condition>	
				</conditions>
				<property name="trustStoreType" properties="sslConfig" />
			</item>
			<item type="textarea" name="endpointHttpsTruststoreFile" label="File" required="true">
				<conditions>
					<condition and="false">
						<selected name="endpointHttpsTrustAllCerts"/>
					</condition>	
				</conditions>
				<property name="trustStoreLocation" properties="sslConfig" />
			</item>
			<item type="lock" name="endpointHttpsTruststorePassword" label="Password" required="true">
				<conditions>
					<condition and="false">
						<selected name="endpointHttpsTrustAllCerts"/>
					</condition>	
				</conditions>
			      	<property name="trustStorePassword" properties="sslConfig" />
			</item>
			<item type="text" name="endpointHttpsTruststoreAlgoritmo" label="Algoritmo" default="PKIX" required="true">
				<conditions>
					<condition and="false">
						<selected name="endpointHttpsTrustAllCerts"/>
					</condition>	
				</conditions>
			      	<property name="trustManagementAlgorithm" properties="sslConfig" />
			</item>
			<item type="select" name="endpointHttpsTrustStoreOcspPolicy" label="OCSP Policy" default="" reloadOnChange="true">
				<conditions>
					<condition and="false">
						<selected name="endpointHttpsTrustAllCerts"/>
					</condition>	
				</conditions>
				<property name="trustStoreOCSPPolicy" properties="sslConfig" />
			</item>
			<item type="textarea" name="endpointHttpsTrustStoreCRLs" label="CRL File(s)" required="false" note="Elencare più file separandoli con la ','">
				<conditions>
					<condition and="false">
						<selected name="endpointHttpsTrustAllCerts"/>
					</condition>	
				</conditions>
			      	<property name="trustStoreCRLs" properties="sslConfig" />
			</item>
			
		</subsection>
		
		<subsection label="Autenticazione Client">
		
			<conditions>
				<condition and="false">
					<selected name="autenticazioneEndpointHttps"/>
				</condition>
			</conditions>
			
			<item type="select" name="endpointHttpsClientMode" label="Dati Accesso al KeyStore" default="default" reloadOnChange="true">
				<values>
					<value value="default" label="Usa valore del TrustStore"/>
					<value value="ridefinito" label="Ridefinisci"/>
				</values>
				<property name="policy.endpoint.ssl.mode" />
			</item>
			<item type="select" name="endpointHttpsClientKeystoreType" label="Tipo" default="jks" reloadOnChange="true">
				<conditions>
					<condition and="true">
						<equals name="endpointHttpsClientMode" value="ridefinito"/>
					</condition>
				</conditions>
				<property name="keyStoreType" properties="sslClientConfig" />
			</item>
			<item type="textarea" name="endpointHttpsClientKeystoreFile" label="File" required="true">
				<conditions>
					<condition and="true">
						<equals name="endpointHttpsClientMode" value="ridefinito"/>
					</condition>
				</conditions>
			    <property name="keyStoreLocation" properties="sslClientConfig" />
			</item>
			<item type="lock" name="endpointHttpsClientKeystorePassword" label="Password" required="true">
				<conditions>
					<condition and="true">
						<equals name="endpointHttpsClientMode" value="ridefinito"/>
					</condition>
				</conditions>
			    <property name="keyStorePassword" properties="sslClientConfig" />
			</item>
			<item type="lock" name="endpointHttpsClientPasswordChiavePrivata" label="Password Chiave Privata" required="true">
				<property name="keyPassword" properties="sslClientConfig" />
			</item>
			<item type="text" name="endpointHttpsClientAliasChiavePrivata" label="Alias Chiave Privata" required="false">
				<property name="keyAlias" properties="sslClientConfig" />
			</item>
			<item type="text" name="endpointHttpsClientAlgoritmo" label="Algoritmo" default="SunX509" required="true">
				<property name="keyManagementAlgorithm" properties="sslClientConfig" />
			</item>
			<item type="select" name="endpointHttpsByokPolicy" label="BYOK Policy" default="" reloadOnChange="true">
				<property name="keyStoreBYOKPolicy" properties="sslClientConfig" />
			</item>
		
		</subsection>
		
	</section>
			
	<section label="Proxy">
	
		<conditions>
			<condition and="true">
				<selected name="endpointProxy"/>
			</condition>
		</conditions>
	
		<item type="hidden" name="endpointProxyType" value="http">
			<property name="proxyType" properties="endpointConfig" />
		</item>
		<item type="text" name="endpointProxyHostname" label="Hostname" required="true">
			<property name="proxyHostname" properties="endpointConfig" />
		</item>
		<item type="number" name="endpointProxyPort" label="Porta" required="true" min="1" max="65535">
			<property name="proxyPort" properties="endpointConfig" />
		</item>
		<item type="text" name="endpointProxyUsername" label="Username" required="false">
			<property name="proxyUsername" properties="endpointConfig" />
		</item>
		<item type="lock" name="endpointProxyPassword" label="Password" required="false">
			<property name="proxyPassword" properties="endpointConfig" />
		</item>
		
	</section>

	<section label="Token Forward">

		<item type="select" name="tokenForwardTrasparenteMode" label="Modalità" default="RFC6750_header" reloadOnChange="true">
			<values>
				<value value="RFC6750_header" label="RFC 6750 - Bearer Token Usage (Authorization Request Header Field)"/>
				<value value="RFC6750_url" label="RFC 6750 - Bearer Token Usage (URI Query Parameter)"/>
				<value value="CUSTOM_header" label="Header HTTP"/>
				<value value="CUSTOM_url" label="Parametro URL"/>
			</values>
			<property name="policy.tokenForward.mode" />
		</item>
		
		<item type="text" name="tokenForwardTrasparenteModeSourceHeader" label="Nome Header HTTP" required="true">
			<conditions>
				<condition>
					<equals name="tokenForwardTrasparenteMode" value="CUSTOM_header"/>
				</condition>
			</conditions>
		    <property name="policy.tokenForward.mode.header" />
		</item>
		
		<item type="text" name="tokenForwardTrasparenteModeSourceQueryParameter" label="Nome Parametro URL" required="true">
			<conditions>
				<condition>
					<equals name="tokenForwardTrasparenteMode" value="CUSTOM_url"/>
				</condition>
			</conditions>
		    <property name="policy.tokenForward.mode.queryParameter" />
		</item>

	</section>

</config>



