!function(t){"use strict";var e={tagClass:function(t){return"label label-info"},focusClass:"focus",itemValue:function(t){return t?t.toString():t},itemText:function(t){return this.itemValue(t)},itemTitle:function(t){return null},freeInput:!0,addOnBlur:!0,maxTags:void 0,maxChars:void 0,confirmKeys:[13,44],delimiter:",",delimiterRegex:null,cancelConfirmKeysOnEmpty:!1,onTagExists:function(t,e){e.hide().fadeIn()},trimValue:!0,allowDuplicates:!1,checkDuplicatesCaseInsensitive:!0,triggerChange:!0,allowWhiteSpaces:!1};function i(e,i){this.isInit=!0,this.itemsArray=[],this.$element=t(e),this.$element.hide(),this.isSelect="SELECT"===e.tagName,this.multiple=this.isSelect&&e.hasAttribute("multiple"),this.objectItems=i&&i.itemValue,this.placeholderText=e.hasAttribute("placeholder")?this.$element.attr("placeholder"):"",this.inputSize=Math.max(1,this.placeholderText.length),this.$container=t('<div class="bootstrap-tagsinput"></div>'),this.$input=t('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container),this.$element.before(this.$container),this.build(i),this.isInit=!1}function n(t,e){if("function"!=typeof t[e]){var i=t[e];t[e]=function(t){return t[i]}}}function a(t,e){if("function"!=typeof t[e]){var i=t[e];t[e]=function(){return i}}}i.prototype={constructor:i,add:function(e,i,n,a){var o=this;if(!(o.options.maxTags&&o.itemsArray.length>=o.options.maxTags)&&(!1===e||e)){if("string"==typeof e&&o.options.trimValue&&(e=t.trim(e)),"object"==typeof e&&!o.objectItems)throw"Can't add objects when itemValue option is not set";if(!e.toString().match(/^\s*$/)){if(o.isSelect&&!o.multiple&&o.itemsArray.length>0&&o.remove(o.itemsArray[0]),"string"==typeof e&&"INPUT"===this.$element[0].tagName){var s=o.options.delimiterRegex?o.options.delimiterRegex:o.options.delimiter,l=e.split(s);if(l.length>1){for(var p=0;p<l.length;p++)this.add(l[p],!0,p);return void(i||o.pushVal(o.options.triggerChange))}}var u,c=o.options.itemValue(e),h=o.options.itemText(e),m=o.options.itemTitle(e);u=void 0===n?o.options.tagClass(e):o.options.tagClass(e,n);var f=t.grep(o.itemsArray,function(t){return o.options.checkDuplicatesCaseInsensitive?o.options.itemValue(t).toLowerCase()===c.toLowerCase():o.options.itemValue(t)===c})[0];if(!f||o.options.allowDuplicates){if(!(o.items().toString().length+e.length+1>o.options.maxInputLength)){var d=t.Event("beforeItemAdd",{item:e,cancel:!1,options:a});if(o.$element.trigger(d),!d.cancel){o.itemsArray.push(e);var g=t('<span class="tag '+r(u)+(null!==m?'" title="'+m:"")+'">'+r(h)+'<span data-role="remove"></span></span>');g.data("item",e),o.findInputWrapper().before(g),g.after(" ");var v=t('option[value="'+encodeURIComponent(c)+'"]',o.$element).length||t('option[value="'+r(c)+'"]',o.$element).length;if(o.isSelect&&!v){var y=t("<option selected>"+r(h)+"</option>");y.data("item",e),y.attr("value",c),o.$element.append(y)}i||o.pushVal(o.options.triggerChange),o.options.maxTags!==o.itemsArray.length&&o.items().toString().length!==o.options.maxInputLength||o.$container.addClass("bootstrap-tagsinput-max"),t(".typeahead, .twitter-typeahead",o.$container).length&&o.$input.typeahead("val",""),this.isInit?o.$element.trigger(t.Event("itemAddedOnInit",{item:e,options:a})):o.$element.trigger(t.Event("itemAdded",{item:e,options:a}))}}}else if(o.options.onTagExists){var $=t(".tag",o.$container).filter(function(){return t(this).data("item")===f});o.options.onTagExists(e,$)}}}},remove:function(e,i,n){var a=this;if(a.objectItems&&(e=(e="object"==typeof e?t.grep(a.itemsArray,function(t){return a.options.itemValue(t)==a.options.itemValue(e)}):t.grep(a.itemsArray,function(t){return a.options.itemValue(t)==e}))[e.length-1]),e){var o=t.Event("beforeItemRemove",{item:e,cancel:!1,options:n});if(a.$element.trigger(o),o.cancel)return;t(".tag",a.$container).filter(function(){return t(this).data("item")===e}).remove(),t("option",a.$element).filter(function(){return t(this).data("item")===e}).remove(),-1!==t.inArray(e,a.itemsArray)&&a.itemsArray.splice(t.inArray(e,a.itemsArray),1)}i||a.pushVal(a.options.triggerChange),a.options.maxTags>a.itemsArray.length&&a.$container.removeClass("bootstrap-tagsinput-max"),a.$element.trigger(t.Event("itemRemoved",{item:e,options:n}))},removeAll:function(){var e=this;for(t(".tag",e.$container).remove(),t("option",e.$element).remove();e.itemsArray.length>0;)e.itemsArray.pop();e.pushVal(e.options.triggerChange)},refresh:function(){var e=this;t(".tag",e.$container).each(function(){var i=t(this),n=i.data("item"),a=e.options.itemValue(n),o=e.options.itemText(n),s=e.options.tagClass(n);(i.attr("class",null),i.addClass("tag "+r(s)),i.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=r(o),e.isSelect)&&t("option",e.$element).filter(function(){return t(this).data("item")===n}).attr("value",a)})},items:function(){return this.itemsArray},pushVal:function(){var e=this,i=t.map(e.items(),function(t){return e.options.itemValue(t).toString()});e.$element.val(i,!0),e.options.triggerChange&&e.$element.trigger("change")},build:function(i){var o=this;if(o.options=t.extend({},e,i),o.objectItems&&(o.options.freeInput=!1),n(o.options,"itemValue"),n(o.options,"itemText"),a(o.options,"tagClass"),o.options.typeahead){var r=o.options.typeahead||{};a(r,"source"),o.$input.typeahead(t.extend({},r,{source:function(e,i){function n(t){for(var e=[],n=0;n<t.length;n++){var r=o.options.itemText(t[n]);a[r]=t[n],e.push(r)}i(e)}this.map={};var a=this.map,s=r.source(e);t.isFunction(s.success)?s.success(n):t.isFunction(s.then)?s.then(n):t.when(s).then(n)},updater:function(t){return o.add(this.map[t]),this.map[t]},matcher:function(t){return-1!==t.toLowerCase().indexOf(this.query.trim().toLowerCase())},sorter:function(t){return t.sort()},highlighter:function(t){var e=new RegExp("("+this.query+")","gi");return t.replace(e,"<strong>$1</strong>")}}))}if(o.options.typeaheadjs){var l=o.options.typeaheadjs;t.isArray(l)||(l=[null,l]);var p=l[1].valueKey,u=p?function(t){return t[p]}:function(t){return t};t.fn.typeahead.apply(o.$input,l).on("typeahead:selected",t.proxy(function(t,e){o.add(u(e)),o.$input.typeahead("val","")},o))}o.$container.on("click",t.proxy(function(t){o.$element.attr("disabled")||o.$input.removeAttr("disabled"),o.$input.focus()},o)),o.options.addOnBlur&&o.options.freeInput&&o.$input.on("focusout",t.proxy(function(t){var e=o.$input.val();if(0!==e.length)if(o.options.allowWhiteSpaces)o.add(o.$input.val());else for(var i=e.split(" "),n=0;n<i.length;n++){var a=i[n];o.add(a)}else o.add(o.$input.val());o.$input.val("")},o)),o.$container.on({focusin:function(){o.$container.addClass(o.options.focusClass)},focusout:function(){o.$container.removeClass(o.options.focusClass)}}),o.$container.on("keydown","input",t.proxy(function(e){var i=t(e.target),n=o.findInputWrapper();if(o.$element.attr("disabled"))o.$input.attr("disabled","disabled");else{switch(e.which){case 8:if(0===s(i[0])){var a=n.prev();a.length&&o.remove(a.data("item"))}break;case 46:if(0===s(i[0])){var r=n.next();r.length&&o.remove(r.data("item"))}break;case 37:var l=n.prev();0===i.val().length&&l[0]&&(l.before(n),i.focus());break;case 39:var p=n.next();0===i.val().length&&p[0]&&(p.after(n),i.focus())}var u=i.val().length;Math.ceil(u/5);i.attr("size",Math.max(this.inputSize,i.val().length))}},o)),o.$container.on("keypress","input",t.proxy(function(e){var i=t(e.target);if(o.$element.attr("disabled"))o.$input.attr("disabled","disabled");else{var n,a,r,s=i.val(),l=o.options.maxChars&&s.length>=o.options.maxChars;if(o.options.freeInput&&(n=e,a=o.options.confirmKeys,r=!1,t.each(a,function(t,e){if("number"==typeof e&&n.which===e)return r=!0,!1;if(n.which===e.which){var i=!e.hasOwnProperty("altKey")||n.altKey===e.altKey,a=!e.hasOwnProperty("shiftKey")||n.shiftKey===e.shiftKey,o=!e.hasOwnProperty("ctrlKey")||n.ctrlKey===e.ctrlKey;if(i&&a&&o)return r=!0,!1}}),r||l)){if(0!==s.length){if(o.options.allowWhiteSpaces)o.add(l?s.substr(0,o.options.maxChars):s);else for(var p=s.split(" "),u=0;u<p.length;u++){var c=p[u];o.add(l?c.substr(0,o.options.maxChars):c)}i.val("")}!1===o.options.cancelConfirmKeysOnEmpty&&e.preventDefault()}var h=i.val().length;Math.ceil(h/5);i.attr("size",Math.max(this.inputSize,i.val().length))}},o)),o.$container.on("click","[data-role=remove]",t.proxy(function(e){if(!o.$element.attr("disabled")){var i=t(e.target).attr("data-role");void 0!==i&&"remove"==i&&o.remove(t(e.target).closest(".tag").data("item"))}},o)),o.options.itemValue===e.itemValue&&("INPUT"===o.$element[0].tagName?o.add(o.$element.val()):t("option",o.$element).each(function(){o.add(t(this).attr("value"),!0)}))},destroy:function(){var t=this;t.$container.off("keypress","input"),t.$container.off("click","[role=remove]"),t.$container.remove(),t.$element.removeData("tagsinput"),t.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var e=this.$input[0],i=this.$container[0];e&&e.parentNode!==i;)e=e.parentNode;return t(e)}},t.fn.tagsinput=function(e,n,a){var o=[];return this.each(function(){var r=t(this).data("tagsinput");if(r)if(e||n){if(void 0!==r[e]){if(3===r[e].length&&void 0!==a)var s=r[e](n,null,a);else s=r[e](n);void 0!==s&&o.push(s)}}else o.push(r);else r=new i(this,e),t(this).data("tagsinput",r),o.push(r),"SELECT"===this.tagName&&t("option",t(this)).attr("selected","selected"),t(this).val(t(this).val())}),"string"==typeof e?o.length>1?o:o[0]:o},t.fn.tagsinput.Constructor=i;var o=t("<div />");function r(t){return t?o.text(t).html():""}function s(t){var e=0;if(document.selection){t.focus();var i=document.selection.createRange();i.moveStart("character",-t.value.length),e=i.text.length}else(t.selectionStart||"0"==t.selectionStart)&&(e=t.selectionStart);return e}}(window.jQuery);