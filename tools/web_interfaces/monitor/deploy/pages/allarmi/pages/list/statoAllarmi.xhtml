<ui:composition template="/templates/defaultTemplate.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:link="http://www.link.it"
	xmlns:fc="http://www.fusioncharts.com"
    xmlns:c="http://java.sun.com/jstl/core">
    <f:loadBundle var="msg" basename="messages" />

	<ui:define name="body">
		<style>
			#crumbs {display: none;	}					
		</style>
		<a4j:outputPanel id="panelPaginaRicerca" layout="block">
			<rich:panel id="statusPnl" rendered="#{allarmiBean.allarmiAssociazioneAcknowledgedStatoAllarme==false}">
				<f:facet name="header">	
					<h:outputText value="Stato Allarmi" />
				</f:facet>
				<h:panelGrid columns="7">
					<h:panelGrid columns="2" columnClasses="labelAllineataDx,valueAllineataSx" styleClass="borderSpacingTable">
						<h:outputText value="Ok:" styleClass="outputFieldLabel"/>
						<h:panelGrid columns="2">
							<h:outputText value="#{allarmiBean.totOk}" />
							<h:graphicImage value="/images/tema_link/status_green.png"/>
						</h:panelGrid>
					</h:panelGrid>
					<h:outputText value="&#160;&#160;&#160;&#160;&#160;&#160;" />
					
					<h:panelGrid columns="2" columnClasses="labelAllineataDx,valueAllineataSx" styleClass="borderSpacingTable">
						<h:outputText value="Warn:" styleClass="outputFieldLabel" />
						<h:panelGrid columns="2">
							<h:outputText value="#{allarmiBean.totWarn}" />
							<h:graphicImage value="/images/tema_link/status_yellow.png" />
						</h:panelGrid>
					</h:panelGrid>
					<h:outputText value="&#160;&#160;&#160;&#160;&#160;&#160;" />
					
					<h:panelGrid columns="2" columnClasses="labelAllineataDx,valueAllineataSx" styleClass="borderSpacingTable">
						<h:outputText value="Error:" styleClass="outputFieldLabel" />
						<h:panelGrid columns="2">
							<h:outputText value="#{allarmiBean.totError}" />
							<h:graphicImage value="/images/tema_link/status_red.png"/>
						</h:panelGrid>
					</h:panelGrid>
					<h:outputText value="&#160;&#160;&#160;&#160;&#160;&#160;" />
					
					<h:panelGrid columns="2" columnClasses="labelAllineataDx,valueAllineataSx" styleClass="borderSpacingTable">
						<h:outputText value="Disabilitati:" styleClass="outputFieldLabel" />
						<h:panelGrid columns="2">
							<h:outputText value="#{allarmiBean.totDisabilitati}" />
							<h:graphicImage value="/images/tema_link/circle_light_grey.png"/>
						</h:panelGrid>
					</h:panelGrid>
				</h:panelGrid>
			</rich:panel>
			<rich:panel id="statusPnlWithAcknoledged" rendered="#{allarmiBean.allarmiAssociazioneAcknowledgedStatoAllarme}">
				<f:facet name="header">	
					<h:outputText value="Stato Allarmi" />
				</f:facet>
				<h:panelGrid columns="7">
					<h:panelGrid columns="2" columnClasses="labelAllineataDx,valueAllineataSx" styleClass="borderSpacingTable">
						<h:outputText value="Ok:" styleClass="outputFieldLabel"/>
						<h:panelGrid columns="3">
							<h:outputText value="#{allarmiBean.totOk}" />
							<h:outputText value="&#160;" />
							<h:graphicImage value="/images/tema_link/status_green.png"/>
						</h:panelGrid>
					</h:panelGrid>
					<h:outputText value="&#160;&#160;&#160;&#160;&#160;&#160;" />
					
					<h:panelGrid columns="2" columnClasses="labelAllineataDx,valueAllineataSx" styleClass="borderSpacingTable">
						<h:outputText value="Warn:" styleClass="outputFieldLabel" />
						<h:panelGrid columns="7">
							<h:outputText value="#{allarmiBean.totWarnNoAck}" />
							<h:outputText value="&#160;" />
							<a4j:outputPanel styleClass="icona-allarme-warning">
								<i class="material-icons md-18" id="iconaSearchOpen">error</i>
							</a4j:outputPanel>
							<h:outputText value="&#160;&#160;" />
							<h:outputText value="#{allarmiBean.totWarnAck}" />
							<h:outputText value="&#160;" />
							<a4j:outputPanel styleClass="icona-allarme-warning">
								<i class="material-icons md-18" id="iconaSearchOpen">check_circle</i>
							</a4j:outputPanel>
						</h:panelGrid>
					</h:panelGrid>
					<h:outputText value="&#160;&#160;&#160;&#160;&#160;&#160;" />
					
					<h:panelGrid columns="2" columnClasses="labelAllineataDx,valueAllineataSx" styleClass="borderSpacingTable">
						<h:outputText value="Error:" styleClass="outputFieldLabel" />
						<h:panelGrid columns="7">
							<h:outputText value="#{allarmiBean.totErrorNoAck}" />
							<h:outputText value="&#160;" />
							<a4j:outputPanel styleClass="icona-allarme-error">
								<i class="material-icons md-18" id="iconaSearchOpen">error</i>
							</a4j:outputPanel>
							<h:outputText value="&#160;&#160;" />
							<h:outputText value="#{allarmiBean.totErrorAck}" />
							<h:outputText value="&#160;" />
							<a4j:outputPanel styleClass="icona-allarme-error">
								<i class="material-icons md-18" id="iconaSearchOpen">check_circle</i>
							</a4j:outputPanel>
						</h:panelGrid>
					</h:panelGrid>
					<h:outputText value="&#160;&#160;&#160;&#160;&#160;&#160;" />
					
					<h:panelGrid columns="2" columnClasses="labelAllineataDx,valueAllineataSx" styleClass="borderSpacingTable">
						<h:outputText value="Disabilitati:" styleClass="outputFieldLabel" />
						<h:panelGrid columns="2">
							<h:outputText value="#{allarmiBean.totDisabilitati}" />
							<a4j:outputPanel styleClass="icona-allarme-disabilitato">
								<i class="material-icons md-20" id="iconaSearchOpen">fiber_manual_record</i>
							</a4j:outputPanel>
						</h:panelGrid>
					</h:panelGrid>
					
					
				</h:panelGrid>
			</rich:panel>
			<div class="spacerDettaglio"></div>
			<rich:simpleTogglePanel id="panelFiltri1" opened="true" label="Modifica Filtri di Ricerca" switchType="client">
				<f:facet name="openMarker">
					<a4j:outputPanel id="openMarkerPnl" styleClass="icon-search-box">
						<i class="material-icons md-24" id="iconaSearchOpen">&#xE8B6;</i>
						<rich:toolTip for="openMarkerPnl" value="#{msg['commons.search.filtroRicerca.visualizza.tooltip']}" />
					</a4j:outputPanel>
				</f:facet>
				
				<f:facet name="closeMarker">
					<a4j:outputPanel id="closeMarkerPnl" styleClass="icon-search-box">
						<i class="material-icons md-24" id="iconaSearchOpen">&#xE8B6;</i>
						<rich:toolTip for="closeMarkerPnl" value="#{msg['commons.search.filtroRicerca.nascondi.tooltip']}" />
					</a4j:outputPanel>
				</f:facet>
	
				<div class="form-container noborder">
					<h:form>
						<a4j:outputPanel id="searchPnl" ajaxRendered="false" layout="block">
						
							<link:prop label="Tipologia">
								<rich:comboBox id="tipologiaTransazioniCombo" value="#{searchFormAllarmi.tipologiaAllarme}" 
										defaultLabel="Seleziona Tipologia Allarme" converter="selectItemConverter"
										width="416" enableManualInput="false">
									<f:selectItems value="#{searchFormAllarmi.tipologieRicerca}"/>
									<a4j:support status="mainStatus" event="onselect" reRender="searchPnl,panelFiltriApis" 
										actionListener="#{searchFormAllarmi.tipologiaAllarmeListener}" />
								</rich:comboBox>
							</link:prop>
							
							<a4j:outputPanel id="panelFiltriApis" layout="block" rendered="#{searchFormAllarmi.tipologiaAllarme != 'configurazione'}">
								<a4j:outputPanel id="panelProtocollo" layout="block" rendered="#{searchFormAllarmi.showListaProtocolli}"
									ajaxRendered="true">
									<link:prop label="#{applicationBean.labelProfilo}">
										<rich:comboBox id="protocolloCombo" value="#{searchFormAllarmi.protocollo}"
											converter="selectItemConverter" defaultLabel="Seleziona #{applicationBean.labelProfilo}" enableManualInput="false" directInputSuggestions="true" width="416">
											<f:selectItems value="#{searchFormAllarmi.protocolli}" />
											<a4j:support status="mainStatus" event="onselect" actionListener="#{searchFormAllarmi.protocolloSelected}"
												reRender="soggettoErogatoreComboCtr,gruppiComboCtr,servizioComboCtr" />
										</rich:comboBox>
									</link:prop>
								</a4j:outputPanel>
								
								<a4j:outputPanel layout="block" id="soggettoErogatoreComboCtr">
									<ui:include src="/stat/includes/searchFormConfigurazioniGeneraliFiltroSoggetto.xhtml">
										<ui:param name="sf_bean" value="#{searchFormAllarmi}" />
										<ui:param name="sf_mbean" value="#{allarmiBean}" />
									</ui:include>
								</a4j:outputPanel>
		
								<a4j:outputPanel layout="block" id="gruppiComboCtr">
									<ui:include src="/stat/includes/searchFormConfigurazioniGeneraliFiltroGruppi.xhtml">
										<ui:param name="sf_bean" value="#{searchFormAllarmi}" />
										<ui:param name="sf_mbean" value="#{allarmiBean}" />
									</ui:include>
								</a4j:outputPanel>
		
								<a4j:outputPanel layout="block" id="servizioComboCtr">
									<ui:include src="/stat/includes/searchFormConfigurazioniGeneraliFiltroServizio.xhtml">
										<ui:param name="sf_bean" value="#{searchFormAllarmi}" />
										<ui:param name="sf_mbean" value="#{allarmiBean}" />
									</ui:include>
								</a4j:outputPanel>
							</a4j:outputPanel>
							
							<link:prop label="Stato" rendered="#{allarmiBean.allarmiAssociazioneAcknowledgedStatoAllarme==false}">
								<rich:comboBox enableManualInput="false"
									suggestionValues="#{allarmiBean.statusFilterValues}"
									value="#{searchFormAllarmi.statoSelezionato}" defaultLabel="Non Disabilitato"
									width="416">
									<a4j:support event="onselect" />
								</rich:comboBox>
							</link:prop>
							<link:prop label="Stato" rendered="#{allarmiBean.allarmiAssociazioneAcknowledgedStatoAllarme}">
								<rich:comboBox enableManualInput="false"
									suggestionValues="#{allarmiBean.statusFilterValuesWithAck}"
									value="#{searchFormAllarmi.statoSelezionato}" defaultLabel="Non Disabilitato"
									width="416">
									<a4j:support event="onselect" />
								</rich:comboBox>
							</link:prop>
						
							<link:prop label="Nome">
								<h:inputText id="nomeAllarmeInput" value="#{searchFormAllarmi.nomeAllarme}" styleClass="inputLinkLong"/>
								<rich:suggestionbox 
											id="nomeAllarmeSuggestion"
											width="412" 
											for="nomeAllarmeInput" 
											suggestionAction="#{allarmiBean.nomeAllarmeAutoComplete}"
											var="nomeAllarme"
											ajaxSingle="true"
											nothingLabel="--"
											param="nomeAllarmeInput">
									<h:column>
										<h:outputText value="#{nomeAllarme}" rendered="true" />
									</h:column>
									<a4j:support status="mainStatus" event="onselect" actionListener="#{searchFormAllarmi.nomeAllarmeSelected}"  />
								</rich:suggestionbox>
							</link:prop>
						</a4j:outputPanel>	
						
						<div class="buttonrow">
							<a4j:commandButton styleClass="icon-refresh" value="Cerca"
									reRender="panelPaginaRicerca,statusPnl,statusPnlWithAcknoledged" 
									action="#{allarmiBean.filtra}"
									/>
							<a4j:commandButton id="svuota" value="Ripulisci"
									styleClass="icon-refresh" process="searchPnl"
									reRender="panelPaginaRicerca,statusPnl,statusPnlWithAcknoledged"
									rendered="#{true}"
									action="#{searchFormAllarmi.ripulisci}"
								 />
						</div>			
					</h:form>		
				</div>
			</rich:simpleTogglePanel>		
			<div class="spacer"></div>
			<a4j:outputPanel id="allarmiTbl" layout="block" styleClass="panelLista" rendered="#{allarmiDM.executeQuery}">
				<h:form>
					<link:dataTable value="#{allarmiDM}"
						id="tableAllarmi"
						headerText="Lista Allarmi"
						enableDelete="false"
						reRenderIds="allarmiTbl"
						useCount="#{searchFormAllarmi.useCount}">
						
						<rich:column id="statusColumn" align="center" width="40px">
							<f:facet name="header">
								<h:outputText value="Stato" id="outStato"/>
							</f:facet>
							<h:panelGroup layout="block" style="width: 40px;">
								<a4j:outputPanel rendered="#{item.enabled==0}" id="alarmDisabledPnl" styleClass="icona-allarme-disabilitato">
									<i class="material-icons md-20" id="iconaSearchOpen">fiber_manual_record</i>
									<rich:toolTip for="alarmDisabledPnl" mode="client" value="Disabilitato"/>
								</a4j:outputPanel>
								<a4j:outputPanel rendered="#{ 
										(item.enabled>0) 
										and 
										(
											(allarmiBean.allarmiAssociazioneAcknowledgedStatoAllarme)
											or
											(item.inviaEmailAlert==1 and item.mailAckMode==1) 
											or 
											(item.invocaScriptAlert==1 and item.scriptAckMode==1)
										) 
									}">
									<h:graphicImage value="/images/tema_link/status_green.png" rendered="#{item.stato==0}" id="imgStatoOk">
										<rich:toolTip mode="client" for="imgStatoOk">
											<h:outputText value="Ok" />
										</rich:toolTip>
									</h:graphicImage>
									<rich:toolTip mode="client" for="ackLinkT">
										<h:outputText value="Click to Acknowledge." />
									</rich:toolTip>
									<rich:toolTip mode="client" for="ackLinkF">
										<h:outputText value="Click to Un-Acknowledge." />
									</rich:toolTip>
									<a4j:commandLink id="ackLinkT" styleClass="#{item.stato==1 ? 'icona-allarme-warning' : 'icona-allarme-error'}"
										rendered="#{item.acknowledged==0 and item.stato>0}"
										 reRender="allarmiTbl,statusPnlWithAcknoledged">
										<f:setPropertyActionListener value="#{item}" target="#{allarmiBean.allarme}" />
										<a4j:actionparam name="ack" value="true" assignTo="#{allarmiBean.ack}" actionListener="#{allarmiBean.toggleAck}"/>
										<i class="material-icons md-16" id="iconaSearchOpen">error</i>
									</a4j:commandLink>					
									<a4j:commandLink id="ackLinkF" styleClass="#{item.stato==1 ? 'icona-allarme-warning' : 'icona-allarme-error'}"
										rendered="#{(item.acknowledged==1) and (item.stato>0)}"
										 reRender="allarmiTbl,statusPnlWithAcknoledged">
										<f:setPropertyActionListener value="#{item}" target="#{allarmiBean.allarme}" />
										<a4j:actionparam name="ack" value="false" assignTo="#{allarmiBean.ack}" actionListener="#{allarmiBean.toggleAck}"/>
										<i class="material-icons md-16" id="iconaSearchOpen">check_circle</i>
									</a4j:commandLink>
								</a4j:outputPanel> 
								<a4j:outputPanel rendered="#{ 
										(item.enabled>0) 
										and 
										not(
											(allarmiBean.allarmiAssociazioneAcknowledgedStatoAllarme)
											or
											(item.inviaEmailAlert==1 and item.mailAckMode==1) 
											or 
											(item.invocaScriptAlert==1 and item.scriptAckMode==1)
										) 
									}">
									<h:graphicImage value="/images/tema_link/status_green.png" rendered="#{item.stato==0}" title="Ok"/>
									<h:graphicImage value="/images/tema_link/status_red.png" rendered="#{item.stato==2}" title="Error"/>
									<h:graphicImage value="/images/tema_link/status_yellow.png" rendered="#{item.stato==1}" title="Warn"/>
								</a4j:outputPanel> 
							</h:panelGroup>
						</rich:column>
						
						<rich:column  align="center" width="30px">
							<f:facet name="header">
								<h:outputText value="ModalitÃ " id="outModalita" />
							</f:facet>
							<h:panelGroup layout="block" style="width: 30px;">
								<a4j:outputPanel rendered="#{true}" id="alarmModalitaPnl">
									<i class="material-icons md-18" id="iconaModalitaOpen">#{item.modalitaAttiva ? 'alarm' : 'alarm_off'}</i>
									<rich:toolTip for="alarmModalitaPnl" mode="client" value="#{item.modalitaAttiva ? 'Attiva' : 'Passiva'}"/>
								</a4j:outputPanel>
							</h:panelGroup>
						</rich:column>
						
						<rich:column id="colAlias">
							<f:facet name="header">
								<h:outputText id="outNome" value="Nome" />
							</f:facet>
							<h:outputText value="#{item.alias}" />
						</rich:column>
						<rich:column rendered="#{searchFormAllarmi.tipologiaAllarme != 'configurazione' and (searchFormAllarmi.tipologiaAllarme == 'delegata' and searchFormAllarmi.multitenant)}">
							<f:facet name="header">
								<h:outputText value="Fruitore"  id="outFruitore"/>
							</f:facet>
							<h:outputText value="#{item.dettaglioFruitore}" />
						</rich:column>
						
						<rich:column rendered="#{searchFormAllarmi.tipologiaAllarme != 'configurazione' and (searchFormAllarmi.tipologiaAllarme == 'delegata' or searchFormAllarmi.multitenant)}">
							<f:facet name="header">
								<h:outputText value="Erogatore"  id="outErogatore"/>
							</f:facet>
							<h:outputText value="#{item.dettaglioErogatore}" />
						</rich:column>	
						<rich:column rendered="#{searchFormAllarmi.tipologiaAllarme != 'configurazione'}">
							<f:facet name="header">
								<h:outputText value="#{msg['commons.servizio.label']}"  id="outServizio"/>
							</f:facet>
							<h:outputText value="#{item.dettaglioAPI}" />
						</rich:column>
						<rich:column  align="center" width="60px">
							<f:facet name="header">
								<h:outputText value="Dettaglio" id="outDettaglio" />
							</f:facet>
							<h:panelGroup layout="block" style="width: 60px;">
								<a4j:htmlCommandLink id="dettaglio-iconLink" styleClass="edit-link" value="" action="#{allarmiBean.dettaglioAllarme}">
									<i class="material-icons md-18" id="iconaDettaglioOpen">&#xE8B6;</i>
									<rich:toolTip id="dettaglioToolLink" for="dettaglio-iconLink" mode="client" value="Visualizza Dettaglio" />
									<f:setPropertyActionListener value="#{item}" target="#{allarmiBean.allarme}" />
									<f:setPropertyActionListener value="stato" target="#{allarmiBean.selectedTab}"/>
									<f:setPropertyActionListener value="#{false}" target="#{allarmiBean.editMode}"/>
								</a4j:htmlCommandLink>
								<a4j:htmlCommandLink id="edit-iconLink" styleClass="edit-link" value="" action="#{allarmiBean.dettaglioAllarme}" 
									rendered="#{item.enabled == 1 and (item.modalitaAttiva ? allarmiBean.allarmiConsultazioneModificaStatoAbilitataAllarmeAttivo : allarmiBean.allarmiConsultazioneModificaStatoAbilitataAllarmePassivo)}">
									<i class="material-icons md-18" id="iconaModificaOpen">edit</i>
									<rich:toolTip id="editToolLink" for="edit-iconLink" mode="client" value="Modifica Stato" />
									<f:setPropertyActionListener value="#{item}" target="#{allarmiBean.allarme}" />
									<f:setPropertyActionListener value="stato" target="#{allarmiBean.selectedTab}"/>
									<f:setPropertyActionListener value="#{true}" target="#{allarmiBean.editMode}"/>
								</a4j:htmlCommandLink>
							</h:panelGroup>
						</rich:column>
					</link:dataTable>
				</h:form>
			</a4j:outputPanel>
		</a4j:outputPanel>
	</ui:define>
</ui:composition>
