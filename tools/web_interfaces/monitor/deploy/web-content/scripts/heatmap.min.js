function createHeatMapChart(t,e,a,n,l,r){if(0!=e.length&&a){for(var o=document.getElementById(t);o.firstChild;)o.removeChild(o.firstChild);generateHeatMapChart(t,JSON.parse(e),a,{w:n,h:l},r)}}function generateHeatMapChart(t,e,a,n,l){this.setPolyfill();var r=chartMapping(e,a,n);0!=r.noData&&(r.rows[0].length,r.limiteColonneLegenda);let o="#"+t,i=t+"_svg";var s=130,d=5,c=r.size.w,u=r.size.h,p=d3.select(o).append("svg");p.attr("id",i).attr("width",c).attr("height",u).style("overflow","hidden").style("font-family","Roboto");var h=p.append("g").attr("transform","translate("+d+","+s+")"),y=r.xSeries,x=r.ySeries,f=0;if(0!=r.noData){for(var m=document.getElementById(t).querySelector("svg"),g=0,C=0;C<x.length;C++){var b=x[C],B=document.createElementNS("http://www.w3.org/2000/svg","text");B.setAttributeNS(null,"opacity",0),B.setAttributeNS(null,"font-family","Roboto"),B.setAttributeNS(null,"font-size",14),B.setAttributeNS(null,"text-anchor","end"),B.textContent=b.label,m.appendChild(B),(D=m.querySelector("text").getBBox().width)>g&&(g=D),m.removeChild(B)}(g+=15)>d&&(f=g+10)}let w=y.map(function(t){return t.valore});var v=d3.scaleBand().range([0,c-2*d-f]).domain(w);const F=h.append("g").attr("class","c3-axis c3-axis-x").attr("transform","translate("+f+","+(u-1.5*s)+")").call(d3.axisBottom(v).tickValues(y.map(function(t){return t.valore})).tickFormat(function(t){return y.find(function(e){return e.valore===t}).label}));0!=r.rotation&&F.selectAll("text").attr("transform","translate(-10,10)rotate("+r.rotation+")").style("text-anchor","end"),F.selectAll("text").style("font-size",14);let A=x.map(function(t){return t.valore});var E=d3.scaleBand().range([u-1.5*s,0]).domain(A);if(h.append("g").attr("class","c3-axis c3-axis-y").attr("transform","translate("+f+",0)").call(d3.axisLeft(E)).selectAll("text").style("font-size",14).style("text-anchor","end"),0!=r.noData){var S=m.querySelector(".c3-axis.c3-axis-x path").getBoundingClientRect().width/y.length,N=S-10;0!=r.rotation&&(N=S/2+D-10);var D=m.querySelector(".c3-axis.c3-axis-y").getBBox().width;if((M=m.querySelectorAll(".c3-axis.c3-axis-x text")).forEach(function(t){var e=t.textContent,a=t.getBoundingClientRect().width;if(a>N){for(var n=e;t.getBoundingClientRect().width>N&&n.length>0;)n=n.slice(0,-1),t.textContent=n+"...";e=t.textContent,a=t.getBoundingClientRect().width}}),0!=r.rotation){var M=(m=document.getElementById(t).querySelector("svg")).querySelectorAll(".c3-axis.c3-axis-x text"),z=0;M.forEach(function(t){t.textContent,t.getBoundingClientRect().width;var e=t.getBoundingClientRect().height;e>z&&(z=e)});var L=m.querySelector(".c3-axis.c3-axis-x text").getBoundingClientRect().width-S/2;if(L>D){}let e=Math.abs(z*Math.sin(r.rotation/180*Math.PI)),a=r.size.h+e+50,n="#"+i;d3.select(n).attr("height",a)}var H=r.heatMapColorDomain[0],R=r.heatMapColorDomain[1],T=d3.select(o).append("div").style("opacity",0).attr("class","c3-tooltip-container").style("background-color","white").style("pointer-events","none").style("position","absolute");h.selectAll().data(e.dati,function(t){return t.xLabel+":"+t.yLabel}).enter().append("rect").attr("x",function(t){return v(decodeHTML(t.x))+f}).attr("y",function(t){return E(decodeHTML(t.y))}).attr("data-x",function(t){return decodeHTML(t.x)}).attr("data-y",function(t){return decodeHTML(t.y)}).attr("class","c3-rect").attr("width",v.bandwidth()).attr("height",E.bandwidth()).style("fill",function(t){return getHeatmapFillColor(t.totale,H,R)}).on("mouseover",function(t){let e=generaTooltip(t,this);T.html(e);let a=this.getBoundingClientRect(),n=a.x+a.width/2,l=a.y+a.height/2,r=this.parentElement.parentElement.attributes.width.value,o=n+Number.parseFloat(T.style("width"))-r;o>0&&(n-=o),T.style("opacity",1).style("left",n+"px").style("top",l+"px"),d3.select(this).style("stroke","black").style("opacity",1)}).on("mousemove",function(t){}).on("mouseleave",function(t){T.style("opacity",0),d3.select(this).style("stroke","none").style("opacity",.8)}),r.heatMapVisualizzaValori&&h.selectAll().data(e.dati).enter().append("text").text(function(t){return r.heatMapVisualizzaValoreZero||t.totale_label&&0!=Number.parseInt(t.totale_label)?t.totale_label:""}).style("font-family","Roboto").style("font-size",14).attr("text-anchor","middle").attr("dominant-baseline","middle").attr("x",function(t){return v(decodeHTML(t.x))+f+v.bandwidth()/2}).attr("y",function(t){return E(decodeHTML(t.y))+E.bandwidth()/2+3}).on("mouseover",function(t){let a=generaTooltip(t,this);T.html(a);let n=this.getBoundingClientRect(),l=n.x+n.width/2,r=n.y+n.height/2,o=this.parentElement.parentElement.attributes.width.value,i=l+Number.parseFloat(T.style("width"))-o;i>0&&(l-=i),T.style("opacity",1).style("left",l+"px").style("top",r+"px");const s=e.dati.find(function(e){return e.x===t.x&&e.y===t.y});d3.select('rect[data-x="'+decodeHTML(s.x)+'"][data-y="'+decodeHTML(s.y)+'"]').style("stroke","black").style("opacity",1)}).on("mousemove",function(t){}).on("mouseleave",function(t){T.style("opacity",0);const a=e.dati.find(function(e){return e.x===t.x&&e.y===t.y});d3.select('rect[data-x="'+decodeHTML(a.x)+'"][data-y="'+decodeHTML(a.y)+'"]').style("stroke","none").style("opacity",.8)});let a=h.append("linearGradient").attr("id","linear-gradient");a.attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%"),a.selectAll("stop").data([{offset:"0%",color:r.heatMapColorRange[0]},{offset:"100%",color:r.heatMapColorRange[1]}]).enter().append("stop").attr("offset",function(t){return t.offset}).attr("stop-color",function(t){return t.color});let n=r.heatMapColorDomain[0],l=r.heatMapColorDomain[1],d=.3*c,u=8,p="#"+i,x=d3.select(p).append("g").attr("id","legend").style("font-family","Roboto").attr("transform","translate("+r.size.w/2+","+s/2+")");x.append("rect").attr("class","legendRect").attr("x",-d/2+.5).attr("y",10).attr("width",d).attr("height",u).style("fill","url(#linear-gradient)").style("stroke","black").style("stroke-width","1px");let g=d3.scaleLinear().range([0,d]).domain([n,l]),C=r.heatMapLegendValues.map(function(t){return{valore:t.valore,label:t.label}});x.append("g").call(d3.axisBottom(g).tickValues(C.map(function(t){return t.valore})).tickFormat(function(t){return C.find(function(e){return e.valore===t}).label})).attr("id","asseXLegenda").attr("transform","translate("+-d/2+","+(10+u)+")")}(h=document.getElementById(t).querySelector("svg")).style&&(h.style.fontFamily="Roboto");var k=document.createElementNS("http://www.w3.org/2000/svg","text");k.setAttributeNS(null,"x",0),k.setAttributeNS(null,"y",20),k.setAttributeNS(null,"id","title"),k.setAttributeNS(null,"width",r.size.w+"px"),k.setAttributeNS(null,"class","c3-chart-title"),k.appendChild(document.createTextNode(r.title)),h.appendChild(k);var q=k.getBBox();k.setAttributeNS(null,"x",(r.size.w-q.width)/2);var I=document.createElementNS("http://www.w3.org/2000/svg","text");I.setAttributeNS(null,"x",0),I.setAttributeNS(null,"y",55),I.setAttributeNS(null,"id","subtitle"),I.setAttributeNS(null,"width",r.size.w+"px"),I.setAttributeNS(null,"class","c3-chart-subtitle"),I.appendChild(document.createTextNode(r.subtitle)),h.appendChild(k),h.appendChild(I);q=k.getBBox();var V=I.getBBox();if(k.setAttributeNS(null,"x",(r.size.w-q.width)/2),I.setAttributeNS(null,"x",(r.size.w-V.width)/2),0==r.noData){var _=document.createElementNS("http://www.w3.org/2000/svg","text");_.setAttributeNS(null,"x",0),_.setAttributeNS(null,"y",r.size.h/2),_.setAttributeNS(null,"id","warning"),_.setAttributeNS(null,"width",r.size.w+"px"),_.setAttributeNS(null,"class","c3-chart-nodata"),_.appendChild(document.createTextNode(r.noDataLabel)),h.appendChild(_);var G=_.getBBox();_.setAttributeNS(null,"x",(r.size.w-G.width)/2)}this.embedFonts(h)}var heatmapGradientColors=["FFFFFF","FBFCFD","F7F9FC","F3F7FA","EFF4F9","EBF2F7","E7EFF6","E3EDF4","DFEAF3","DBE8F1","D7E5F0","D3E3EE","CFE0ED","CBDEEB","C7DBEA","C3D9E8","BFD6E7","BBD3E6","B7D1E4","B3CEE3","AFCCE1","ABC9E0","A7C7DE","A3C4DD","9FC2DB","9BBFDA","97BDD8","93BAD7","8FB8D5","8BB5D4","87B3D2","83B0D1","7FAECF","7BABCE","77A8CD","73A6CB","6FA3CA","6BA1C8","679EC7","639CC5","5F99C4","5B97C2","5794C1","5392BF","4F8FBE","4B8DBC","478ABB","4388B9","3F85B8","3B83B7"];function getHeatmapFillColor(t,e,a){var n=a===e?0:(t-e)/(a-e);n=Math.max(0,Math.min(1,n));var l=Math.round(49*n);return"#"+heatmapGradientColors[l]}function getHeatmapColorClass(t){var e,a=t.match(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i);a?e=((1<<24)+(Number.parseInt(a[1],10)<<16)+(Number.parseInt(a[2],10)<<8)+Number.parseInt(a[3],10)).toString(16).slice(1).toUpperCase():e=t.replace("#","").toUpperCase();return"heatmap-background-color-"+e}function generaTooltip(t,e,a,n,l){var r,o,i,s;return r||(r="<table class='c3-tooltip heatmap-tooltip-table-style'>"+((o=t.xLabel)||0===o?"<tr><th colspan='2'>"+o+"</th></tr>":"")),s=t.yLabel,i=t.totale_tooltip,r+="<tr class='c3-tooltip-name-totale'>",r+="<td class='name'><span class='"+getHeatmapColorClass(e.style.fill)+"'></span>"+s+"</td>",r+="<td class='value'>"+i+"</td>",(r+="</tr>")+"</table>"}