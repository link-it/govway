function createHeatMapChart(t,e,a,n,l,r){if(0!=e.length&&a){for(var o=document.getElementById(t);o.firstChild;)o.removeChild(o.firstChild);generateHeatMapChart(t,JSON.parse(e),a,{w:n,h:l},r)}}function generateHeatMapChart(t,e,a,n,l){this.setPolyfill();var r=chartMapping(e,a,n);0!=r.noData&&(r.rows[0].length,r.limiteColonneLegenda);let o="#"+t,i=t+"_svg";var s=130,d=5,c=r.size.w,u=r.size.h,h=d3.select(o).append("svg");h.attr("id",i).attr("width",c).attr("height",u).style("overflow","hidden").style("font-family","Roboto");var p=h.append("g").attr("transform","translate("+d+","+s+")"),y=r.xSeries,x=r.ySeries,f=0;if(0!=r.noData){for(var g=document.getElementById(t).querySelector("svg"),m=0,b=0;b<x.length;b++){var w=x[b],v=document.createElementNS("http://www.w3.org/2000/svg","text");v.setAttributeNS(null,"opacity",0),v.setAttributeNS(null,"font-family","Roboto"),v.setAttributeNS(null,"font-size",14),v.setAttributeNS(null,"text-anchor","end"),v.textContent=w.label,g.appendChild(v);var S=g.querySelector("text").getBBox().width;console.log(S),S>m&&(m=S),g.removeChild(v)}(m+=15)>d&&(f=m+10)}let C=y.map(function(t){return t.valore});var N=d3.scaleBand().range([0,c-2*d-f]).domain(C);const A=p.append("g").attr("class","c3-axis c3-axis-x").attr("transform","translate("+f+","+(u-1.5*s)+")").call(d3.axisBottom(N).tickValues(y.map(function(t){return t.valore})).tickFormat(function(t){return y.find(function(e){return e.valore===t}).label}));0!=r.rotation&&A.selectAll("text").attr("transform","translate(-10,10)rotate("+r.rotation+")").style("text-anchor","end"),A.selectAll("text").style("font-size",14);let B=x.map(function(t){return t.valore});var M=d3.scaleBand().range([u-1.5*s,0]).domain(B);if(p.append("g").attr("class","c3-axis c3-axis-y").attr("transform","translate("+f+",0)").call(d3.axisLeft(M)).selectAll("text").style("font-size",14).style("text-anchor","end"),0!=r.noData){var L=g.querySelector(".c3-axis.c3-axis-x path").getBoundingClientRect().width/y.length,z=L-10;0!=r.rotation&&(z=L/2+S-10);S=g.querySelector(".c3-axis.c3-axis-y").getBBox().width;if((R=g.querySelectorAll(".c3-axis.c3-axis-x text")).forEach(function(t){var e=t.textContent,a=t.getBoundingClientRect().width;if(a>z){for(var n=e;t.getBoundingClientRect().width>z&&n.length>0;)n=n.slice(0,-1),t.textContent=n+"...";e=t.textContent,a=t.getBoundingClientRect().width}}),0!=r.rotation){var R=(g=document.getElementById(t).querySelector("svg")).querySelectorAll(".c3-axis.c3-axis-x text"),k=0;R.forEach(function(t){t.textContent,t.getBoundingClientRect().width;var e=t.getBoundingClientRect().height;e>k&&(k=e)});var T=g.querySelector(".c3-axis.c3-axis-x text").getBoundingClientRect().width-L/2;if(T>S){}let e=Math.abs(k*Math.sin(r.rotation/180*Math.PI)),a=r.size.h+e+50,n="#"+i;d3.select(n).attr("height",a)}var E=d3.scaleLinear().range([r.heatMapColorRange[0],r.heatMapColorRange[1]]).domain([r.heatMapColorDomain[0],r.heatMapColorDomain[1]]),H=d3.select(o).append("div").style("opacity",0).attr("class","c3-tooltip-container").style("background-color","white").style("pointer-events","none").style("position","absolute");p.selectAll().data(e.dati,function(t){return t.xLabel+":"+t.yLabel}).enter().append("rect").attr("x",function(t){return N(decodeHTML(t.x))+f}).attr("y",function(t){return M(decodeHTML(t.y))}).attr("data-x",function(t){return decodeHTML(t.x)}).attr("data-y",function(t){return decodeHTML(t.y)}).attr("class","c3-rect").attr("width",N.bandwidth()).attr("height",M.bandwidth()).style("fill",function(t){return E(t.totale)}).on("mouseover",function(t){let e=generaTooltip(t,this);H.html(e);let a=this.getBoundingClientRect(),n=a.x+a.width/2,l=a.y+a.height/2,r=this.parentElement.parentElement.attributes.width.value,o=n+Number.parseFloat(H.style("width"))-r;o>0&&(n-=o),H.style("opacity",1).style("left",n+"px").style("top",l+"px"),d3.select(this).style("stroke","black").style("opacity",1)}).on("mousemove",function(t){}).on("mouseleave",function(t){H.style("opacity",0),d3.select(this).style("stroke","none").style("opacity",.8)}),r.heatMapVisualizzaValori&&p.selectAll().data(e.dati).enter().append("text").text(function(t){return r.heatMapVisualizzaValoreZero||t.totale_label&&0!=Number.parseInt(t.totale_label)?t.totale_label:""}).style("font-family","Roboto").style("font-size",14).attr("text-anchor","middle").attr("dominant-baseline","middle").attr("x",function(t){return N(decodeHTML(t.x))+f+N.bandwidth()/2}).attr("y",function(t){return M(decodeHTML(t.y))+M.bandwidth()/2+3}).on("mouseover",function(t){let a=generaTooltip(t,this);H.html(a);let n=this.getBoundingClientRect(),l=n.x+n.width/2,r=n.y+n.height/2,o=this.parentElement.parentElement.attributes.width.value,i=l+Number.parseFloat(H.style("width"))-o;i>0&&(l-=i),H.style("opacity",1).style("left",l+"px").style("top",r+"px");const s=e.dati.find(function(e){return e.x===t.x&&e.y===t.y});d3.select('rect[data-x="'+decodeHTML(s.x)+'"][data-y="'+decodeHTML(s.y)+'"]').style("stroke","black").style("opacity",1)}).on("mousemove",function(t){}).on("mouseleave",function(t){H.style("opacity",0);const a=e.dati.find(function(e){return e.x===t.x&&e.y===t.y});d3.select('rect[data-x="'+decodeHTML(a.x)+'"][data-y="'+decodeHTML(a.y)+'"]').style("stroke","none").style("opacity",.8)});let a=p.append("linearGradient").attr("id","linear-gradient");a.attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%"),a.selectAll("stop").data([{offset:"0%",color:r.heatMapColorRange[0]},{offset:"100%",color:r.heatMapColorRange[1]}]).enter().append("stop").attr("offset",function(t){return t.offset}).attr("stop-color",function(t){return t.color});let n=r.heatMapColorDomain[0],l=r.heatMapColorDomain[1],d=.3*c,u=8,h="#"+i,x=d3.select(h).append("g").attr("id","legend").style("font-family","Roboto").attr("transform","translate("+r.size.w/2+","+s/2+")");x.append("rect").attr("class","legendRect").attr("x",-d/2+.5).attr("y",10).attr("width",d).attr("height",u).style("fill","url(#linear-gradient)").style("stroke","black").style("stroke-width","1px");let m=d3.scaleLinear().range([0,d]).domain([n,l]),b=r.heatMapLegendValues.map(function(t){return{valore:t.valore,label:t.label}});x.append("g").call(d3.axisBottom(m).tickValues(b.map(function(t){return t.valore})).tickFormat(function(t){return b.find(function(e){return e.valore===t}).label})).attr("id","asseXLegenda").attr("transform","translate("+-d/2+","+(10+u)+")")}(p=document.getElementById(t).querySelector("svg")).style&&(p.style.fontFamily="Roboto");var q=document.createElementNS("http://www.w3.org/2000/svg","text");q.setAttributeNS(null,"x",0),q.setAttributeNS(null,"y",20),q.setAttributeNS(null,"id","title"),q.setAttributeNS(null,"width",r.size.w+"px"),q.setAttributeNS(null,"class","c3-chart-title"),q.appendChild(document.createTextNode(r.title)),p.appendChild(q);var D=q.getBBox();q.setAttributeNS(null,"x",(r.size.w-D.width)/2);var V=document.createElementNS("http://www.w3.org/2000/svg","text");V.setAttributeNS(null,"x",0),V.setAttributeNS(null,"y",55),V.setAttributeNS(null,"id","subtitle"),V.setAttributeNS(null,"width",r.size.w+"px"),V.setAttributeNS(null,"class","c3-chart-subtitle"),V.appendChild(document.createTextNode(r.subtitle)),p.appendChild(q),p.appendChild(V);D=q.getBBox();var F=V.getBBox();if(q.setAttributeNS(null,"x",(r.size.w-D.width)/2),V.setAttributeNS(null,"x",(r.size.w-F.width)/2),0==r.noData){var I=document.createElementNS("http://www.w3.org/2000/svg","text");I.setAttributeNS(null,"x",0),I.setAttributeNS(null,"y",r.size.h/2),I.setAttributeNS(null,"id","warning"),I.setAttributeNS(null,"width",r.size.w+"px"),I.setAttributeNS(null,"class","c3-chart-nodata"),I.appendChild(document.createTextNode(r.noDataLabel)),p.appendChild(I);var _=I.getBBox();I.setAttributeNS(null,"x",(r.size.w-_.width)/2)}this.embedFonts(p)}function generaTooltip(t,e,a,n,l){var r,o,i,s;return r||(r="<table class='c3-tooltip' style='word-wrap: break-word !important; max-width: 250px;'>"+((o=t.xLabel)||0===o?"<tr><th colspan='2'>"+o+"</th></tr>":"")),s=t.yLabel,i=t.totale_tooltip,r+="<tr class='c3-tooltip-name-totale'>",r+="<td class='name'><span style='background-color:"+e.style.fill+"'></span>"+s+"</td>",r+="<td class='value'>"+i+"</td>",(r+="</tr>")+"</table>"}