# Topic
topic.erogazioni=request,requestBody,response,responseBody,trackingPhaseInRequest,trackingPhaseOutRequest,trackingPhaseOutResponse,trackingPhasePostOutResponse
topic.fruizioni=request,requestBody,response,responseBody,trackingPhaseRequest,trackingPhaseResponse

# Topic personalizzazione
# sintassi: log.topic.<erogazioni/fruizioni>.<nomeTopic>.<nomePropriet‡>=<valorePropriet‡>
# Di seguito le propriet‡ utilizzabili:
# - requestSent (true/false): se abilitata il topic verr‡ invocato solamente se GovWay Ë riuscito a spedire la richiesta verso il backend
# - inRequestContentDefined (true/false): se abilitata il topic verr‡ invocato se la richiesta in ingresso possiede un payload http
# - outRequestContentDefined (true/false): se abilitata il topic verr‡ invocato se la richiesta in uscita possiede un payload http
# - inResponseContentDefined (true/false): se abilitata il topic verr‡ invocato se la risposta in ingresso possiede un payload http
# - inResponseContentDefined (true/false): se abilitata il topic verr‡ invocato se la risposta in uscita possiede un payload http

# I topic delle fruizioni devono essere invocati solamente se la richiesta Ë stata inoltrata al backend
topic.fruizioni.request.requestSent=true
topic.fruizioni.requestBody.requestSent=true
topic.fruizioni.response.requestSent=true
topic.fruizioni.responseBody.requestSent=true

# I topic delle richieste (body) devono essere invocati solamente se Ë presente un payload http 
topic.erogazioni.requestBody.inRequestContentDefined=true
topic.fruizioni.requestBody.outRequestContentDefined=true

# Test per le fasi
topic.erogazioni.trackingPhaseInRequest.trackingPhases=inRequest
topic.erogazioni.trackingPhaseOutRequest.trackingPhases=outRequest
topic.erogazioni.trackingPhaseOutResponse.trackingPhases=outResponse
topic.erogazioni.trackingPhasePostOutResponse.trackingPhases=postOutResponse
topic.fruizioni.trackingPhaseRequest.trackingPhases=inRequest,outRequest
topic.fruizioni.trackingPhaseResponse.trackingPhases=outResponse,postOutResponse


# *** LOG4J ***

# Log4j2 Configuration File
log.config.file=/org/openspcoop2/pdd/logger/filetrace/test/testfileTrace.log4j2.properties

# trace/debug/info/warn/error
log.severity=info

# Category per ogni topic delle erogazioni
# sintassi: log.topic.erogazioni.<nomeTopic>=<categoryLog4j2>
category.topic.erogazioni.request=fileTrace.request
category.topic.erogazioni.requestBody=fileTrace.requestBody
category.topic.erogazioni.response=fileTrace.response
category.topic.erogazioni.responseBody=fileTrace.responseBody
category.topic.erogazioni.trackingPhaseInRequest=fileTrace.trackingPhaseInRequest
category.topic.erogazioni.trackingPhaseOutRequest=fileTrace.trackingPhaseOutRequest
category.topic.erogazioni.trackingPhaseOutResponse=fileTrace.trackingPhaseOutResponse
category.topic.erogazioni.trackingPhasePostOutResponse=fileTrace.trackingPhasePostOutResponse
# Category per ogni topic delle fruizioni
# sintassi: log.topic.fruizioni.<nomeTopic>=<categoryLog4j2>
category.topic.fruizioni.request=fileTrace.request
category.topic.fruizioni.requestBody=fileTrace.requestBody
category.topic.fruizioni.response=fileTrace.response
category.topic.fruizioni.responseBody=fileTrace.responseBody
category.topic.fruizioni.trackingPhaseRequest=fileTrace.trackingPhaseRequest
category.topic.fruizioni.trackingPhaseResponse=fileTrace.trackingPhaseResponse



# *** FORMAT ***

# Escape dei caratteri speciali
# sintassi: format.escape.<CHAR>=<CHAR_ESCAPED>
# Per indicare i caratteri '=' e '\' usare l'escape '\' nel properties. 
# Ad esempio per fare l'escape del carattere '=':
# format.escape.\==\\\=
format.escape."=\\"

# Formato degli headers
#format.headers.separator=,
#format.headers.header.prefix=
#format.headers.header.suffix=
#format.headers.header.separator=


# Propriet‡
# sintassi: format.property.<position>.<nomeProperty>=...
# Le propriet√† verranno risolte in ordine lessicografico di posizionamento; l'ordine Ë importante se si hanno propriet‡† che sono definite tramite altre propriet‡

# Informazioni comuni
format.property.000a.commons.server.ip=10.114.32.21
format.property.000b.commons.server.hostname=prova
format.property.000c.commons.server.port=8443
format.property.000d.commons.server.encoding=${log:javaProperty(file.encoding)}
format.property.000e.commons.user=${log:requestProperty(ProprietaTest)}

# Identificativo di transazione e applicativo
format.property.001a.commons.id="${log:transactionId}"|"${log:applicationId}"|"${log:javaProperty(javaProperty.1)}"|"${log:javaProperty(javaProperty.2)}"|"${log:systemProperty(FILETRACE-TEST-ENV)}"|"${log:systemProperty(FILETRACE-TEST-ENV2)}"
format.property.001b.commons.id.body=${log:transactionId}.${log:applicationId(****)}

# Data composta da due campi: Request Timestamp (UTC) e Local Time zone (ISO8601)
format.property.002a.commons.dataRichiestaErogazione="${log:inRequestDateZ(yyyy-MM-dd HH:mm:ss:SSS,UTC)}"|"${log:inRequestDate(Z)}"
format.property.002b.commons.dataRispostaErogazione="${log:outResponseDateZ(yyyy-MM-dd HH:mm:ss:SSS,UTC)}"|"${log:outResponseDate(Z)}"
format.property.002c.commons.dataRichiestaFruizione="${log:outRequestDateZ(yyyy-MM-dd HH:mm:ss:SSS,UTC)}"|"${log:outRequestDate(Z)}"
format.property.002d.commons.dataRispostaFruizione="${log:inResponseDateZ(yyyy-MM-dd HH:mm:ss:SSS,UTC)}"|"${log:inResponseDate(Z)}"

# Data base64 ISO8601 Request Time
format.property.003a.commons.dataRichiestaErogazioneBase64=${logBase64:inRequestDate(yyyy-MM-dd'T'HH:mm:ss.SSSZ)}
format.property.003b.commons.dataRispostaErogazioneBase64=${logBase64:outResponseDate(yyyy-MM-dd'T'HH:mm:ss.SSSZ)}
format.property.003c.commons.dataRichiestaFruizioneBase64=${logBase64:outRequestDate(yyyy-MM-dd'T'HH:mm:ss.SSSZ)}
format.property.003d.commons.dataRispostaFruizioneBase64=${logBase64:inResponseDate(yyyy-MM-dd'T'HH:mm:ss.SSSZ)}

# Remote IP - Protocol - Method
format.property.004a.commons.remoteIP-protocol-method="${log:clientIP}"|"${log:forwardedIP}"|"${log:requesterIP}"|"HTTP/1.1"|"${log:httpMethod}"

# URL Invocazione
format.property.005a.commons.urlErogazione="https://${log:property(commons.server.hostname)}:${log:property(commons.server.port)}${log:inURL}"
format.property.005b.commons.urlFruizione="${log:outURL}"

# Status Code
format.property.006a.commons.httpStatusErogazione="${log:outHttpStatus}"
format.property.006b.commons.httpStatusFruizione="${log:inHttpStatus}"
# Intestazioni HTTP Status per il file body response
format.property.006c.commons.httpStatusErogazione.body=HTTP/1.1 ${log:outHttpStatus} ${log:outHttpReason}
format.property.006d.commons.httpStatusFruizione.body=HTTP/1.1 ${log:inHttpStatus} ${log:inHttpReason}

# Elapsed Time espressi in microsecondi
format.property.007a.commons.elapsedTimeErogazione="${log:elapsedTimeUs}"
format.property.007b.commons.elapsedTimeFruizione="${log:apiElapsedTimeUs}"

# Altre date
format.property.008a.commons.dataRichiestaIngresso="${log:inRequestStartTimeZ(yyyy-MM-dd HH:mm:ss:SSS,UTC)}"|"${log:inRequestEndTimeZ(yyyy-MM-dd HH:mm:ss:SSS,UTC)}"
format.property.008b.commons.dataRichiestaUscita="${log:outRequestStartTimeZ(yyyy-MM-dd HH:mm:ss:SSS,UTC)}"|"${log:outRequestEndTimeZ(yyyy-MM-dd HH:mm:ss:SSS,UTC)}"
format.property.008c.commons.dataRispostaIngresso="${log:inResponseStartTimeZ(yyyy-MM-dd HH:mm:ss:SSS,UTC)}"|"${log:inResponseEndTimeZ(yyyy-MM-dd HH:mm:ss:SSS,UTC)}"
format.property.008d.commons.dataRispostaUscita="${log:outResponseStartTimeZ(yyyy-MM-dd HH:mm:ss:SSS,UTC)}"|"${log:outResponseEndTimeZ(yyyy-MM-dd HH:mm:ss:SSS,UTC)}"
format.property.008e.commonds.date=${log:property(commons.dataRichiestaIngresso)}|${log:property(commons.dataRichiestaUscita)}|${log:property(commons.dataRispostaIngresso)}|${log:property(commons.dataRispostaUscita)}

# Campi Custom 'Liberi'
format.property.100a.custom.govway=versione_api = ${log:apiVersion}; api = ${log:api}; operazione = ${log:action}; erogatore = ${log:provider}; soggetto_fruitore = ${log:sender}; applicativo_fruitore = ${log:application}; id_messaggio_richiesta = ${log:requestId}; id_messaggio_risposta = ${log:responseId}; id_collaborazione = ${log:correlationId}; esito = ${log:result};

# Campi Custom da utilizzare per il log degli header e per la registrazione del file body response
format.property.101a.custom.headers="X-GovWay-APP-SERVER=${log:property(commons.server.ip)}"|"X-GovWay-HOSTNAME-APP-SERVER=${log:property(commons.server.hostname)}"|"X-GovWay-SERVER-ENCODING=${log:property(commons.server.encoding)}"|"X-GovWay-APP-SERVER-PORT=${log:property(commons.server.port)}"|"X-GovWay-USER=${log:property(commons.user)}"|"X-GovWay-COMPLEX=${log:property(custom.govway)}"
format.property.101b.custom.headers.body=X-GovWay-APP-SERVER: ${log:property(commons.server.ip)}\nX-GovWay-HOSTNAME-APP-SERVER: ${log:property(commons.server.hostname)}\nX-GovWay-SERVER-ENCODING: ${log:property(commons.server.encoding)}\nX-GovWay-APP-SERVER-PORT: ${log:property(commons.server.port)}\nX-GovWay-USER: ${log:property(commons.user)}\nX-GovWay-COMPLEX: ${log:property(custom.govway)}

# Headers complessivi per il file body response
format.property.102a.headers.erogazioneBody=${log:property(commons.httpStatusErogazione.body)}\n${log:outResponseHeaders(\n,: ,,)}\n${log:property(custom.headers.body)}
format.property.102b.headers.fruizioneBody=${log:property(commons.httpStatusFruizione.body)}\n${log:inResponseHeaders(\n,: ,,)}\n${log:property(custom.headers.body)}

# mittente
format.property.200.commons.mittente="${log:credentials}"|"${log:principal}"
format.property.201.commons.mittente.token="${log:tokenIssuer}"|"${log:tokenSubject}"|"${log:tokenClientId}"|"${log:tokenUsername}"|"${log:tokenMail}"|"${log:tokenClaim(iss)}"|"${log:tokenClaim(exp)}"
format.property.202.commons.mittente.tokenApplication="${log:tokenClientApplication}"|"${log:tokenClientOrganization}"
format.property.203.commons.mittente.application="${log:application}"|"${log:sender}"
format.property.204.commons.mittente.requester="${log:requester}"

# retrievedAccessToken
format.property.300.commons.retrievedTokenInfo="${log:retrievedAccessToken}"|"${log:retrievedTokenClaim(token_type)}"|"${log:retrievedTokenRequestTransactionId}"|"${log:retrievedTokenRequestGrantType}"|"${log:retrievedTokenRequestJwtClientAssertion}"|"${log:retrievedTokenRequestGrantType}"|"${log:retrievedTokenRequestClientId}"|"${log:retrievedTokenRequestClientToken}"|"${log:retrievedTokenRequestUsername}"|"${log:retrievedTokenRequestUrl}"

# tlsClient
format.property.401.commons.tlsClientInfo="${log:clientCertificateSubjectDN}"|"${log:clientCertificateSubjectCN}"|"${log:clientCertificateSubjectDNInfo(OU)}"|"${log:clientCertificateIssuerDN}"

# validazioneJWTAccesstoken
format.property.411.commons.jwtAccessTokenInfo="${log:tokenRaw}"|"${log:tokenHeaderRaw}"|"${logBase64:tokenDecodedHeader}"|"${log:tokenHeaderClaim(alg)}"|"${log:tokenHeaderClaims}"|"${log:tokenPayloadRaw}"|"${logBase64:tokenDecodedPayload}"|"${log:tokenPayloadClaim(aud)}"|"${log:tokenPayloadClaims}"
format.property.412.commons.jwtAccessTokenCertInfo="${log:tokenCertificateSubjectDN}"|"${log:tokenCertificateSubjectCN}"|"${log:tokenCertificateSubjectDNInfo(OU)}"|"${log:tokenCertificateIssuerDN}"

# ModI Authorization
format.property.421.commons.modiAuthorizationTokenInfo="${log:tokenModIAuthorizationRaw}"|"${log:tokenModIAuthorizationHeaderRaw}"|"${logBase64:tokenModIAuthorizationDecodedHeader}"|"${log:tokenModIAuthorizationHeaderClaim(alg)}"|"${log:tokenModIAuthorizationHeaderClaims}"|"${log:tokenModIAuthorizationPayloadRaw}"|"${logBase64:tokenModIAuthorizationDecodedPayload}"|"${log:tokenModIAuthorizationPayloadClaim(aud)}"|"${log:tokenModIAuthorizationPayloadClaims}"
format.property.422.commons.modiAuthorizationTokenCertInfo="${log:tokenModIAuthorizationCertificateSubjectDN}"|"${log:tokenModIAuthorizationCertificateSubjectCN}"|"${log:tokenModIAuthorizationCertificateSubjectDNInfo(OU)}"|"${log:tokenModIAuthorizationCertificateIssuerDN}"

# ModI Integrity
format.property.431.commons.modiIntegrityTokenInfo="${log:tokenModIIntegrityRaw}"|"${log:tokenModIIntegrityHeaderRaw}"|"${logBase64:tokenModIIntegrityDecodedHeader}"|"${log:tokenModIIntegrityHeaderClaim(alg)}"|"${log:tokenModIIntegrityHeaderClaims}"|"${log:tokenModIIntegrityPayloadRaw}"|"${logBase64:tokenModIIntegrityDecodedPayload}"|"${log:tokenModIIntegrityPayloadClaim(aud)}"|"${log:tokenModIIntegrityPayloadClaims}"
format.property.432.commons.modiIntegrityTokenCertInfo="${log:tokenModIIntegrityCertificateSubjectDN}"|"${log:tokenModIIntegrityCertificateSubjectCN}"|"${log:tokenModIIntegrityCertificateSubjectDNInfo(OU)}"|"${log:tokenModIIntegrityCertificateIssuerDN}"

# ModI Audit
format.property.441.commons.modiAuditTokenInfo="${log:tokenModIAuditRaw}"|"${log:tokenModIAuditHeaderRaw}"|"${logBase64:tokenModIAuditDecodedHeader}"|"${log:tokenModIAuditHeaderClaim(alg)}"|"${log:tokenModIAuditHeaderClaims}"|"${log:tokenModIAuditPayloadRaw}"|"${logBase64:tokenModIAuditDecodedPayload}"|"${log:tokenModIAuditPayloadClaim(aud)}"|"${log:tokenModIAuditPayloadClaims}"
format.property.442.commons.modiAuditTokenCertInfo="${log:tokenModIAuditCertificateSubjectDN}"|"${log:tokenModIAuditCertificateSubjectCN}"|"${log:tokenModIAuditCertificateSubjectDNInfo(OU)}"|"${log:tokenModIAuditCertificateIssuerDN}"

# ModI PDND
format.property.451.commons.modiPdndClient="${log:pdndClientJson}"|"${log:pdndClientId}"|"${log:pdndClientConsumerId}"
format.property.452.commons.modiPdndOrganization="${log:pdndOrganizationJson}"|"${log:pdndOrganizationName}"|"${log:pdndOrganizationId}"|"${log:pdndOrganizationCategory}"|"${log:pdndOrganizationExternalOrigin}"|"${log:pdndOrganizationExternalId}"


# Formato del log per ogni topic

# EROGAZIONI-RICHIESTA
format.topic.erogazioni.request="${log:inFunction}"|"${log:apiProtocol}"|"${log:role}"|"esempioCostanteRichiestaErogazione"|${log:property(commons.id)}|${log:property(commons.dataRichiestaErogazione)}|${log:property(commons.remoteIP-protocol-method)}|${log:property(commons.mittente)}|${log:property(commons.mittente.token)}|${log:property(commons.mittente.tokenApplication)}|${log:property(commons.mittente.application)}|${log:property(commons.mittente.requester)}|${log:property(commons.urlErogazione)}|"${log:inRequestContentType}"|"${log:inRequestSize}"|"HEADERS"|${log:inRequestHeaders(|,=,",")}|"${log:attribute(a1)}"|"${log:attribute(a2)}"|${log:property(commons.retrievedTokenInfo)}|${log:property(commons.tlsClientInfo)}|${log:property(commons.jwtAccessTokenInfo)}|${log:property(commons.jwtAccessTokenCertInfo)}|${log:property(commons.modiAuthorizationTokenInfo)}|${log:property(commons.modiAuthorizationTokenCertInfo)}|${log:property(commons.modiIntegrityTokenInfo)}|${log:property(commons.modiIntegrityTokenCertInfo)}|${log:property(commons.modiAuditTokenInfo)}|${log:property(commons.modiAuditTokenCertInfo)}|${log:property(commons.modiPdndClient)}|${log:property(commons.modiPdndOrganization)}|${log:property(commonds.date)}
format.topic.erogazioni.requestBody=${log:property(commons.id.body)}.${log:property(commons.dataRichiestaErogazioneBase64)}.${logBase64:inRequestContentType}.${logBase64:inRequestContent}

# EROGAZIONI-RISPOSTA
format.topic.erogazioni.response="esempioCostanteRispostaErogazione"|"${log:token}"|${log:property(commons.id)}|${log:property(commons.dataRispostaErogazione)}|${log:property(commons.remoteIP-protocol-method)}|${log:property(commons.urlErogazione)}|${log:property(commons.httpStatusErogazione)}|${log:property(commons.elapsedTimeErogazione)}|"${log:outResponseContentType}"|"${log:outResponseSize}"|"HEADERS"|${log:outResponseHeaders(|,=,",")}|${log:property(custom.headers)}
format.topic.erogazioni.responseBody=${log:property(commons.id.body)}.${log:property(commons.dataRispostaErogazioneBase64)}.${logBase64:property(headers.erogazioneBody)}.${logBase64:outResponseContent}

# FRUIZIONE-RICHIESTA
format.topic.fruizioni.request="${log:inFunction}"|"${log:apiProtocol}"|"${log:role}"|"esempioCostanteRichiestaFruizione"|${log:property(commons.id)}|${log:property(commons.dataRichiestaFruizione)}|${log:property(commons.remoteIP-protocol-method)}|${log:property(commons.mittente)}|${log:property(commons.mittente.token)}|${log:property(commons.mittente.tokenApplication)}|${log:property(commons.mittente.application)}|${log:property(commons.mittente.requester)}|${log:property(commons.urlFruizione)}|"${log:outRequestContentType}"|"${log:outRequestSize}"|"HEADERS"|${log:outRequestHeaders(|,=,",")}|"${log:attributeByAA(AA1,a1)}"|"${log:attributeByAA(AA2,a2)}"|${log:property(commons.retrievedTokenInfo)}|${log:property(commons.tlsClientInfo)}|${log:property(commons.jwtAccessTokenInfo)}|${log:property(commons.jwtAccessTokenCertInfo)}|${log:property(commons.modiAuthorizationTokenInfo)}|${log:property(commons.modiAuthorizationTokenCertInfo)}|${log:property(commons.modiIntegrityTokenInfo)}|${log:property(commons.modiIntegrityTokenCertInfo)}|${log:property(commons.modiAuditTokenInfo)}|${log:property(commons.modiAuditTokenCertInfo)}|${log:property(commons.modiPdndClient)}|${log:property(commons.modiPdndOrganization)}|${log:property(commonds.date)}
format.topic.fruizioni.requestBody=${log:property(commons.id.body)}.${log:property(commons.dataRichiestaFruizioneBase64)}.${logBase64:outRequestContentType}.${logBase64:outRequestContent}

# FRUIZIONE-RISPOSTA
format.topic.fruizioni.response="esempioCostanteRispostaFruizione"|"${log:token}"|${log:property(commons.id)}|${log:property(commons.dataRispostaFruizione)}|${log:property(commons.remoteIP-protocol-method)}|${log:property(commons.urlFruizione)}|${log:property(commons.httpStatusFruizione)}|${log:property(commons.elapsedTimeFruizione)}|"${log:inResponseContentType}"|"${log:inResponseSize}"|"HEADERS"|${log:inResponseHeaders(|,=,",")}|${log:property(custom.headers)}
format.topic.fruizioni.responseBody=${log:property(commons.id.body)}.${log:property(commons.dataRispostaFruizioneBase64)}.${logBase64:property(headers.fruizioneBody)}.${logBase64:inResponseContent}

# EROGAZIONI TEST FASE
format.topic.erogazioni.trackingPhaseInRequest="*FASE_${log:trackingPhase}*"|"${log:contextProperty(TRACKING_PHASE)}"|${log:property(commons.id)}
format.topic.erogazioni.trackingPhaseOutRequest="*FASE_${log:trackingPhase}*"|"${log:contextProperty(TRACKING_PHASE)}"|${log:property(commons.id)}
format.topic.erogazioni.trackingPhaseOutResponse="*FASE_${log:trackingPhase}*"|"${log:contextProperty(TRACKING_PHASE)}"|${log:property(commons.id)}
format.topic.erogazioni.trackingPhasePostOutResponse="*FASE_${log:trackingPhase}*"|"${log:contextProperty(TRACKING_PHASE)}"|${log:property(commons.id)}

# FRUIZIONE TEST FASE
format.topic.fruizioni.trackingPhaseRequest="*FASE_REQUEST*"|"${log:contextProperty(TRACKING_PHASE)}"|${log:property(commons.id)}
format.topic.fruizioni.trackingPhaseResponse="*FASE_RESPONSE*"|"${log:contextProperty(TRACKING_PHASE)}"|${log:property(commons.id)}
